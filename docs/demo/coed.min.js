!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Coed=e()}}(function(){var e;return function r(e,t,n){function o(a,s){if(!t[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=t[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,r,e,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,n,r){!function(t){if("object"==typeof r&&"object"==typeof n)n.exports=t();else{if("function"==typeof e&&e.amd)return e([],t);(this||window).browserKeymap=t()}}(function(){"use strict";function r(e){if("keypress"==e.type)return"'"+String.fromCharCode(e.charCode)+"'";var n=t[e.keyCode],r=n;return null==r||e.altGraphKey?null:(e.altKey&&"Alt"!=n&&(r="Alt-"+r),e.ctrlKey&&"Ctrl"!=n&&(r="Ctrl-"+r),e.metaKey&&"Cmd"!=n&&(r="Cmd-"+r),e.shiftKey&&"Shift"!=n&&(r="Shift-"+r),r)}function o(e){return e=/[^-]*$/.exec(e)[0],"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function i(t){for(var o,i,a,s,n=t.split(/-(?!'?$)/),r=n[n.length-1],u=0;u<n.length-1;u++){var l=n[u];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))o=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);e?s=!0:i=!0}}return o&&(r="Alt-"+r),i&&(r="Ctrl-"+r),s&&(r="Cmd-"+r),a&&(r="Shift-"+r),r}function a(e,t){this.options=t||{},this.bindings=Object.create(null),e&&this.addBindings(e)}for(var e="undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os?"darwin"==os.platform():!1,t={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},n=0;10>n;n++)t[n+48]=t[n+96]=String(n);for(var n=65;90>=n;n++)t[n]=String.fromCharCode(n);for(var n=1;12>=n;n++)t[n+111]=t[n+63235]="F"+n;return a.prototype={normalize:function(e){return this.options.multi!==!1?e.split(/ +(?!\'$)/).map(i):[i(e)]},addBinding:function(e,t){for(var n=this.normalize(e),r=0;r<n.length;r++){var o=n.slice(0,r+1).join(" "),i=r==n.length-1?t:"...",a=this.bindings[o];if(a){if(a!=i)throw new Error("Inconsistent bindings for "+o)}else this.bindings[o]=i}},addBindings:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&this.addBinding(t,e[t])},removeBinding:function(e){for(var t=this.normalize(e),n=t.length-1;n>=0;n--){var r=t.slice(0,n).join(" "),o=this.bindings[r];if("..."==o&&!this.unusedMulti(r))break;o&&delete this.bindings[r]}},unusedMulti:function(e){for(var t in this.bindings)if(t.length>e&&0==t.indexOf(e)&&" "==t.charAt(e.length))return!1;return!0},lookup:function(e,t){return this.options.call?this.options.call(e,t):this.bindings[e]},reverseLookup:function(e){for(var t in this.bindings)if(this.bindings[t]==e)return t},constructor:a},a.keyName=r,a.isModifierKey=o,a.normalizeKeyName=i,a})},{}],2:[function(e,t){"use strict";var r="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}",o="(?:(?:[0-9a-fA-F:]){1,4}(?:(?::(?:[0-9a-fA-F]){1,4}|:)){2,7})+",i=t.exports=function(e){return e=e||{},e.exact?new RegExp("(?:^"+r+"$)|(?:^"+o+"$)"):new RegExp("(?:"+r+")|(?:"+o+")","g")};i.v4=function(e){return e=e||{},e.exact?new RegExp("^"+r+"$"):new RegExp(r,"g")},i.v6=function(e){return e=e||{},e.exact?new RegExp("^"+o+"$"):new RegExp(o,"g")}},{}],3:[function(e,t,n){"use strict";function c(){}function f(e,t){var n=e.selection,r=n.$from,o=n.$to,a=n.node,s=t>0?o:r,u=a&&a.isBlock?s:s.depth?e.doc.resolve(t>0?s.after():s.before()):null;return u&&i(u,t)}function h(e,t){var n=e.selection,r=n.empty,o=n.node,i=n.$from,a=n.$to;if(!r&&!o)return!1;if(o&&o.isInline)return e.setSelection(new u(t>0?a:i)),!0;if(!o){var l=t>0?i.parent.childAfter(i.parentOffset):i.parent.childBefore(i.parentOffset),c=l.node,h=l.offset;if(c)return c.type.selectable&&h==i.parentOffset-(t>0?0:c.nodeSize)?(e.setSelection(new s(0>t?e.doc.resolve(i.pos-c.nodeSize):i)),!0):!1}var p=f(e,t);return p&&(p instanceof s||o)?(e.setSelection(p),!0):!1}function p(e){return function(t){var n=h(t,e);return n&&t.scrollIntoView(),n}}function d(e,t){var n=e.selection,r=n.empty,o=n.node,u=n.$from,l=n.$to;if(!r&&!o)return!1;var c=!0,h=0>t?u:l;if((!o||o.isInline)&&(e.flush(),c=a(e,h,t)),c){var p=f(e,t);if(p&&p instanceof s)return e.setSelection(p),!0}if(!o||o.isInline)return!1;var d=i(h,t);return d&&e.setSelection(d),!0}function m(e){return function(t){var n=d(t,e);return n!==!1&&t.scrollIntoView(),n}}var r=e("browserkeymap"),o=e("./selection"),i=o.findSelectionFrom,a=o.verticalMotionLeavesTextblock,s=o.NodeSelection,u=o.TextSelection,l=e("../util/browser"),v={Esc:c,Enter:c,"Ctrl-Enter":c,"Mod-Enter":c,"Shift-Enter":c,Backspace:l.ios?void 0:c,Delete:c,"Mod-B":c,"Mod-I":c,"Mod-Backspace":c,"Mod-Delete":c,"Shift-Backspace":c,"Shift-Delete":c,"Shift-Mod-Backspace":c,"Shift-Mod-Delete":c,"Mod-Z":c,"Mod-Y":c,"Shift-Mod-Z":c,"Ctrl-D":c,"Ctrl-H":c,"Ctrl-Alt-Backspace":c,"Alt-D":c,"Alt-Delete":c,"Alt-Backspace":c,Left:p(-1),"Mod-Left":p(-1),Right:p(1),"Mod-Right":p(1),Up:m(-1),Down:m(1)};l.mac&&(v["Alt-Left"]=p(-1),v["Alt-Right"]=p(1),v["Ctrl-Backspace"]=v["Ctrl-Delete"]=c);var y=new r(v);n.captureKeys=y},{"../util/browser":59,"./selection":18,browserkeymap:1}],4:[function(e,t,n){"use strict";function i(e){return/\w/.test(e)||e>""&&("�">e||e>"�")&&(s(e)||e.toUpperCase()!=e.toLowerCase()||r.test(e))}function a(e){return/\s/.test(e)?"space":i(e)?"word":"other"}function s(e){return e.charCodeAt(0)>=768&&o.test(e)}var r=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,o=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;n.isWordChar=i,n.charCategory=a,n.isExtendingChar=s},{}],5:[function(e,t,n){"use strict";function S(e,t,n){var r=e.doc.resolve(t),o=r.nodeBefore,a=r.nodeAfter,u=void 0;if(i(e.doc,t)){if(n===!1)return!0;var c=e.tr.join(t);return c.steps.length&&0==o.content.size&&!o.sameMarkup(a)&&r.parent.canReplace(r.index()-1,r.index())&&c.setNodeType(t-o.nodeSize,a.type,a.attrs),c.applyAndScroll(),!0}if(a.isTextblock&&(u=o.contentMatchAt(r.index()).findWrapping(a.type,a.attrs))){if(n===!1)return!0;for(var p=t+a.nodeSize,d=h.empty,m=u.length-1;m>=0;m--)d=h.from(u[m].type.create(u[m].attrs,d));return d=h.from(o.copy(d)),e.tr.step(new l(t-1,p,t,p,new f(d,1,0),u.length,!0)).join(p+2*u.length,1,!0).applyAndScroll(),!0}var v=b(r,1),y=v.$from.blockRange(v.$to),g=y&&s(y);return null==g?!1:(n!==!1&&e.tr.lift(y,g).applyAndScroll(),!0)}function C(e,t){if("char"!=t&&"word"!=t)throw new RangeError("Unknown motion unit: "+t);for(var n=e.parent,r=e.parentOffset,o=null,i=0,a=e.pos;;){if(0==r)return a;var s=n.childBefore(r),u=s.offset,l=s.node;if(!l)return a;if(!l.isText)return o?a:a-1;if("char"==t)for(var c=r-u;c>0;c--){if(!y(l.text.charAt(c-1)))return a-1;r--,a--}else if("word"==t)for(var f=r-u;f>0;f--){var h=v(l.text.charAt(f-1));if(null==o||1==i&&"space"==o)o=h;else if(o!=h)return a;r--,a--,i++}}}function O(e,t){if("char"!=t&&"word"!=t)throw new RangeError("Unknown motion unit: "+t);for(var n=e.parent,r=e.parentOffset,o=e.pos,i=null,a=0;;){if(r==n.content.size)return o;var s=n.childAfter(r),u=s.offset,l=s.node;if(!l)return o;if(!l.isText)return i?o:o+1;if("char"==t)for(var c=r-u;c<l.text.length;c++){if(!y(l.text.charAt(c+1)))return o+1;r++,o++}else if("word"==t)for(var f=r-u;f<l.text.length;f++){var h=v(l.text.charAt(f));if(null==i||1==a&&"space"==i)i=h;else if(i!=h)return o;r++,o++,a++}}}function T(e){var t=e.selection,n=t.node,r=t.to;return n?i(e.doc,r)?r:null:o(e.doc,r,1)}function M(e,t,n,r,o){for(var i=h.empty,a=n.length-1;a>=0;a--)i=h.from(n[a].type.create(n[a].attrs,i));e.step(new l(t.start-(r?2:0),t.end,t.start,t.end,new f(i,0,0),n.length,!0));for(var s=0,c=0;c<n.length;c++)n[c].type==o&&(s=c+1);for(var p=n.length-s,d=t.start+n.length-(r?2:0),m=t.parent,v=t.startIndex,y=t.endIndex,g=!0;y>v;v++,g=!1)!g&&u(e.doc,d,p)&&e.split(d,p),d+=m.child(v).nodeSize+(g?0:2*p);return e}function A(e,t,n,r){var o=!1;return e.nodesBetween(t,n,function(e){return o?!1:void(o=e.isTextblock&&e.contentMatchAt(0).allowsMark(r))}),o}var r=e("../transform"),o=r.joinPoint,i=r.joinable,a=r.findWrapping,s=r.liftTarget,u=r.canSplit,l=r.ReplaceAroundStep,c=e("../model"),f=c.Slice,h=c.Fragment,p=c.NodeRange,d=e("../util/browser"),m=e("./char"),v=m.charCategory,y=m.isExtendingChar,g=e("./selection"),b=g.findSelectionFrom,k=g.TextSelection,w=g.NodeSelection,x=Object.create(null);n.commands=x,x.chainCommands=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return function(e,n){for(var r=0;r<t.length;r++){var o=t[r](e,n);if(o!==!1)return o}return!1}},x.deleteSelection=function(e,t){return e.selection.empty?!1:(t!==!1&&e.tr.replaceSelection().applyAndScroll(),!0)},x.joinBackward=function(e,t){var n=e.selection,r=n.$head,o=n.empty;if(!o)return!1;if(r.parentOffset>0)return!1;for(var i=void 0,a=void 0,u=r.depth-1;!i&&u>=0;u--)r.index(u)>0&&(a=r.before(u+1),i=r.node(u).child(r.index(u)-1));if(!i){var l=r.blockRange(),c=l&&s(l);return null==c?!1:(t!==!1&&e.tr.lift(l,c).applyAndScroll(),!0)}if(i.type.isLeaf&&i.type.selectable&&0==r.parent.content.size){if(t!==!1){var f=e.tr.delete(a,a+r.parent.nodeSize);f.setSelection(new w(f.doc.resolve(a-i.nodeSize))),f.applyAndScroll()}return!0}return i.type.isLeaf?(t!==!1&&e.tr.delete(a-i.nodeSize,a).applyAndScroll(),!0):S(e,a,t)},x.joinForward=function(e,t){var n=e.selection,r=n.$head,o=n.empty;if(!o||r.parentOffset<r.parent.content.size)return!1;for(var i=void 0,a=void 0,s=r.depth-1;!i&&s>=0;s--){var u=r.node(s);r.index(s)+1<u.childCount&&(i=u.child(r.index(s)+1),a=r.after(s+1))}return i?i.type.isLeaf?(t!==!1&&e.tr.delete(a,a+i.nodeSize).applyAndScroll(),!0):S(e,a,!0):!1},x.deleteCharBefore=function(e,t){if(d.ios)return!1;var n=e.selection,r=n.$head,o=n.empty;if(!o||0==r.parentOffset)return!1;if(t!==!1){var i=C(r,"char");e.tr.delete(i,r.pos).applyAndScroll()}return!0},x.deleteWordBefore=function(e,t){var n=e.selection,r=n.$head,o=n.empty;if(!o||0==r.parentOffset)return!1;if(t!==!1){var i=C(r,"word");e.tr.delete(i,r.pos).applyAndScroll()}return!0},x.deleteCharAfter=function(e,t){var n=e.selection,r=n.$head,o=n.empty;if(!o||r.parentOffset==r.parent.content.size)return!1;if(t!==!1){var i=O(r,"char");e.tr.delete(r.pos,i).applyAndScroll()}return!0},x.deleteWordAfter=function(e,t){var n=e.selection,r=n.$head,o=n.empty;if(!o||r.parentOffset==r.parent.content.size)return!1;if(t!==!1){var i=O(r,"word");e.tr.delete(r.pos,i).applyAndScroll()}return!0},x.joinUp=function(e,t){var n=e.selection,r=n.node,a=n.from,s=void 0;if(r){if(r.isTextblock||!i(e.doc,a))return!1;s=a}else if(s=o(e.doc,a,-1),null==s)return!1;if(t!==!1){var u=e.tr.join(s);e.selection.node&&u.setSelection(new w(u.doc.resolve(s-e.doc.resolve(s).nodeBefore.nodeSize))),u.applyAndScroll()}return!0},x.joinDown=function(e,t){var n=e.selection.node,r=e.selection.from,o=T(e);if(!o)return!1;if(t!==!1){var i=e.tr.join(o);n&&i.setSelection(new w(i.doc.resolve(r))),i.applyAndScroll()}return!0},x.lift=function(e,t){var n=e.selection,r=n.$from,o=n.$to,i=r.blockRange(o),a=i&&s(i);return null==a?!1:(t!==!1&&e.tr.lift(i,a).applyAndScroll(),!0)},x.newlineInCode=function(e,t){var n=e.selection,r=n.$from,o=n.$to,i=n.node;return i?!1:!r.parent.type.isCode||o.pos>=r.end()?!1:(t!==!1&&e.tr.typeText("\n").applyAndScroll(),!0)},x.createParagraphNear=function(e,t){var n=e.selection,r=n.$from,o=n.$to,i=n.node;if(!i||!i.isBlock)return!1;var a=r.parent.defaultContentType(o.indexAfter());if(!a||!a.isTextblock)return!1;if(t!==!1){var s=(r.parentOffset?o:r).pos,u=e.tr.insert(s,a.createAndFill());u.setSelection(new k(u.doc.resolve(s+1))),u.applyAndScroll()}return!0},x.liftEmptyBlock=function(e,t){var n=e.selection,r=n.$head,o=n.empty;if(!o||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){var i=r.before();if(u(e.doc,i))return t!==!1&&e.tr.split(i).applyAndScroll(),!0}var a=r.blockRange(),l=a&&s(a);return null==l?!1:(t!==!1&&e.tr.lift(a,l).applyAndScroll(),!0)},x.splitBlock=function(e,t){var n=e.selection,r=n.$from,o=n.$to,i=n.node;if(i&&i.isBlock)return r.parentOffset&&u(e.doc,r.pos)?(t!==!1&&e.tr.split(r.pos).applyAndScroll(),!0):!1;if(t===!1)return!0;var a=o.parentOffset==o.parent.content.size,s=e.tr.delete(r.pos,o.pos),l=0==r.depth?null:r.node(-1).defaultContentType(r.indexAfter(-1)),c=a?l:null,f=u(s.doc,r.pos,1,c);return c||f||!u(s.doc,r.pos,1,l)||(c=l,f=!0),f&&(s.split(r.pos,1,c),a||r.parentOffset||r.parent.type==l||s.setNodeType(r.before(),l)),s.applyAndScroll(),!0},x.selectParentNode=function(e,t){var n=e.selection,r=void 0;if(n.node){if(!n.$from.depth)return!1;r=n.$from.before()}else{var o=n.$head.sameDepth(n.$anchor);if(0==o)return!1;r=n.$head.before(o)}return t!==!1&&e.setNodeSelection(r),!0},x.undo=function(e,t){return 0==e.history.undoDepth?!1:(t!==!1&&(e.scrollIntoView(),e.history.undo()),!0)},x.redo=function(e,t){return 0==e.history.redoDepth?!1:(t!==!1&&(e.scrollIntoView(),e.history.redo()),!0)},x.wrapIn=function(e,t){return function(n,r){var o=n.selection,i=o.$from,s=o.$to,u=i.blockRange(s),l=u&&a(u,e,t);return l?(r!==!1&&n.tr.wrap(u,l).applyAndScroll(),!0):!1}},x.setBlockType=function(e,t){return function(n,r){var o=n.selection,i=o.$from,a=o.$to,s=o.node,u=void 0;if(s)u=i.depth;else{if(!i.depth||a.pos>i.end())return!1;u=i.depth-1}var l=s||i.parent;if(!l.isTextblock||l.hasMarkup(e,t))return!1;var c=i.index(u);if(!i.node(u).canReplaceWith(c,c+1,e))return!1;if(r!==!1){var f=i.before(u+1);n.tr.clearMarkupFor(f,e,t).setNodeType(f,e,t).applyAndScroll()}return!0}},x.wrapInList=function(e,t){return function(n,r){var o=n.selection,i=o.$from,s=o.$to,u=i.blockRange(s),l=!1,c=u;if(u.depth>=2&&i.node(u.depth-1).type.compatibleContent(e)&&0==u.startIndex){if(0==i.index(u.depth-1))return!1;var f=n.doc.resolve(u.start-2);c=new p(f,f,u.depth),u.endIndex<u.parent.childCount&&(u=new p(i,n.doc.resolve(s.end(u.depth)),u.depth)),l=!0}var h=a(c,e,t,u);return h?(r!==!1&&M(n.tr,u,h,l,e).applyAndScroll(),!0):!1}},x.splitListItem=function(e){return function(t){var n=t.selection,r=n.$from,o=n.$to,i=n.node;if(i&&i.isBlock||!r.parent.content.size||r.depth<2||!r.sameParent(o))return!1;var a=r.node(-1);if(a.type!=e)return!1;var s=o.pos==r.end()?a.defaultContentType(r.indexAfter(-1)):null,l=t.tr.delete(r.pos,o.pos);return u(l.doc,r.pos,2,s)?(l.split(r.pos,2,s).applyAndScroll(),!0):!1}},x.liftListItem=function(e){return function(t,n){var r=t.selection,o=r.$from,i=r.$to,a=o.blockRange(i,function(t){return t.childCount&&t.firstChild.type==e});if(!a||a.depth<2||o.node(a.depth-1).type!=e)return!1;if(n!==!1){var u=t.tr,c=a.end,d=i.end(a.depth);d>c&&(u.step(new l(c-1,d,c,d,new f(h.from(e.create(null,a.parent.copy())),1,0),1,!0)),a=new p(u.doc.resolveNoCache(o.pos),u.doc.resolveNoCache(d),a.depth)),u.lift(a,s(a)).applyAndScroll()}return!0}},x.sinkListItem=function(e){return function(t,n){var r=t.selection,o=r.$from,i=r.$to,a=o.blockRange(i,function(t){return t.childCount&&t.firstChild.type==e});if(!a)return!1;var s=a.startIndex;if(0==s)return!1;var u=a.parent,c=u.child(s-1);if(c.type!=e)return!1;if(n!==!1){var p=c.lastChild&&c.lastChild.type==u.type,d=h.from(p?e.create():null),m=new f(h.from(e.create(null,h.from(u.copy(d)))),p?3:1,0),v=a.start,y=a.end;t.tr.step(new l(v-(p?3:1),y,v,y,m,1,!0)).applyAndScroll()}return!0}},x.toggleMark=function(e,t){return function(n,r){var o=n.selection,i=o.empty,a=o.from,s=o.to;return A(n.doc,a,s,e)?r===!1?!0:(i?e.isInSet(n.activeMarks())?n.removeActiveMark(e):n.addActiveMark(e.create(t)):n.doc.rangeHasMark(a,s,e)?n.tr.removeMark(a,s,e).applyAndScroll():n.tr.addMark(a,s,e.create(t)).applyAndScroll(),!0):!1}}},{"../model":38,"../transform":47,"../util/browser":59,"./char":4,"./selection":18}],6:[function(e){"use strict";var r=e("../util/dom"),o=r.insertCSS;o('\n\n.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror-content {\n  white-space: pre-wrap;\n}\n\n.ProseMirror-drop-target {\n  position: absolute;\n  width: 1px;\n  background: #666;\n  pointer-events: none;\n}\n\n.ProseMirror-content ul, .ProseMirror-content ol {\n  padding-left: 30px;\n  cursor: default;\n}\n\n.ProseMirror-content blockquote {\n  padding-left: 1em;\n  border-left: 3px solid #eee;\n  margin-left: 0; margin-right: 0;\n}\n\n.ProseMirror-content pre {\n  white-space: pre-wrap;\n}\n\n.ProseMirror-content li {\n  position: relative;\n  pointer-events: none; /* Don\'t do weird stuff with marker clicks */\n}\n.ProseMirror-content li > * {\n  pointer-events: auto;\n}\n\n.ProseMirror-nodeselection *::selection { background: transparent; }\n.ProseMirror-nodeselection *::-moz-selection { background: transparent; }\n\n.ProseMirror-selectednode {\n  outline: 2px solid #8cf;\n}\n\n/* Make sure li selections wrap around markers */\n\nli.ProseMirror-selectednode {\n  outline: none;\n}\n\nli.ProseMirror-selectednode:after {\n  content: "";\n  position: absolute;\n  left: -32px;\n  right: -2px; top: -2px; bottom: -2px;\n  border: 2px solid #8cf;\n  pointer-events: none;\n}\n\n')},{"../util/dom":61}],7:[function(e,t,n){"use strict";function m(e){return e.ensureOperation({readSelection:!1}),x(e,k(e))}function v(e,t){return x(e,w(e,t))}function y(e,t,n){var r=p(e,t,!0),o=r.node,i=r.offset,a=d(e,n),s=a.node,u=a.offset;if(o!=s)return null;for(;i;){var l=o.childNodes[i-1];if(1==l.nodeType&&l.hasAttribute("pm-offset"))break;--i}for(;u<o.childNodes.length;){var c=o.childNodes[u];if(1==c.nodeType&&c.hasAttribute("pm-offset"))break;++u}var h=e.root.getSelection(),m=null;h.anchorNode&&e.content.contains(h.anchorNode)&&(m=[{node:h.anchorNode,offset:h.anchorOffset}],f(h)||m.push({node:h.focusNode,offset:h.focusOffset}));var v=null,y=e.schema.parseDOM(o,{topNode:e.operation.doc.resolve(t).parent.copy(),from:i,to:u,preserveWhitespace:!0,editableContent:!0,findPositions:m});if(m&&null!=m[0].pos){var g=m[0].pos,b=m[1]&&m[1].pos;null==b&&(b=g),v={anchor:g,head:b}}return{doc:y,sel:v}}function g(e,t){for(var n=t||0;n<e.depth;n++)if(e.index(n)+1<e.node(n).childCount)return!1;return e.parentOffset==e.parent.content.size}function b(e,t){for(var n=t||0;n<e.depth;n++)if(e.index(0)>0)return!1;return 0==e.parentOffset}function k(e){var t=e.operation.sel,n=t.$from,r=t.$to;if(n.sameParent(r)&&n.parent.isTextblock&&n.parentOffset&&r.parentOffset<r.parent.content.size)return w(e,0);for(var o=0;;o++){var i=b(n,o+1),a=g(r,o+1);if(i||a||n.index(o)!=r.index(o)||r.node(o).isTextblock){var s=n.before(o+1),u=r.after(o+1);return i&&n.index(o)>0&&(s-=n.node(o).child(n.index(o)-1).nodeSize),a&&r.index(o)+1<r.node(o).childCount&&(u+=r.node(o).child(r.index(o)+1).nodeSize),{from:s,to:u}}}}function w(e,t){var n=e.operation.sel,r=n.$from,o=n.$to;if(!r.sameParent(o))return k(e);var i=Math.max(0,r.parentOffset-t),a=r.parent.content.size,s=Math.min(a,o.parentOffset+t);if(i>0&&(i=r.parent.childBefore(i).offset),a>s){var u=r.parent.childAfter(s);s=u.offset+u.node.nodeSize}var l=r.start();return{from:l+i,to:l+s}}function x(e,t){function m(e){if(!s)return!1;var n=l(e.resolve(t.from+s.head));if(s.anchor!=s.head&&n.$head){var r=e.resolve(t.from+s.anchor);r.parent.isTextblock&&(n=new c(r,n.$head))}return n}var n=e.operation;if(n.docSet)return e.markAllDirty(),!1;for(var r=void 0;!(r=y(e,t.from,t.to));)t={from:n.doc.resolve(t.from).before(),to:n.doc.resolve(t.to).after()};var o=r,i=o.doc,s=o.sel,f=n.doc.slice(t.from,t.to),h=C(f.content,i.content,t.from,n.sel.from);if(!h)return!1;var p=a(n.mappings,h.start),d=a(n.mappings,h.endA);if(p.deleted&&d.deleted)return!1;O(e,n.doc,h.start,h.endA);var v=i.resolveNoCache(h.start-t.from),g=i.resolveNoCache(h.endB-t.from),b=void 0,k=void 0;if(!v.sameParent(g)&&v.pos<i.content.size&&(b=u(i.resolve(v.pos+1),1,!0))&&b.head==g.pos)e.input.dispatchKey("Enter");else if(v.sameParent(g)&&v.parent.isTextblock&&null!=(k=S(i,v.pos,g.pos)))e.input.insertText(p.pos,d.pos,k,m);else{var w=i.slice(h.start-t.from,h.endB-t.from),x=e.tr.replace(p.pos,d.pos,w),T=m(x.doc);T&&x.setSelection(T),x.applyAndScroll()}return!0}function S(e,t,n){var r="",i=!0,a=null;return e.nodesBetween(t,n,function(e,s){if(e.isInline||!(t>s)){if(!e.isText)return i=!1;a?o.sameSet(a,e.marks)||(i=!1):a=e.marks,r+=e.text.slice(Math.max(0,t-s),n-s)}}),i?r:null}function C(e,t,n,r){var o=e.findDiffStart(t,n);if(!o)return null;var i=e.findDiffEnd(t,n+e.size,n+t.size),a=i.a,s=i.b;if(o>a){var u=o>=r&&r>=a?o-r:0;o-=u,s=o+(s-a),a=o}else if(o>s){var l=o>=r&&r>=s?o-r:0;o-=l,a=o+(a-s),s=o}return{start:o,endA:a,endB:s}}function O(e,t,n,r){var o=t.resolve(n),i=t.resolve(r),a=o.sameDepth(i);0==a?e.markAllDirty():e.markRangeDirty(o.before(a),o.after(a),t)}var r=e("../model"),o=r.Mark,i=e("../transform"),a=i.mapThroughResult,s=e("./selection"),u=s.findSelectionFrom,l=s.findSelectionNear,c=s.TextSelection,f=s.isCollapsed,h=e("./dompos"),p=h.DOMFromPos,d=h.DOMFromPosFromEnd;n.readInputChange=m,n.readCompositionChange=v},{"../model":38,"../transform":47,"./dompos":8,"./selection":18}],8:[function(e,t,n){"use strict";function i(e){return e.classList.contains("ProseMirror-content")}function a(e){for(var t=0,n=0,r=e;!i(r);r=r.parentNode){var o=r.getAttribute("pm-offset");o&&(t+=+o+n,n=1)}return t}function u(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];null==t&&(t=Array.prototype.indexOf.call(e.parentNode.childNodes,e),e=e.parentNode);for(var r=0,o=void 0;;){var u=0;if(3==e.nodeType)r+=t;else{if(o=e.getAttribute("pm-offset")&&!l(e)){var c=+e.getAttribute("pm-size");r=1!=e.nodeType||e.firstChild?t==e.childNodes.length?c:Math.min(r,c):n>0?c:0;var f=s.inLeaf=a(e);return s.pos=f+r,s}if(e.hasAttribute("pm-container"))break;t==e.childNodes.length&&(u=t?1:n>0?1:0)}var h=e.parentNode;t=0>u?0:Array.prototype.indexOf.call(h.childNodes,e)+u,e=h,n=0}for(var p=i(e)?0:a(e)+1,d=0,m=e.childNodes[t-1];m;m=m.previousSibling)if(1==m.nodeType&&(o=m.getAttribute("pm-offset"))){d+=+o+ +m.getAttribute("pm-size");break}return s.inLeaf=-1,s.pos=p+d+r,s}function l(e){return e.hasAttribute("pm-container")?e:e.querySelector("[pm-container]")}function c(e,t,n){if(!n&&e.operation&&e.doc!=e.operation.doc)throw new RangeError("Resolving a position in an outdated DOM structure");for(var r=e.content,o=t;;)for(var i=r.firstChild,a=0;;i=i.nextSibling,a++){if(!i){if(o&&!n)throw new RangeError("Failed to find node at "+t);return{node:r,offset:a}}var s=1==i.nodeType&&i.getAttribute("pm-size");if(s){if(!o)return{node:r,offset:a};if(s=+s,s>o){if(r=l(i)){o--;break}return p(i,o)}o-=s}}}function f(e,t){for(var n=e.content,r=(e.operation?e.operation.doc:e.doc).content.size-t;;)for(var o=n.lastChild,i=n.childNodes.length;;o=o.previousSibling,i--){if(!o)return{node:n,offset:i};var a=1==o.nodeType&&o.getAttribute("pm-size");if(a){if(!r)return{node:n,offset:i};if(a=+a,a>r){if(n=l(o)){r--;break}return p(o,a-r)}r-=a}}}function h(e,t){var n=c(e,t),r=n.node,o=n.offset;if(1!=r.nodeType||o==r.childNodes.length)throw new RangeError("No node after pos "+t);return r.childNodes[o]}function p(e,t){for(;;){var n=e.firstChild;if(!n)return{node:e,offset:t};if(1!=n.nodeType)return{node:n,offset:t};e=n}}function d(){return{left:0,right:window.innerWidth,top:0,bottom:window.innerHeight}}function m(e){var t=e.parentNode;return 11==t.nodeType?t.host:t}function v(e,t){t||(t=e.sel.range.head||e.sel.range.from);for(var n=S(e,t),r=e.content;;r=m(r)){var o=e.options,i=o.scrollThreshold,a=o.scrollMargin,s=r==document.body,u=s?d():r.getBoundingClientRect(),l=0,c=0;if(n.top<u.top+i?c=-(u.top-n.top+a):n.bottom>u.bottom-i&&(c=n.bottom-u.bottom+a),n.left<u.left+i?l=-(u.left-n.left+a):n.right>u.right-i&&(l=n.right-u.right+a),(l||c)&&(s?window.scrollBy(l,c):(c&&(r.scrollTop+=c),l&&(r.scrollLeft+=l))),s)break}}function y(e,t){for(var n=void 0,r=2e8,o=void 0,i=0,a=e.firstChild,s=0;a;a=a.nextSibling,s++){var u=void 0;if(1==a.nodeType)u=a.getClientRects();else{if(3!=a.nodeType)continue;u=w(a).getClientRects()}for(var l=0;l<u.length;l++){var c=u[l];if(c.top<=t.top&&c.bottom>=t.top){var f=c.left>t.left?c.left-t.left:c.right<t.left?t.left-c.right:0;if(r>f){n=a,r=f,o=f&&3==n.nodeType?{left:c.right<t.left?c.right:c.left,top:t.top}:t,1==a.nodeType&&f&&(i=s+(t.left>=(c.left+c.right)/2?1:0));continue}}!n&&(t.left>=c.right||t.left>=c.left&&t.top>=c.bottom)&&(i=l+1)}}return n&&3==n.nodeType?g(n,o):!n||r&&1==n.nodeType?{node:e,offset:i}:y(n,o)}function g(e,t){for(var n=e.nodeValue.length,r=document.createRange(),o=0;n>o;o++){r.setEnd(e,o+1),r.setStart(e,o);var i=x(r,1);if(i.top!=i.bottom&&i.left-1<=t.left&&i.right+1>=t.left&&i.top-1<=t.top&&i.bottom+1>=t.top)return{node:e,offset:o+(t.left>=(i.left+i.right)/2?1:0)}}return{node:e,offset:0}}function b(e,t){if(/^[uo]l$/i.test(e.nodeName))for(var n=e.firstChild;n;n=n.nextSibling)if(1==n.nodeType&&n.hasAttribute("pm-offset")&&/^li$/i.test(n.nodeName)){var r=n.getBoundingClientRect();if(t.left>r.left-2)break;if(r.top<=t.top&&r.bottom>=t.top)return n}return e}function k(e,t){var n=b(e.root.elementFromPoint(t.left,t.top+1),t);if(!o(e.content,n))return null;var r=y(n,t),i=r.node,a=r.offset,s=-1;if(1==i.nodeType&&!i.firstChild){var l=i.getBoundingClientRect();s=l.left!=l.right&&t.left>(l.left+l.right)/2?1:-1}return u(i,a,s)}function w(e,t,n){var r=document.createRange();return r.setEnd(e,null==n?e.nodeValue.length:n),r.setStart(e,t||0),r}function x(e,t){var n=e.getClientRects();return n.length?n[0>t?0:n.length-1]:e.getBoundingClientRect()}function S(e,t){var n=c(e,t),r=n.node,o=n.offset,i=void 0,a=void 0;if(3==r.nodeType)o<r.nodeValue.length&&(a=x(w(r,o,o+1),-1),i="left"),a&&a.left!=a.right||!o||(a=x(w(r,o-1,o),1),i="right");else if(r.firstChild){if(o<r.childNodes.length){var s=r.childNodes[o];a=x(3==s.nodeType?w(s):s,-1),i="left"}if((!a||a.top==a.bottom)&&o){var u=r.childNodes[o-1];a=x(3==u.nodeType?w(u):u,1),i="right"}}else a=r.getBoundingClientRect(),i="left";var l=a[i];return{top:a.top,bottom:a.bottom,left:l,right:l}}var r=e("../util/dom"),o=r.contains,s={pos:0,inLeaf:-1};n.posFromDOM=u,n.childContainer=l,n.DOMFromPos=c,n.DOMFromPosFromEnd=f,n.DOMAfterPos=h,n.scrollIntoView=v,n.posAtCoords=k,n.coordsAtPos=S},{"../util/dom":61}],9:[function(e,t,n){"use strict";function c(e){return{pos:0,onRender:function(e,t,n,r){return e.isBlock&&(null!=r&&t.setAttribute("pm-offset",r),t.setAttribute("pm-size",e.nodeSize),e.isTextblock&&p(t,e),e.type&&e.type.readonly&&t.setAttribute("contenteditable","false")),t},onContainer:function(e){e.setAttribute("pm-container",!0)},renderInlineFlat:function(t,n,r,i){1!=n.nodeType&&(n=o("span",null,n));for(var a=r+t.nodeSize,s=void 0;;){e.advanceTo(r);var u=e.nextChangeBefore(a),l=void 0,c=void 0;if(u>-1?(c=u-r,l=f(n,c)):c=a-r,n.setAttribute("pm-offset",i),n.setAttribute("pm-size",c),e.current.length&&(n.className=e.current.join(" ")),!s&&(u>-1||e.element)&&(s=document.createDocumentFragment()),e.element&&s.appendChild(o("span",{contenteditable:!1,"pm-ignore":!0},e.element)),s&&s.appendChild(n),-1==u)break;i+=c,r+=c,n=l}return s||n},document:document}}function f(e,t){if(3==e.nodeType){var n=document.createTextNode(e.nodeValue.slice(t));return e.nodeValue=e.nodeValue.slice(0,t),n}var r=e.cloneNode(!1);return r.appendChild(f(e.firstChild,t)),r}function h(e,t){e.content.textContent="",e.content.appendChild(t.content.toDOM(c(e.ranges.activeRangeTracker())))}function p(e,t){var n=0==t.content.size||t.lastChild.type.isBR||t.type.isCode&&t.lastChild.isText&&/\n$/.test(t.lastChild.text)?"br":!t.lastChild.isText&&t.lastChild.type.isLeaf?"text":null,r=e.lastChild,i=r&&1==r.nodeType&&r.hasAttribute("pm-ignore")?"BR"==r.nodeName?"br":"text":null;n!=i&&(i&&e.removeChild(r),n&&e.appendChild("br"==n?o("br",{"pm-ignore":"trailing-break"}):o("span",{"pm-ignore":"cursor-text"},"")))}function d(e,t,n){for(;t<e.childCount;t++){var r=e.child(t);if(r==n)return t}return-1}function m(e){var t=e.nextSibling;return e.parentNode.removeChild(e),t}function v(e,t,n,r){function a(e,n,r,u){function g(){for(;v;){var e=1==v.nodeType&&v.getAttribute("pm-offset");if(e&&!(f>+e))return+e==f;v=m(v)}return!1}for(var c=0,f=0,h=r.firstChild,v=e.firstChild,b=0,k=0;b<n.childCount;b++){var w=n.child(b),x=void 0,S=void 0,C=h==w?c:d(r,c+1,w);if(C>-1)for(x=w;c!=C;)f+=h.nodeSize,h=r.maybeChild(++c);if(x&&!t.get(x)&&g())S=!0;else if(h&&!w.isText&&w.sameMarkup(h)&&t.get(h)!=l&&g())S=!0,h.type.isLeaf||a(s(v),w,h,u+k+1),v.setAttribute("pm-size",w.nodeSize);else{o.pos=u+k,o.offset=k;var O=w.toDOM(o);e.insertBefore(O,v),S=!1}if(S){if(w.isText)for(var T=k,M=T+w.nodeSize;M>T;)k!=f&&v.setAttribute("pm-offset",T),T+=+v.getAttribute("pm-size"),v=v.nextSibling;else k!=f&&v.setAttribute("pm-offset",k),v=v.nextSibling;f+=h.nodeSize,h=r.maybeChild(++c)}k+=w.nodeSize}for(;v;)v=m(v);n.isTextblock&&p(e,n),i.ios&&y(e)}if(t.get(r)==l)return h(e,n);var o=c(e.ranges.activeRangeTracker());a(e.content,n,r,0)}function y(e){if("UL"==e.nodeName||"OL"==e.nodeName){var t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}var r=e("../util/dom"),o=r.elt,i=e("../util/browser"),a=e("./dompos"),s=a.childContainer,u=1,l=2;n.DIRTY_RESCAN=u,n.DIRTY_REDRAW=l,n.draw=h,n.redraw=v},{"../util/browser":59,"../util/dom":61,"./dompos":8}],10:[function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../transform"),u=s.Transform,l=s.Remapping,c=500,f=function(){function e(t){a(this,e),this.events=0,this.maxEvents=t,this.items=[new p]}return r(e,[{key:"popEvent",value:function(e,t,n){for(var r=t,o=new u(e),i=new v,a=void 0,s=[],l=this.items.length;;){var c=this.items[--l];if(n&&c==n)break;if(!c.map)return null;if(c.step){if(r){var f=c.step.map(i.remap),h=void 0;this.items[l]=new m(c.map),f&&o.maybeStep(f).doc&&(h=o.maps[o.maps.length-1],this.items.push(new m(h,this.items[l].id))),i.movePastStep(c,h)}else this.items.pop(),o.maybeStep(c.step);if(s.push(c.id),c.selection&&(this.events--,!n)){a=c.selection.type.mapToken(c.selection,i.remap);break}}else i.add(c),r=!0}return{transform:o,selection:a,ids:s}}},{key:"clear",value:function(){this.items.length=1,this.events=0}},{key:"addTransform",value:function(e,t,n){for(var r=0;r<e.steps.length;r++){var o=e.steps[r].invert(e.docs[r]);this.items.push(new d(e.maps[r],n&&n[r],o,t)),t&&(this.events++,t=null)}this.events>this.maxEvents&&this.clip()}},{key:"clip",value:function(){for(var e=0,t=this.events-this.maxEvents,n=0;;n++){var r=this.items[n];if(r.selection){if(!(t>e))return this.items.splice(0,n,new p(null,this.events[t-1])),void(this.events=this.maxEvents);++e}}}},{key:"addMaps",value:function(e){if(0!=this.events)for(var t=0;t<e.length;t++)this.items.push(new m(e[t]))}},{key:"findChangeID",value:function(e){if(e==this.items[0].id)return this.items[0];for(var t=this.items.length-1;t>=0;t--){var n=this.items[t];if(n.step){if(n.id==e)return n;if(n.id<e)return null}}}},{key:"rebased",value:function(e,t,n){if(0!=this.events){var r=[],o=this.items.length-n.length,i=0;if(1>o&&(i=1-o,o=1,this.items[0]=new p),n.length){for(var a=new l([],e.slice()),s=o,u=i;s<this.items.length;s++){var f=this.items[s],h=n[u++],v=void 0;if(-1!=h){var y=t.maps[h];if(f.step){var g=t.steps[h].invert(t.docs[h]),b=f.selection&&f.selection.type.mapToken(f.selection,a);r.push(new d(y,f.id,g,b))}else r.push(new m(y));v=a.addToBack(y)}a.addToFront(f.map.invert(),v)}this.items.length=o}for(var k=0;k<e.length;k++)this.items.push(new m(e[k]));for(var w=0;w<r.length;w++)this.items.push(r[w]);!this.compressing&&this.emptyItems(o)+e.length>c&&this.compress(o+e.length)}}},{key:"emptyItems",value:function(e){for(var t=0,n=1;e>n;n++)this.items[n].step||t++;return t}},{key:"compress",value:function(e){for(var t=new v,n=[],r=0,o=this.items.length-1;o>=0;o--){var i=this.items[o];if(o>=e)n.push(i);else if(i.step){var a=i.step.map(t.remap),s=a&&a.posMap();if(t.movePastStep(i,s),a){var u=i.selection&&i.selection.type.mapToken(i.selection,t.remap);n.push(new d(s.invert(),i.id,a,u)),u&&r++}}else i.map?t.add(i):n.push(i)}this.items=n.reverse(),this.events=r}},{key:"toString",value:function(){return this.items.join("\n")}},{key:"changeID",get:function(){for(var e=this.items.length-1;e>0;e--)if(this.items[e].step)return this.items[e].id;return this.items[0].id}}]),e}(),h=1,p=function(){function e(t,n){a(this,e),this.map=t,this.id=n||h++}return r(e,[{key:"toString",value:function(){return this.id+":"+(this.map||"")+(this.step?":"+this.step:"")+(null!=this.mirror?"->"+this.mirror:"")}}]),e}(),d=function(e){function t(e,n,r,i){a(this,t);var s=o(this,Object.getPrototypeOf(t).call(this,e,n));return s.step=r,s.selection=i,s}return i(t,e),t}(p),m=function(e){function t(e,n){a(this,t);var r=o(this,Object.getPrototypeOf(t).call(this,e));return r.mirror=n,r}return i(t,e),t}(p),v=function(){function e(){a(this,e),this.remap=new l,this.mirrorBuffer=Object.create(null)}return r(e,[{key:"add",value:function(e){var t=this.remap.addToFront(e.map,this.mirrorBuffer[e.id]);return null!=e.mirror&&(this.mirrorBuffer[e.mirror]=t),t}},{key:"movePastStep",value:function(e,t){var n=this.add(e);t&&this.remap.addToBack(t,n)}}]),e}(),y=function(){function e(t){a(this,e),this.pm=t,this.done=new f(t.options.historyDepth),this.undone=new f(t.options.historyDepth),this.lastAddedAt=0,this.ignoreTransform=!1,this.preserveItems=0,t.on.transform.add(this.recordTransform.bind(this))}return r(e,[{key:"recordTransform",value:function(e,t,n){if(!this.ignoreTransform)if(0==n.addToHistory)this.done.addMaps(e.maps),this.undone.addMaps(e.maps);else{var r=Date.now(),o=r>this.lastAddedAt+this.pm.options.historyEventDelay;this.done.addTransform(e,o?t.token:null),this.undone.clear(),this.lastAddedAt=r}}},{key:"undo",value:function(){return this.shift(this.done,this.undone)}},{key:"redo",value:function(){return this.shift(this.undone,this.done)}},{key:"shift",value:function(e,t){var n=e.popEvent(this.pm.doc,this.preserveItems>0);if(!n)return!1;var r=this.pm.selection;if(!n.transform.steps.length)return this.shift(e,t);var o=n.selection.type.fromToken(n.selection,n.transform.doc);return this.applyIgnoring(n.transform,o),t.addTransform(n.transform,r.token,n.ids),this.lastAddedAt=0,!0}},{key:"applyIgnoring",value:function(e,t){this.ignoreTransform=!0,this.pm.apply(e,{selection:t,filter:!1}),this.ignoreTransform=!1}},{key:"getVersion",value:function(){return this.done.changeID}},{key:"isAtVersion",value:function(e){return this.done.changeID==e}},{key:"backToVersion",value:function(e){var t=this.done.findChangeID(e);if(!t)return!1;var n=this.done.popEvent(this.pm.doc,this.preserveItems>0,t),r=n.transform;return this.applyIgnoring(r),this.undone.clear(),!0}},{key:"rebased",value:function(e,t,n){this.done.rebased(e,t,n),this.undone.rebased(e,t,n)}},{key:"undoDepth",get:function(){return this.done.events}},{key:"redoDepth",get:function(){return this.undone.events}}]),e}();n.History=y},{"../transform":47}],11:[function(e,t,n){"use strict";n.ProseMirror=e("./main").ProseMirror;var r=e("./selection");n.Selection=r.Selection,n.TextSelection=r.TextSelection,n.NodeSelection=r.NodeSelection;var o=e("./range");n.MarkedRange=o.MarkedRange,n.baseKeymap=e("./keymap").baseKeymap;var i=e("./plugin");n.Plugin=i.Plugin,n.commands=e("./commands").commands,n.Keymap=e("browserkeymap")},{"./commands":5,"./keymap":13,"./main":14,"./plugin":16,"./range":17,"./selection":18,browserkeymap:1}],12:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){return e.contextAtCoords({left:t.clientX,top:t.clientY})}function T(e,t){for(var n=e.selection,r=n.node,o=n.$from,i=void 0,a=t.inside.length-1;a>=0;a--){var s=t.inside[a],u=s.pos,l=s.node;if(l.type.selectable){if(i=u,r&&o.depth>0){var c=e.doc.resolve(u);c.depth>=o.depth&&c.before(o.depth+1)==o.pos&&(i=c.before(o.depth))}break}}return null!=i?(e.setNodeSelection(i),e.focus(),!0):!1}function E(e,t){var n=t.x-e.clientX,r=t.y-e.clientY;return 100>n*n+r*r}function N(e,t){for(var n=t.inside.length-1;n>=0;n--){var r=t.inside[n],o=r.pos,i=r.node;if(i.isTextblock)e.setTextSelection(o+1,o+1+i.content.size);else{if(!i.type.selectable)continue;e.setNodeSelection(o)}e.focus();break}}function D(e,t,n){for(var r=t.inside.length-1;r>=0;r--)if(e.dispatch(t.pos,t.inside[r].node,t.inside[r].pos,n))return!0}function P(e){var t=e.input.composing;if(t)return t.ended&&e.input.applyComposition(!0),!0;var n=y(e);return e.flush(),n}function j(e){window.setTimeout(function(){P(e)||window.setTimeout(function(){return P(e)},80)},20)}function I(e,t,n,r){for(var o=e.resolve(t),i=t,a=o.depth;a>0&&o.end(a)==i;a--)i++;var s=e.slice(i,n);s.possibleParent.type!=e.type.schema.nodes.doc&&(s=new u(l.from(s.possibleParent.copy(s.content)),s.openLeft+1,s.openRight+1));var c=s.content.toDOM(),f=document.createElement("div");return c.firstChild&&1==c.firstChild.nodeType&&c.firstChild.setAttribute("pm-open-left",s.openLeft),f.appendChild(c),r.clearData(),r.setData("text/html",f.innerHTML),r.setData("text/plain",s.content.textBetween(0,s.content.size,"\n\n")),s}function B(e){return null!=z?z:(e.setData("text/html","<hr>"),z="<hr>"==e.getData("text/html"))}function L(e,t,n,r){var o=t.getData("text/plain"),i=t.getData("text/html");if(!i&&!o)return null;var a=void 0;!n&&i||!o?a=_(e.on.transformPastedHTML.dispatch(i)):(a=document.createElement("div"),e.on.transformPastedText.dispatch(o).split(/(?:\r\n?|\n){2,}/).forEach(function(e){var t=a.appendChild(document.createElement("p"));e.split(/\r\n?|\n/).forEach(function(e,n){n&&t.appendChild(document.createElement("br")),t.appendChild(document.createTextNode(e))})}));var s=null,u=void 0,l=a.querySelector("[pm-open-left]");l&&(u=/^\d+$/.exec(l.getAttribute("pm-open-left")))&&(s=+u[0]);var f=c(r,a,{openLeft:s,preserveWhiteSpace:!0});return e.on.transformPasted.dispatch(f)}function F(e,t){for(var n=e.pos,r=t.pos,o=t.depth;o>0&&t.end(o)==r;o--)r++;for(var i=e.depth;i>0&&e.start(i)==n&&e.end(i)<=r;i--)n--;return{from:n,to:r}}function _(e){var t=/(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));var n=document.createElement("div"),r=/(?:<meta [^>]*>)*<([a-z][^>\s]+)/i.exec(e),o=void 0,i=0;if(o=r&&q[r[1].toLowerCase()]){var a=o.split(" ");e=a.map(function(e){return"<"+e+">"}).join("")+e+a.map(function(e){return"</"+e+">"}).reverse().join(""),i=a.length}n.innerHTML=e;for(var s=0;i>s;s++)n=n.firstChild;return n}function V(e,t){if(!e||!e.content.size)return t.pos;for(var n=e.content,r=0;r<e.openLeft;r++)n=n.firstChild.content;for(var o=t.depth;o>=0;o--){var i=o==t.depth?0:t.pos<=(t.start(o+1)+t.end(o+1))/2?-1:1,a=t.index(o)+(i>0?1:0);if(t.node(o).canReplace(a,a,n))return 0==i?t.pos:0>i?t.before(o+1):t.after(o+1)}return t.pos}function H(e){e.input.dropTarget&&(e.wrapper.removeChild(e.input.dropTarget),e.input.dropTarget=null)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("browserkeymap"),a=e("../util/browser"),s=e("../model"),u=s.Slice,l=s.Fragment,c=s.parseDOMInContext,f=e("./capturekeys"),h=f.captureKeys,p=e("../util/dom"),d=p.elt,m=p.contains,v=e("./domchange"),y=v.readInputChange,g=v.readCompositionChange,b=e("./selection"),k=b.findSelectionNear,w=b.hasFocus,x=null,S={},C=function(){function e(t){var n=this;o(this,e),this.pm=t,this.keySeq=null,this.mouseDown=null,this.dragging=null,this.dropTarget=null,this.shiftKey=!1,this.finishComposing=null,this.keymaps=[],this.storedMarks=null;var r=function(e){var n=S[e];t.content.addEventListener(e,function(e){return n(t,e)})};for(var i in S)r(i);t.on.selectionChange.add(function(){return n.storedMarks=null})}return r(e,[{key:"dispatchKey",value:function(e,t){var n=this.pm,r=n.input.keySeq;if(r){if(i.isModifierKey(e))return!0;clearTimeout(x),x=setTimeout(function(){n.input.keySeq==r&&(n.input.keySeq=null)},50),e=r+" "+e}for(var o=function(e){return e===!1?"nothing":"..."==e?"multi":null==e?!1:0==e(n)?!1:"handled"},a=void 0,s=0;!a&&s<n.input.keymaps.length;s++)a=o(n.input.keymaps[s].map.lookup(e,n));return a||(a=o(h.lookup(e))),"multi"==a&&(n.input.keySeq=e),"handled"!=a&&"multi"!=a||!t||t.preventDefault(),r&&!a&&/\'$/.test(e)?(t&&t.preventDefault(),!0):!!a}},{key:"insertText",value:function(e,t,n,r){if(e!=t||n){var o=this.pm,i=o.input.storedMarks||o.doc.marksAt(e),a=o.tr.replaceWith(e,t,n?o.schema.text(n,i):null);a.setSelection(r&&r(a.doc)||k(a.doc.resolve(a.map(t)),-1,!0)),a.applyAndScroll(),n&&o.on.textInput.dispatch(n)}}},{key:"startComposition",value:function(e,t){this.pm.ensureOperation({noFlush:!0,readSelection:t}).composing={ended:!1,applied:!1,margin:e},this.pm.unscheduleFlush()}},{key:"applyComposition",value:function(e){var t=this.composing;t.applied||(g(this.pm,t.margin),t.applied=!0,e&&this.pm.flush())}},{key:"composing",get:function(){return this.pm.operation&&this.pm.operation.composing}}]),e}();n.Input=C,S.keydown=function(e,t){if(w(e)&&(e.on.interaction.dispatch(),16==t.keyCode&&(e.input.shiftKey=!0),!e.input.composing)){var n=i.keyName(t);n&&e.input.dispatchKey(n,t)||e.sel.fastPoll()}},S.keyup=function(e,t){16==t.keyCode&&(e.input.shiftKey=!1)},S.keypress=function(e,t){if(!(!w(e)||e.input.composing||!t.charCode||t.ctrlKey&&!t.altKey||a.mac&&t.metaKey||e.input.dispatchKey(i.keyName(t),t))){var n=e.selection;a.ios||(e.input.insertText(n.from,n.to,String.fromCharCode(t.charCode)),t.preventDefault())}};var M={time:0,x:0,y:0},A=M;S.mousedown=function(e,t){e.on.interaction.dispatch();var n=Date.now(),r=n-M.time<500&&E(t,M),o=r&&n-A.time<600&&E(t,A);A=M,M={time:n,x:t.clientX,y:t.clientY};var i=O(e,t);null!=i&&(o?(t.preventDefault(),N(e,i)):r?D(e.on.doubleClickOn,i,t)||e.on.doubleClick.dispatch(i.pos,t)?t.preventDefault():e.sel.fastPoll():e.input.mouseDown=new R(e,t,i,r))};var R=function(){function e(t,n,r,i){o(this,e),this.pm=t,this.event=n,this.context=r,this.leaveToBrowser=t.input.shiftKey||i,this.x=n.clientX,this.y=n.clientY;var s=r.inside[r.inside.length-1];this.mightDrag=s&&(s.node.type.draggable||s.node==t.sel.range.node)?s:null,this.target=n.target,this.mightDrag&&(m(t.content,this.target)||(this.target=t.root.elementFromPoint(this.x,this.y)),this.target.draggable=!0,a.gecko&&(this.setContentEditable=!this.target.hasAttribute("contentEditable"))&&this.target.setAttribute("contentEditable","false")),window.addEventListener("mouseup",this.up=this.up.bind(this)),window.addEventListener("mousemove",this.move=this.move.bind(this)),t.sel.fastPoll()}return r(e,[{key:"done",value:function(){window.removeEventListener("mouseup",this.up),window.removeEventListener("mousemove",this.move),this.mightDrag&&(this.target.draggable=!1,a.gecko&&this.setContentEditable&&this.target.removeAttribute("contentEditable"))}},{key:"up",value:function(e){if(this.done(),this.leaveToBrowser||!m(this.pm.content,e.target))return this.pm.sel.fastPoll();var t=O(this.pm,e);if(this.event.ctrlKey&&T(this.pm,t))e.preventDefault();else if(D(this.pm.on.clickOn,this.context,e)||this.pm.on.click.dispatch(this.context.pos,e))e.preventDefault();else{var n=this.context.inside[this.context.inside.length-1];n&&n.node.type.isLeaf&&n.node.type.selectable?(this.pm.setNodeSelection(n.pos),this.pm.focus()):this.pm.sel.fastPoll()}}},{key:"move",value:function(e){!this.leaveToBrowser&&(Math.abs(this.x-e.clientX)>4||Math.abs(this.y-e.clientY)>4)&&(this.leaveToBrowser=!0),this.pm.sel.fastPoll()}}]),e}();S.touchdown=function(e){e.sel.fastPoll()},S.contextmenu=function(e,t){var n=O(e,t);if(n){var r=n.inside[n.inside.length-1];e.on.contextMenu.dispatch(n.pos,r?r.node:e.doc,t)&&t.preventDefault()}},S.compositionstart=function(e,t){!e.input.composing&&w(e)&&e.input.startComposition(t.data?t.data.length:0,!0)},S.compositionupdate=function(e){!e.input.composing&&w(e)&&e.input.startComposition(0,!1)},S.compositionend=function(e,t){if(w(e)){var n=e.input.composing;if(n){if(n.applied)return}else{if(!t.data)return;e.input.startComposition(t.data.length,!1)}clearTimeout(e.input.finishComposing),e.operation.composing.ended=!0,e.input.finishComposing=window.setTimeout(function(){var t=e.input.composing;t&&t.ended&&e.input.applyComposition(!0)},20)}},S.input=function(e){w(e)&&P(e)};var z=null,q={thead:"table",colgroup:"table",col:"table colgroup",tr:"table tbody",td:"table tbody tr",th:"table tbody tr"};S.copy=S.cut=function(e,t){var n=e.selection,r=n.from,o=n.to,i=n.empty,s="cut"==t.type;if(!i){if(!t.clipboardData||!B(t.clipboardData))return void(s&&a.ie&&a.ie_version<=11&&j(e));I(e.doc,r,o,t.clipboardData),t.preventDefault(),s&&e.tr.delete(r,o).apply()}},S.paste=function(e,t){if(w(e)&&!e.on.domPaste.dispatch(t)){if(!t.clipboardData)return void(a.ie&&a.ie_version<=11&&j(e));var n=e.selection,r=F(n.$from,n.$to),o=L(e,t.clipboardData,e.input.shiftKey,e.doc.resolve(r.from));if(o){t.preventDefault();var i=e.tr.replace(r.from,r.to,o);i.setSelection(k(i.doc.resolve(i.map(r.to)),-1)),i.applyAndScroll()}}};var $=function W(e,t,n){o(this,W),this.slice=e,this.from=t,this.to=n};S.dragstart=function(e,t){var n=e.input.mouseDown;if(n&&n.done(),t.dataTransfer){var r=e.selection,o=r.from,i=r.to,a=r.empty,s=void 0,u=!a&&e.posAtCoords({left:t.clientX,top:t.clientY});if(null!=u&&u>=o&&i>=u)s={from:o,to:i};else if(n&&n.mightDrag){var l=n.mightDrag.pos;s={from:l,to:l+n.mightDrag.node.nodeSize}}if(s){var c=I(e.doc,s.from,s.to,t.dataTransfer);e.input.dragging=new $(c,s.from,s.to)}}},S.dragend=function(e){H(e),window.setTimeout(function(){return e.input.dragging=null},50)},S.dragover=S.dragenter=function(e,t){t.preventDefault();var n=e.input.dropTarget;n||(n=e.input.dropTarget=e.wrapper.appendChild(d("div",{"class":"ProseMirror-drop-target"})));var r=e.posAtCoords({left:t.clientX,top:t.clientY}),o=null==r?null:V(e.input.dragging&&e.input.dragging.slice,e.doc.resolve(r));if(null!=o){var i=e.coordsAtPos(o),a=e.wrapper.getBoundingClientRect();i.top-=a.top,i.right-=a.left,i.bottom-=a.top,i.left-=a.left,n.style.left=i.left-1+"px",n.style.top=i.top+"px",n.style.height=i.bottom-i.top+"px"}},S.dragleave=function(e,t){t.target==e.content&&H(e)},S.drop=function(e,t){var n=e.input.dragging;if(e.input.dragging=null,H(e),t.dataTransfer&&!e.on.domDrop.dispatch(t)){var r=e.doc.resolve(e.posAtCoords({left:t.clientX,top:t.clientY}));if(r){var o=F(r,r),i=n&&n.slice||L(e,t.dataTransfer,e.doc.resolve(o.from));if(i){var a=V(i,e.doc.resolve(o.from));t.preventDefault();var s=e.tr;n&&!t.ctrlKey&&null!=n.from&&s.delete(n.from,n.to);var u=s.map(a),l=void 0;if(s.replace(u,s.map(a),i).apply(),1==i.content.childCount&&0==i.openLeft&&0==i.openRight&&i.content.child(0).type.selectable&&(l=e.doc.nodeAt(u))&&l.sameMarkup(i.content.child(0)))e.setNodeSelection(u);else{var c=k(e.doc.resolve(u),1,!0).from,f=k(e.doc.resolve(s.map(a)),-1,!0).to;e.setTextSelection(c,f)}e.focus()}}}},S.focus=function(e){e.wrapper.classList.add("ProseMirror-focused"),e.on.focus.dispatch()},S.blur=function(e){e.wrapper.classList.remove("ProseMirror-focused"),e.on.blur.dispatch()}},{"../model":38,"../util/browser":59,"../util/dom":61,"./capturekeys":3,"./domchange":7,"./selection":18,browserkeymap:1}],13:[function(e,t,n){"use strict";var r=e("browserkeymap"),o=e("../util/browser"),i=e("./commands").commands,a=new r({Enter:i.chainCommands(i.newlineInCode,i.createParagraphNear,i.liftEmptyBlock,i.splitBlock),Backspace:i.chainCommands(i.deleteSelection,i.joinBackward,i.deleteCharBefore),"Mod-Backspace":i.chainCommands(i.deleteSelection,i.joinBackward,i.deleteWordBefore),Delete:i.chainCommands(i.deleteSelection,i.joinForward,i.deleteCharAfter),"Mod-Delete":i.chainCommands(i.deleteSelection,i.joinForward,i.deleteWordAfter),"Alt-Up":i.joinUp,"Alt-Down":i.joinDown,"Mod-[":i.lift,Esc:i.selectParentNode,"Mod-Z":i.undo,"Mod-Y":i.redo,"Shift-Mod-Z":i.redo});n.baseKeymap=a,o.mac&&a.addBindings({"Ctrl-H":a.lookup("Backspace"),"Alt-Backspace":a.lookup("Cmd-Backspace"),"Ctrl-D":a.lookup("Delete"),"Ctrl-Alt-Backspace":a.lookup("Cmd-Delete"),"Alt-Delete":a.lookup("Cmd-Delete"),"Alt-D":a.lookup("Cmd-Delete")})},{"../util/browser":59,"./commands":5,browserkeymap:1}],14:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){e.operation&&(e.dirtyNodes.size>0||e.operation.composing||e.operation.docSet)&&e.flush();var n=D(e,t);return n?e.operation?{pos:g(e.operation.mappings,n.pos),inLeaf:n.inLeaf<0?null:g(e.operation.mappings,n.inLeaf)}:n:null}function G(e){var t=e.selection.head;return null==t?k.none:e.doc.marksAt(t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e("./css");var i=e("../util/map"),a=i.Map,s=e("subscription"),u=s.Subscription,l=s.PipelineSubscription,c=s.StoppableSubscription,f=s.DOMSubscription,h=e("../util/dom"),p=h.requestAnimationFrame,d=h.cancelAnimationFrame,m=h.elt,v=h.ensureCSSAdded,y=e("../transform"),g=y.mapThrough,b=e("../model"),k=b.Mark,w=e("./options"),x=w.parseOptions,S=e("./selection"),C=S.SelectionState,O=S.TextSelection,T=S.NodeSelection,M=S.findSelectionAtStart,A=S.hasFocus,E=e("./dompos"),N=E.scrollIntoView,D=E.posAtCoords,R=E.coordsAtPos,P=e("./draw"),j=P.draw,I=P.redraw,z=P.DIRTY_REDRAW,B=P.DIRTY_RESCAN,L=e("./input"),F=L.Input,q=e("./history"),_=q.History,$=e("./range"),V=$.RangeStore,H=$.MarkedRange,W=e("./transform"),K=W.EditorTransform,J=e("./update"),U=J.EditorScheduler,Q=J.UpdateScheduler,Y=function(){function e(t){var n=this;if(o(this,e),v(),t=this.options=x(t),this.schema=t.schema||t.doc&&t.doc.type.schema,!this.schema)throw new RangeError("You must specify a schema option");if(null==t.doc&&(t.doc=this.schema.nodes.doc.createAndFill()),t.doc.type.schema!=this.schema)throw new RangeError("Schema option does not correspond to schema used in doc option");this.content=m("div",{"class":"ProseMirror-content","pm-container":!0}),this.wrapper=m("div",{"class":"ProseMirror"},this.content),this.wrapper.ProseMirror=this,this.on={change:new u,selectionChange:new u,textInput:new u,beforeSetDoc:new u,setDoc:new u,interaction:new u,focus:new u,blur:new u,click:new c,clickOn:new c,doubleClick:new c,doubleClickOn:new c,contextMenu:new c,transformPasted:new l,transformPastedText:new l,transformPastedHTML:new l,transform:new u,beforeTransform:new u,filterTransform:new c,flushing:new u,flush:new u,draw:new u,activeMarkChange:new u,domPaste:new f,domDrop:new f},t.place&&t.place.appendChild?t.place.appendChild(this.wrapper):t.place&&t.place(this.wrapper),this._root=null,this.setDocInner(t.doc),j(this,this.doc),this.content.contentEditable=!0,t.label&&this.content.setAttribute("aria-label",t.label),this.plugin=Object.create(null),this.cached=Object.create(null),this.operation=null,this.dirtyNodes=new a,this.flushScheduled=null,this.centralScheduler=new U(this),this.sel=new C(this,M(this.doc)),this.accurateSelection=!1,this.input=new F(this),this.addKeymap(this.options.keymap,-100),this.options.plugins.forEach(function(e){return e.attach(n)})}return r(e,[{key:"getOption",value:function(e){return this.options[e]}},{key:"setTextSelection",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?e:arguments[1],n=this.doc.resolve(e),r=this.doc.resolve(t);if(!n.parent.isTextblock||!r.parent.isTextblock)throw new RangeError("Setting text selection with an end not in a textblock");this.setSelection(new O(n,r))}},{key:"setNodeSelection",value:function(e){var t=this.doc.resolve(e),n=t.nodeAfter;if(!n||!n.type.selectable)throw new RangeError("Trying to create a node selection that doesn't point at a selectable node");this.setSelection(new T(t))}},{key:"setSelection",value:function(e){this.ensureOperation(),e.eq(this.sel.range)||this.sel.setAndSignal(e)}},{key:"setDocInner",value:function(e){if(e.type!=this.schema.nodes.doc)throw new RangeError("Trying to set a document with a different schema");this.doc=e,this.ranges=new V(this),this.history=new _(this)}},{key:"setDoc",value:function(e,t){t||(t=M(e)),this.on.beforeSetDoc.dispatch(e,t),this.ensureOperation(),this.setDocInner(e),this.operation.docSet=!0,this.sel.set(t,!0),this.on.setDoc.dispatch(e,t)}},{key:"updateDoc",value:function(e,t,n){this.ensureOperation(),this.ranges.transform(t),this.operation.mappings.push(t),this.doc=e,this.sel.setAndSignal(n||this.sel.range.map(e,t)),this.on.change.dispatch()}},{key:"apply",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?Z:arguments[1];if(!e.steps.length)return e;if(!e.docs[0].eq(this.doc))throw new RangeError("Applying a transform that does not start with the current document");if(t.filter!==!1&&this.on.filterTransform.dispatch(e))return e;var n=this.selection;return this.on.beforeTransform.dispatch(e,t),this.updateDoc(e.doc,e,t.selection||e.selection),this.on.transform.dispatch(e,n,t),t.scrollIntoView&&this.scrollIntoView(),e}},{key:"ensureOperation",value:function(e){return this.operation||this.startOperation(e)}},{key:"startOperation",value:function(e){var t=this;return this.operation=new et(this,e),e&&e.readSelection===!1||!this.sel.readFromDOM()||(this.operation.sel=this.sel.range),null==this.flushScheduled&&(this.flushScheduled=p(function(){return t.flush()})),this.operation}},{key:"unscheduleFlush",value:function(){null!=this.flushScheduled&&(d(this.flushScheduled),this.flushScheduled=null)}},{key:"flush",value:function(){this.unscheduleFlush();var e=this.root.body||this.root;if(!e.contains(this.wrapper)||!this.operation)return!1;this.on.flushing.dispatch();var t=this.operation,n=!1;return t?(t.composing&&this.input.applyComposition(),this.operation=null,this.accurateSelection=!0,(t.doc!=this.doc||this.dirtyNodes.size)&&(I(this,this.dirtyNodes,this.doc,t.doc),this.dirtyNodes.clear(),n=!0),(n||!t.sel.eq(this.sel.range)||t.focus)&&this.sel.toDOM(t.focus),t.scrollIntoView!==!1&&N(this,t.scrollIntoView),n&&this.on.draw.dispatch(),this.on.flush.dispatch(),this.accurateSelection=!1,n):!1}},{key:"addKeymap",value:function(e){for(var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=0,r=this.input.keymaps;n<r.length&&!(r[n].priority<t);n++);r.splice(n,0,{map:e,priority:t})}},{key:"removeKeymap",value:function(e){for(var t=this.input.keymaps,n=0;n<t.length;++n)if(t[n].map==e||t[n].map.options.name==e)return t.splice(n,1),!0}},{key:"markRange",value:function(e,t,n){var r=new H(e,t,n);return this.ranges.addRange(r),r}},{key:"removeRange",value:function(e){this.ranges.removeRange(e)}},{key:"activeMarks",value:function(){return this.input.storedMarks||G(this)}},{key:"addActiveMark",value:function(e){this.selection.empty&&(this.input.storedMarks=e.addToSet(this.input.storedMarks||G(this)),this.on.activeMarkChange.dispatch())}},{key:"removeActiveMark",value:function(e){this.selection.empty&&(this.input.storedMarks=e.removeFromSet(this.input.storedMarks||G(this)),this.on.activeMarkChange.dispatch())}},{key:"focus",value:function(){this.operation?this.operation.focus=!0:this.sel.toDOM(!0)}},{key:"hasFocus",value:function(){return this.sel.range instanceof T?this.root.activeElement==this.content:A(this)}},{key:"posAtCoords",value:function(e){var t=X(this,e);return t&&t.pos}},{key:"contextAtCoords",value:function(e){var t=X(this,e);if(!t)return null;for(var n=this.doc.resolve(-1==t.inLeaf?t.pos:t.inLeaf),r=[],o=1;o<=n.depth;o++)r.push({pos:n.before(o),node:n.node(o)});if(t.inLeaf>-1){var i=n.nodeAfter;i&&!i.isText&&i.type.isLeaf&&r.push({pos:t.inLeaf,node:i})}return{pos:t.pos,inside:r}}},{key:"coordsAtPos",value:function(e){return this.flush(),R(this,e)}},{key:"scrollIntoView",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this.ensureOperation(),this.operation.scrollIntoView=e}},{key:"markRangeDirty",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?this.doc:arguments[2];this.ensureOperation();for(var r=this.dirtyNodes,o=n.resolve(e),i=n.resolve(t),a=o.sameDepth(i),s=0;a>=s;s++){var u=o.node(s);r.has(u)||r.set(u,B)}for(var l=o.index(a),c=i.index(a)+(a==i.depth&&i.atNodeBoundary?0:1),f=o.node(a),h=l;c>h;h++)r.set(f.child(h),z)}},{key:"markAllDirty",value:function(){this.dirtyNodes.set(this.doc,z)}},{key:"translate",value:function(e){var t=this.options.translate;return t?t(e):e}},{key:"scheduleDOMUpdate",value:function(e){this.centralScheduler.set(e)}},{key:"unscheduleDOMUpdate",value:function(e){this.centralScheduler.unset(e)}},{key:"updateScheduler",value:function(e,t){return new Q(this,e,t)}},{key:"root",get:function(){var e=this._root;if(null==e)for(var t=this.wrapper.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return this._root=t;return e||document}},{key:"selection",get:function(){return this.accurateSelection||this.ensureOperation(),this.sel.range}},{key:"tr",get:function(){return new K(this)}}]),e}();n.ProseMirror=Y;var Z={},et=function tt(e,t){o(this,tt),this.doc=e.doc,this.docSet=!1,this.sel=t&&t.selection||e.sel.range,this.scrollIntoView=!1,this.focus=!1,this.mappings=[],this.composing=null}},{"../model":38,"../transform":47,"../util/dom":61,"../util/map":63,"./css":6,"./dompos":8,"./draw":9,"./history":10,"./input":12,"./options":15,"./range":17,"./selection":18,"./transform":19,"./update":20,subscription:66}],15:[function(e,t,n){"use strict";function a(e){var t=Object.create(null);for(var n in i)t[n]=Object.prototype.hasOwnProperty.call(e,n)?e[n]:i[n];return t}var r=e("./keymap"),o=r.baseKeymap,i=Object.create(null);i.schema=null,i.doc=null,i.place=null,i.historyDepth=100,i.historyEventDelay=500,i.scrollThreshold=0,i.scrollMargin=5,i.keymap=o,i.label=null,i.translate=null,i.plugins=[],n.parseOptions=a},{"./keymap":13}],16:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){for(var e=arguments.length<=0||void 0===arguments[0]?"plugin":arguments[0],t=1;;t++){var n=e+(t>1?"_"+t:"");if(!(n in i))return i[n]=n}}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=Object.create(null),s=function(){function e(t,n,r){o(this,e),this.State=t,this.options=n||Object.create(null),this.prop=r||a(t.name)}return r(e,[{key:"get",value:function(e){return e.plugin[this.prop]}},{key:"attach",value:function(e){if(this.get(e))throw new RangeError("Attaching plugin multiple times");return e.plugin[this.prop]=new this.State(e,this.options)}},{key:"detach",value:function(e){var t=this.get(e);t&&(t.detach&&t.detach(e),delete e.plugin[this.prop])}},{key:"ensure",value:function(e){return this.get(e)||this.attach(e)}},{key:"config",value:function(t){if(!t)return this;var n=Object.create(null);for(var r in this.options)n[r]=this.options[r];for(var o in t)n[o]=t[o];return new e(this.State,n,this.prop)}}]),e}();n.Plugin=s},{}],17:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){var t=e.range;return t.options.className&&t.from!=t.to||t.options.elementBefore&&"open"==e.type||t.options.elementAfter&&"close"==e.type}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r){o(this,e),this.options=r||{},this.from=t,this.to=n}return r(e,[{key:"remove",value:function(){this.options.onRemove&&this.options.onRemove(this.from,Math.max(this.to,this.from)),this.from=this.to=null}}]),e}();n.MarkedRange=i;var a=function(){function e(){o(this,e),this.sorted=[]}return r(e,[{key:"find",value:function(e){for(var t=0,n=this.sorted.length;;){if(t+10>n){for(var r=t;n>r;r++)if(this.sorted[r].at>=e)return r;return n}var o=t+n>>1;this.sorted[o].at>e?n=o:t=o}}},{key:"insert",value:function(e){this.sorted.splice(this.find(e.at),0,e)}},{key:"remove",value:function(e,t){for(var n=this.find(e),r=0;;r++){var o=n-r-1,i=n+r;if(o>=0&&this.sorted[o].range==t)return void this.sorted.splice(o,1);if(i<this.sorted.length&&this.sorted[i].range==t)return void this.sorted.splice(i,1)}}},{key:"resort",value:function(){for(var e=0;e<this.sorted.length;e++)for(var t=this.sorted[e],n=t.at="open"==t.type?t.range.from:t.range.to,r=e;r>0&&this.sorted[r-1].at>n;)this.sorted[r]=this.sorted[r-1],this.sorted[--r]=t}}]),e}(),s=function(){function e(t){o(this,e),this.pm=t,this.ranges=[],this.sorted=new a}return r(e,[{key:"addRange",value:function(e){this.ranges.push(e),this.sorted.insert({type:"open",at:e.from,range:e}),this.sorted.insert({type:"close",at:e.to,range:e}),e.options.className&&this.pm.markRangeDirty(e.from,e.to)
}},{key:"removeRange",value:function(e){var t=this.ranges.indexOf(e);t>-1&&(this.ranges.splice(t,1),this.sorted.remove(e.from,e),this.sorted.remove(e.to,e),e.options.className&&this.pm.markRangeDirty(e.from,e.to),e.remove())}},{key:"transform",value:function(e){for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t];n.from=e.map(n.from,n.options.inclusiveLeft?-1:1),n.to=e.map(n.to,n.options.inclusiveRight?1:-1),n.options.removeWhenEmpty!==!1&&n.from>=n.to?(this.removeRange(n),t--):n.from>n.to&&(n.to=n.from)}this.sorted.resort()}},{key:"activeRangeTracker",value:function(){return new l(this.sorted.sorted)}}]),e}();n.RangeStore=s;var l=function(){function e(t){o(this,e),this.sorted=t,this.pos=0,this.current=[],this.element=null}return r(e,[{key:"advanceTo",value:function(e){var t=void 0;for(this.element=null;this.pos<this.sorted.length&&(t=this.sorted[this.pos]).at<=e;){if(u(t)){var n=t.range.options.className,r=t.range.options.elementBefore;n&&("open"==t.type?this.current.push(n):this.current.splice(this.current.indexOf(n),1)),r&&"open"==t.type&&t.at==e&&(this.element=r)}this.pos++}}},{key:"nextChangeBefore",value:function(e){for(;;){if(this.pos==this.sorted.length)return-1;var t=this.sorted[this.pos];if(u(t))return t.at>=e?-1:t.at;this.pos++}}}]),e}()},{}],18:[function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e){return e.focusNode===e.anchorNode&&e.focusOffset===e.anchorOffset}function w(e,t){var n=e.root.getSelection(),r=e.doc,o=f(n.focusNode,n.focusOffset),i=o.pos,a=o.inLeaf;if(a>-1&&k(n)){var s=r.resolve(a),u=s.nodeAfter;if(u.type.selectable&&!u.type.isInline)return{range:new g(s),adjusted:!0}}var l=k(n)?i:f(n.anchorNode,n.anchorOffset).pos,c=O(r.resolve(i),null!=t&&i>t?1:-1);if(c instanceof y){var h=O(r.resolve(l),l>c.to?-1:1,!0);c=new y(h.$anchor,c.$head)}else if(l<c.from||l>c.to){var p=l>c.to;c=new y(O(r.resolve(l),p?-1:1,!0).$anchor,O(p?c.$from:c.$to,p?1:-1,!0).$head)}return{range:c,adjusted:i!=c.head||l!=c.anchor}}function x(e){if(e.root.activeElement!=e.content)return!1;var t=e.root.getSelection();return t.rangeCount&&u(e.content,t.anchorNode)}function S(e,t,n,r,o,i){if(t.isTextblock)return new y(e.resolve(n));for(var a=r-(o>0?0:1);o>0?a<t.childCount:a>=0;a+=o){var s=t.child(a);if(s.type.isLeaf){if(!i&&s.type.selectable)return new g(e.resolve(n-(0>o?s.nodeSize:0)))}else{var u=S(e,s,n+o,0>o?s.childCount:0,o,i);if(u)return u}n+=s.nodeSize*o}}function C(e,t,n){var r=e.parent.isTextblock?new y(e):S(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(var o=e.depth-1;o>=0;o--){var i=0>t?S(e.node(0),e.node(o),e.before(o+1),e.index(o),t,n):S(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,t,n);if(i)return i}}function O(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=arguments[2],r=C(e,t,n)||C(e,-t,n);if(!r)throw new RangeError("Searching for selection in invalid document "+e.node(0));return r}function T(e,t){return S(e,e,0,0,1,t)}function M(e,t){return S(e,e,e.content.size,e.childCount,-1,t)}function A(e,t,n){for(var r=t.depth?h(e,t.before()):e.content,o=d(e,t.pos),i=r.firstChild;i;i=i.nextSibling)if(1==i.nodeType)for(var a=i.getClientRects(),s=0;s<a.length;s++){var u=a[s];if(0>n?u.bottom<o.top:u.top>o.bottom)return!1}return!0}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../util/dom"),u=s.contains,l=e("../util/browser"),c=e("./dompos"),f=c.posFromDOM,h=c.DOMAfterPos,p=c.DOMFromPos,d=c.coordsAtPos,m=function(){function e(t,n){var r=this;a(this,e),this.pm=t,this.range=n,this.polling=null,this.lastAnchorNode=this.lastHeadNode=this.lastAnchorOffset=this.lastHeadOffset=null,this.lastNode=null,t.content.addEventListener("focus",function(){return r.receivedFocus()}),this.poller=this.poller.bind(this)}return r(e,[{key:"setAndSignal",value:function(e,t){this.set(e,t),this.pm.on.selectionChange.dispatch()}},{key:"set",value:function(e,t){this.pm.ensureOperation({readSelection:!1,selection:e}),this.range=e,t!==!1&&(this.lastAnchorNode=null)}},{key:"poller",value:function(){x(this.pm)?(this.pm.operation||this.readFromDOM(),this.polling=setTimeout(this.poller,100)):this.polling=null}},{key:"startPolling",value:function(){clearTimeout(this.polling),this.polling=setTimeout(this.poller,50)}},{key:"fastPoll",value:function(){this.startPolling()}},{key:"stopPolling",value:function(){clearTimeout(this.polling),this.polling=null}},{key:"domChanged",value:function(){var e=this.pm.root.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastHeadNode||e.focusOffset!=this.lastHeadOffset}},{key:"storeDOMState",value:function(){var e=this.pm.root.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastHeadNode=e.focusNode,this.lastHeadOffset=e.focusOffset}},{key:"readFromDOM",value:function(){if(!x(this.pm)||!this.domChanged())return!1;var e=w(this.pm,this.range.head),t=e.range,n=e.adjusted;return this.setAndSignal(t),t instanceof g||n?this.toDOM():(this.clearNode(),this.storeDOMState()),!0}},{key:"toDOM",value:function(e){x(this.pm)||e&&l.gecko&&this.pm.content.focus(),this.range instanceof g?this.nodeToDOM():this.rangeToDOM()}},{key:"nodeToDOM",value:function(){var e=h(this.pm,this.range.from);e!=this.lastNode&&(this.clearNode(),e.classList.add("ProseMirror-selectednode"),this.pm.content.classList.add("ProseMirror-nodeselection"),this.lastNode=e);var t=document.createRange(),n=this.pm.root.getSelection();t.selectNode(e),n.removeAllRanges(),n.addRange(t),this.storeDOMState()}},{key:"rangeToDOM",value:function(){this.clearNode();var e=p(this.pm,this.range.anchor),t=p(this.pm,this.range.head),n=this.pm.root.getSelection(),r=document.createRange();if(n.extend)r.setEnd(e.node,e.offset),r.collapse(!1);else{if(this.range.anchor>this.range.head){var o=e;e=t,t=o}r.setEnd(t.node,t.offset),r.setStart(e.node,e.offset)}n.removeAllRanges(),n.addRange(r),n.extend&&n.extend(t.node,t.offset),this.storeDOMState()}},{key:"clearNode",value:function(){return this.lastNode?(this.lastNode.classList.remove("ProseMirror-selectednode"),this.pm.content.classList.remove("ProseMirror-nodeselection"),this.lastNode=null,!0):void 0}},{key:"receivedFocus",value:function(){null==this.polling&&this.startPolling()}}]),e}();n.SelectionState=m;var v=function(){function e(t,n){a(this,e),this.$from=t,this.$to=n}return r(e,[{key:"from",get:function(){return this.$from.pos}},{key:"to",get:function(){return this.$to.pos}}]),r(e,[{key:"empty",get:function(){return this.from==this.to}}]),e}();n.Selection=v;var y=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?e:arguments[1];a(this,t);var r=e.pos>n.pos,i=o(this,Object.getPrototypeOf(t).call(this,r?n:e,r?e:n));return i.$anchor=e,i.$head=n,i}return i(t,e),r(t,[{key:"anchor",get:function(){return this.$anchor.pos}},{key:"head",get:function(){return this.$head.pos}}]),r(t,[{key:"eq",value:function(e){return e instanceof t&&e.head==this.head&&e.anchor==this.anchor}},{key:"map",value:function(e,n){var r=e.resolve(n.map(this.head));if(!r.parent.isTextblock)return O(r);var o=e.resolve(n.map(this.anchor));return new t(o.parent.isTextblock?o:r,r)}},{key:"inverted",get:function(){return this.anchor>this.head}},{key:"token",get:function(){return new b(t,this.anchor,this.head)}}],[{key:"mapToken",value:function(e,n){return new b(t,n.map(e.a),n.map(e.b))}},{key:"fromToken",value:function(e,n){var r=n.resolve(e.b);if(!r.parent.isTextblock)return O(r);var o=n.resolve(e.a);return new t(o.parent.isTextblock?o:r,r)}}]),t}(v);n.TextSelection=y;var g=function(e){function t(e){a(this,t);var n=e.plusOne(),r=o(this,Object.getPrototypeOf(t).call(this,e,n));return r.node=e.nodeAfter,r}return i(t,e),r(t,[{key:"eq",value:function(e){return e instanceof t&&this.from==e.from}},{key:"map",value:function(e,n){var r=e.resolve(n.map(this.from,1)),o=n.map(this.to,-1),i=r.nodeAfter;return i&&o==r.pos+i.nodeSize&&i.type.selectable?new t(r):O(r)}},{key:"token",get:function(){return new b(t,this.from,this.to)}}],[{key:"mapToken",value:function(e,n){return new b(t,n.map(e.a,1),n.map(e.b,-1))}},{key:"fromToken",value:function(e,n){var r=n.resolve(e.a),o=r.nodeAfter;return o&&e.b==e.a+o.nodeSize&&o.type.selectable?new t(r):O(r)}}]),t}(v);n.NodeSelection=g;var b=function E(e,t,n){a(this,E),this.type=e,this.a=t,this.b=n};n.isCollapsed=k,n.hasFocus=x,n.findSelectionFrom=C,n.findSelectionNear=O,n.findSelectionAtStart=T,n.findSelectionAtEnd=M,n.verticalMotionLeavesTextblock=A},{"../util/browser":59,"../util/dom":61,"./dompos":8}],19:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../model"),u=s.Fragment,l=e("../transform"),c=l.Transform,f=l.insertPoint,h=e("./selection"),p=h.findSelectionNear,d={scrollIntoView:!0},m=function(e){function t(e){o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e.doc));return n.pm=e,n.curSelection=e.selection,n.curSelectionAt=0,n}return a(t,e),r(t,[{key:"apply",value:function(e){return this.pm.apply(this,e)}},{key:"applyAndScroll",value:function(){return this.pm.apply(this,d)}},{key:"setSelection",value:function(e){return this.curSelection=e,this.curSelectionAt=this.steps.length,this}},{key:"replaceSelection",value:function(e,t){var n=this.selection,r=n.empty,o=n.$from,i=n.$to,a=n.from,s=n.to,l=n.node;e&&e.isInline&&t!==!1&&(e=e.mark(r?this.pm.input.storedMarks:this.doc.marksAt(a)));var c=u.from(e);if(l&&l.isTextblock&&e&&e.isInline)a++,s--;else if(l){for(var h=o.depth;h&&1==o.node(h).childCount&&!o.node(h).canReplace(o.index(h),i.indexAfter(h),c);)h--;h<o.depth&&(a=o.before(h+1),s=o.after(h+1))}else if(e&&a==s){var d=f(this.doc,a,e.type,e.attrs);null!=d&&(a=s=d)}this.replaceWith(a,s,c);var m=this.maps[this.maps.length-1];return this.setSelection(p(this.doc.resolve(m.map(s)))),this}},{key:"deleteSelection",value:function(){return this.replaceSelection()}},{key:"typeText",value:function(e){return this.replaceSelection(this.pm.schema.text(e),!0)}},{key:"selection",get:function(){if(this.curSelectionAt<this.steps.length){if(this.curSelectionAt)for(var e=this.curSelectionAt;e<this.steps.length;e++)this.curSelection=this.curSelection.map(e==this.steps.length-1?this.doc:this.docs[e+1],this.maps[e]);else this.curSelection=this.curSelection.map(this.doc,this);this.curSelectionAt=this.steps.length}return this.curSelection}}]),t}(c);n.EditorTransform=m},{"../model":38,"../transform":47,"./selection":18}],20:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=50,a=100,s=function(){function e(t){var n=this;o(this,e),this.waiting=[],this.timeout=null,this.lastForce=0,this.pm=t,this.timedOut=function(){n.pm.operation?n.timeout=setTimeout(n.timedOut,i):n.force()},t.on.flush.add(this.onFlush.bind(this))}return r(e,[{key:"set",value:function(e){0==this.waiting.length&&(this.timeout=setTimeout(this.timedOut,i)),-1==this.waiting.indexOf(e)&&this.waiting.push(e)}},{key:"unset",value:function(e){var t=this.waiting.indexOf(e);t>-1&&this.waiting.splice(t,1)}},{key:"force",value:function(){for(clearTimeout(this.timeout),this.lastForce=Date.now();this.waiting.length;)for(var e=0;e<this.waiting.length;e++){var t=this.waiting[e]();t?this.waiting[e]=t:this.waiting.splice(e--,1)}}},{key:"onFlush",value:function(){this.waiting.length&&Date.now()-this.lastForce>a&&this.force()}}]),e}();n.EditorScheduler=s;var u=function(){function e(t,n,r){var i=this;o(this,e),this.pm=t,this.start=r,this.subscriptions=n,this.onEvent=this.onEvent.bind(this),this.subscriptions.forEach(function(e){return e.add(i.onEvent)})}return r(e,[{key:"detach",value:function(){var e=this;this.pm.unscheduleDOMUpdate(this.start),this.subscriptions.forEach(function(t){return t.remove(e.onEvent)})}},{key:"onEvent",value:function(){this.pm.scheduleDOMUpdate(this.start)}},{key:"force",value:function(){if(this.pm.operation)this.onEvent();else{this.pm.unscheduleDOMUpdate(this.start);for(var e=this.start;e;e=e());}}}]),e}();n.UpdateScheduler=u},{}],21:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e){var t=[];for(var n in e.nodes){var r=e.nodes[n];r instanceof d&&t.push(a(r)),r instanceof m&&t.push(s(r)),r instanceof v&&t.push(u(r)),r instanceof y&&t.push(l(r)),r instanceof g&&t.push(c(r,6))}return t}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../inputrules"),a=i.blockQuoteRule,s=i.orderedListRule,u=i.bulletListRule,l=i.codeBlockRule,c=i.headingRule,f=i.inputRules,h=i.allInputRules,p=e("../schema-basic"),d=p.BlockQuote,m=p.OrderedList,v=p.BulletList,y=p.CodeBlock,g=p.Heading,b=e("../edit"),k=b.Plugin,w=e("../menu"),x=w.menuBar,S=w.tooltipMenu,C=e("./style"),O=C.className,T=e("./menu"),M=T.buildMenuItems;n.buildMenuItems=M;var A=e("./keymap"),E=A.buildKeymap;n.buildKeymap=E,n.exampleSetup=new k(function(){function e(t,n){o(this,e),t.wrapper.classList.add(O),this.keymap=E(t.schema,n.mapKeys),t.addKeymap(this.keymap),this.inputRules=h.concat(N(t.schema));var r=f.ensure(t);this.inputRules.forEach(function(e){return r.addRule(e)});var i=void 0;this.barConf=n.menuBar,this.tooltipConf=n.tooltipMenu,this.barConf===!0&&(i=M(t.schema),this.barConf={"float":!0,content:i.fullMenu}),this.barConf&&x.config(this.barConf).attach(t),this.tooltipConf===!0&&(i||(i=M(t.schema)),this.tooltipConf={selectedBlockMenu:!0,inlineContent:i.inlineMenu,blockContent:i.blockMenu}),this.tooltipConf&&S.config(this.tooltipConf).attach(t)}return r(e,[{key:"detach",value:function(e){e.wrapper.classList.remove(O),e.removeKeymap(this.keymap);var t=f.ensure(e);this.inputRules.forEach(function(e){return t.removeRule(e)}),this.barConf&&x.detach(e),this.tooltipConf&&S.detach(e)}}]),e}(),{menuBar:!0,tooltipMenu:!1,mapKeys:null}),n.buildInputRules=N},{"../edit":11,"../inputrules":25,"../menu":30,"../schema-basic":45,"./keymap":22,"./menu":23,"./style":24}],22:[function(e,t,n){"use strict";function A(e,t){function o(e,r){if(t){var o=t[e];if(o===!1)return;o&&(e=o)}n[e]=r}var n={};for(var g in e.marks){var A=e.marks[g];A instanceof d&&o("Mod-B",M(A)),A instanceof m&&o("Mod-I",M(A)),A instanceof v&&o("Mod-`",M(A))}var E=function(t){var n=e.nodes[t];if(n instanceof a&&o("Shift-Ctrl-8",w(n)),n instanceof s&&o("Shift-Ctrl-9",w(n)),n instanceof l&&o("Shift-Ctrl-.",b(n)),n instanceof i){var r=O(T,function(e){return e.tr.replaceSelection(n.create()).applyAndScroll()});o("Mod-Enter",r),o("Shift-Enter",r),y.mac&&o("Ctrl-Enter",r)}if(n instanceof u&&(o("Enter",x(n)),o("Mod-[",S(n)),o("Mod-]",C(n))),n instanceof f&&o("Shift-Ctrl-0",k(n)),n instanceof h&&o("Shift-Ctrl-\\",k(n)),n instanceof p)for(var d=1;6>=d;d++)o("Shift-Ctrl-"+d,k(n,{level:d}));n instanceof c&&o("Mod-Shift--",function(e){return e.tr.replaceSelection(n.create()).applyAndScroll()})};for(var N in e.nodes)E(N);return new r(n)}var r=e("browserkeymap"),o=e("../schema-basic"),i=o.HardBreak,a=o.BulletList,s=o.OrderedList,u=o.ListItem,l=o.BlockQuote,c=o.HorizontalRule,f=o.Paragraph,h=o.CodeBlock,p=o.Heading,d=o.StrongMark,m=o.EmMark,v=o.CodeMark,y=e("../util/browser"),g=e("../edit").commands,b=g.wrapIn,k=g.setBlockType,w=g.wrapInList,x=g.splitListItem,S=g.liftListItem,C=g.sinkListItem,O=g.chainCommands,T=g.newlineInCode,M=g.toggleMark;n.buildKeymap=A},{"../edit":11,"../schema-basic":45,"../util/browser":59,browserkeymap:1}],23:[function(e,t,n){"use strict";function H(e,t){new $(e,"Create a link",{href:new V({label:"Link target",required:!0,clean:function(e){return/^https?:\/\//i.test(e)||(e="http://"+e),e}}),title:new V({label:"Title"})}).open(t)}function W(e,t,n){var r=e.selection,o=r.node,i=r.from,a=r.to,s=n&&o&&o.type==n&&o.attrs;new $(e,"Insert image",{src:new V({label:"Location",required:!0,value:s&&s.src}),title:new V({label:"Title",value:s&&s.title}),alt:new V({label:"Description",value:s?s.title:e.doc.textBetween(i,a," ")})}).open(t)}function K(e){return/^[1-9]\d*$/.test(e)?void 0:"Should be a positive integer"}function J(e,t){new $(e,"Insert table",{rows:new V({label:"Rows",validate:K}),cols:new V({label:"Columns",validate:K})}).open(t)}function U(e){return new N({title:"Insert a table",run:function(t){J(t,function(n){var r=n.rows,o=n.cols;t.tr.replaceSelection(j(e,+r,+o)).applyAndScroll()})},select:function(t){for(var n=t.selection.$from,r=n.depth;r>=0;r--){var o=n.index(r);if(n.node(r).canReplaceWith(o,o,e))return!0}return!1},label:"Table"})}function Q(e,t){return new N({title:e,label:e,run:t,select:function(e){return t(e,!1)}})}function Y(e){var t={};for(var n in e.marks){var r=e.marks[n];r instanceof o&&(t.toggleStrong=y(r,{title:"Toggle strong style",icon:E.strong})),r instanceof i&&(t.toggleEm=y(r,{title:"Toggle emphasis",icon:E.em})),r instanceof a&&(t.toggleCode=y(r,{title:"Toggle code font",icon:E.code})),r instanceof s&&(t.toggleLink=y(r,{title:"Add or remove link",icon:E.link,attrs:H}))}var v=function(n){var r=e.nodes[n];if(r instanceof u&&(t.insertImage=g(r,{title:"Insert image",label:"Image",attrs:function(e,t){return W(e,t,r)}})),r instanceof l&&(t.wrapBulletList=A(r,{title:"Wrap in bullet list",icon:E.bulletList})),r instanceof c&&(t.wrapOrderedList=A(r,{title:"Wrap in ordered list",icon:E.orderedList})),r instanceof f&&(t.wrapBlockQuote=b(r,{title:"Wrap in block quote",icon:E.blockquote})),r instanceof p&&(t.makeParagraph=k(r,{title:"Change to paragraph",label:"Plain"})),r instanceof d&&(t.makeCodeBlock=k(r,{title:"Change to code block",label:"Code"})),r instanceof h)for(var o=1;10>=o;o++)t["makeHead"+o]=k(r,{title:"Change to heading "+o,label:"Level "+o,attrs:{level:o}});r instanceof m&&(t.insertHorizontalRule=g(r,{title:"Insert horizontal rule",label:"Horizontal rule"})),r instanceof R&&(t.insertTable=U(r)),r instanceof P&&(t.addRowBefore=Q("Add row before",L),t.addRowAfter=Q("Add row after",F),t.removeRow=Q("Remove row",q),t.addColumnBefore=Q("Add column before",I),t.addColumnAfter=Q("Add column after",z),t.removeColumn=Q("Remove column",B))};for(var N in e.nodes)v(N);var D=function(e){return e.filter(function(e){return e})};t.insertMenu=new w(D([t.insertImage,t.insertHorizontalRule,t.insertTable]),{label:"Insert"}),t.typeMenu=new w(D([t.makeParagraph,t.makeCodeBlock,t.makeHead1&&new x(D([t.makeHead1,t.makeHead2,t.makeHead3,t.makeHead4,t.makeHead5,t.makeHead6]),{label:"Heading"})]),{label:"Type..."});var j=D([t.addRowBefore,t.addRowAfter,t.removeRow,t.addColumnBefore,t.addColumnAfter,t.removeColumn]);return j.length&&(t.tableMenu=new w(j,{label:"Table"})),t.inlineMenu=[D([t.toggleStrong,t.toggleEm,t.toggleCode,t.toggleLink]),[t.insertMenu]],t.blockMenu=[D([t.typeMenu,t.tableMenu,t.wrapBulletList,t.wrapOrderedList,t.wrapBlockQuote,S,C,O])],t.fullMenu=t.inlineMenu.concat(t.blockMenu).concat([[T,M]]),t}var r=e("../schema-basic"),o=r.StrongMark,i=r.EmMark,a=r.CodeMark,s=r.LinkMark,u=r.Image,l=r.BulletList,c=r.OrderedList,f=r.BlockQuote,h=r.Heading,p=r.Paragraph,d=r.CodeBlock,m=r.HorizontalRule,v=e("../menu"),y=v.toggleMarkItem,g=v.insertItem,b=v.wrapItem,k=v.blockTypeItem,w=v.Dropdown,x=v.DropdownSubmenu,S=v.joinUpItem,C=v.liftItem,O=v.selectParentNodeItem,T=v.undoItem,M=v.redoItem,A=v.wrapListItem,E=v.icons,N=v.MenuItem,D=e("../schema-table"),R=D.Table,P=D.TableRow,j=D.createTable,I=D.addColumnBefore,z=D.addColumnAfter,B=D.removeColumn,L=D.addRowBefore,F=D.addRowAfter,q=D.removeRow,_=e("../ui"),$=_.FieldPrompt,V=_.TextField;n.buildMenuItems=Y},{"../menu":30,"../schema-basic":45,"../schema-table":46,"../ui":56}],24:[function(e,t,n){"use strict";var r=e("../util/dom"),o=r.insertCSS,i="ProseMirror-example-setup-style";n.className=i;var a="."+i+" .ProseMirror-content";o("\n\n/* Add space around the hr to make clicking it easier */\n\n"+a+" hr {\n  position: relative;\n  height: 6px;\n  border: none;\n}\n\n"+a+' hr:after {\n  content: "";\n  position: absolute;\n  left: 10px;\n  right: 10px;\n  top: 2px;\n  border-top: 2px solid silver;\n}\n\n'+a+" img {\n  cursor: default;\n}\n\n"+a+" table {\n  border-collapse: collapse;\n}\n\n"+a+" td {\n  vertical-align: top;\n  border: 1px solid #ddd;\n  padding: 3px 5px;\n}\n\n")},{"../util/dom":61}],25:[function(e,t,n){"use strict";var r=e("./inputrules");n.InputRule=r.InputRule,n.inputRules=r.inputRules,n.InputRules=r.InputRules;var o=e("./rules");n.emDash=o.emDash,n.ellipsis=o.ellipsis,n.openDoubleQuote=o.openDoubleQuote,n.closeDoubleQuote=o.closeDoubleQuote,n.openSingleQuote=o.openSingleQuote,n.closeSingleQuote=o.closeSingleQuote,n.smartQuotes=o.smartQuotes,n.allInputRules=o.allInputRules;var i=e("./util");n.wrappingInputRule=i.wrappingInputRule,n.textblockTypeInputRule=i.textblockTypeInputRule,n.blockQuoteRule=i.blockQuoteRule,n.orderedListRule=i.orderedListRule,n.bulletListRule=i.bulletListRule,n.codeBlockRule=i.codeBlockRule,n.headingRule=i.headingRule},{"./inputrules":26,"./rules":27,"./util":28}],26:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e){for(var t=e.parent,n=t.type.isCode,r="",o=0,i=e.parentOffset;i>0;o++){var a=t.child(o);r+=a.isText?a.text.slice(0,i):"￼",i-=a.nodeSize,0>=i&&a.marks.some(function(e){return e.type.isCode})&&(n=!0)}return{textBefore:r,isCode:n}}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../edit"),a=i.Keymap,s=i.Plugin,u=function h(e,t,n){o(this,h),this.filter=t,this.match=e,this.handler=n};n.InputRule=u;var l=function(){function e(t,n){var r=this;o(this,e),this.pm=t,this.rules=[],this.cancelVersion=null,t.on.selectionChange.add(this.onSelChange=function(){return r.cancelVersion=null}),t.on.textInput.add(this.onTextInput=this.onTextInput.bind(this)),t.addKeymap(new a({Backspace:function(e){return r.backspace(e)}},{name:"inputRules"}),20),n.rules.forEach(function(e){return r.addRule(e)})}return r(e,[{key:"detach",value:function(){this.pm.on.selectionChange.remove(this.onSelChange),this.pm.on.textInput.remove(this.onTextInput),this.pm.removeKeymap("inputRules")}},{key:"addRule",value:function(e){this.rules.push(e)}},{key:"removeRule",value:function(e){var t=this.rules.indexOf(e);return t>-1?(this.rules.splice(t,1),!0):!1}},{key:"onTextInput",value:function(e){var t=this.pm.selection.$head;if(t)for(var n=void 0,r=void 0,o=e[e.length-1],i=0;i<this.rules.length;i++){var a=this.rules[i],s=void 0;if(!a.filter||a.filter==o){if(null==n){var u=c(t);if(n=u.textBefore,r=u.isCode)return}if(s=a.match.exec(n)){var l=this.pm.history.getVersion();if("string"==typeof a.handler){var f=t.pos-(s[1]||s[0]).length,h=this.pm.doc.marksAt(t.pos);this.pm.tr.delete(f,t.pos).insert(f,this.pm.schema.text(a.handler,h)).apply()}else a.handler(this.pm,s,t.pos);return void(this.cancelVersion=l)}}}}},{key:"backspace",value:function(){return this.cancelVersion?(this.pm.history.backToVersion(this.cancelVersion),void(this.cancelVersion=null)):!1}}]),e}(),f=new s(l,{rules:[]});n.inputRules=f},{"../edit":11}],27:[function(e,t,n){"use strict";var r=e("./inputrules"),o=r.InputRule,i=new o(/--$/,"-","—");n.emDash=i;var a=new o(/\.\.\.$/,".","…");n.ellipsis=a;var s=new o(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,'"',"“");n.openDoubleQuote=s;var u=new o(/"$/,'"',"”");n.closeDoubleQuote=u;var l=new o(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"'","‘");n.openSingleQuote=l;var c=new o(/'$/,"'","’");n.closeSingleQuote=c;var f=[s,u,l,c];n.smartQuotes=f;var h=[i,a].concat(f);n.allInputRules=h},{"./inputrules":26}],28:[function(e,t,n){"use strict";function u(e,t,n,r,i){return new o(e,t,function(e,t,o){var u=o-t[0].length,l=r instanceof Function?r(t):r,c=e.tr.delete(u,o),f=c.doc.resolve(u),h=f.blockRange(),p=h&&a(h,n,l);if(p){c.wrap(h,p);var d=c.doc.resolve(u-1).nodeBefore;d&&d.type==n&&s(c.doc,u-1)&&(!i||i(t,d))&&c.join(u-1),c.apply()}})}function l(e,t,n,r){return new o(e,t,function(e,t,o){var i=e.doc.resolve(o),a=o-t[0].length,s=r instanceof Function?r(t):r;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),n,s)?e.tr.delete(a,o).setBlockType(a,a,n,s).apply():void 0})}function c(e){return u(/^\s*> $/," ",e)}function f(e){return u(/^(\d+)\. $/," ",e,function(e){return{order:+e[1]}},function(e,t){return t.childCount+t.attrs.order==+e[1]})}function h(e){return u(/^\s*([-+*]) $/," ",e)}function p(e){return l(/^```$/,"`",e)}function d(e,t){return l(new RegExp("^(#{1,"+t+"}) $")," ",e,function(e){return{level:e[1].length}})}var r=e("./inputrules"),o=r.InputRule,i=e("../transform"),a=i.findWrapping,s=i.joinable;n.wrappingInputRule=u,n.textblockTypeInputRule=l,n.blockQuoteRule=c,n.orderedListRule=f,n.bulletListRule=h,n.codeBlockRule=p,n.headingRule=d},{"../transform":47,"./inputrules":26}],29:[function(e,t,n){"use strict";function u(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t}function l(e){var t=document.createElement("div");if(t.className=s,e.path){var n="pm-icon-"+u(e.path).toString(16);document.getElementById(n)||c(n,e);var r=t.appendChild(document.createElementNS(i,"svg"));r.style.width=e.width/e.height+"em";var o=r.appendChild(document.createElementNS(i,"use"));o.setAttributeNS(a,"href",/([^#]*)/.exec(document.location)[1]+"#"+n)}else e.dom?t.appendChild(e.dom.cloneNode(!0)):(t.appendChild(document.createElement("span")).textContent=e.text||"",e.css&&(t.firstChild.style.cssText=e.css));return t}function c(e,t){var n=document.getElementById(s+"-collection");n||(n=document.createElementNS(i,"svg"),n.id=s+"-collection",n.style.display="none",document.body.insertBefore(n,document.body.firstChild));var r=document.createElementNS(i,"symbol");r.id=e,r.setAttribute("viewBox","0 0 "+t.width+" "+t.height);var o=r.appendChild(document.createElementNS(i,"path"));o.setAttribute("d",t.path),n.appendChild(r)}var r=e("../util/dom"),o=r.insertCSS,i="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xlink",s="ProseMirror-icon";n.getIcon=l,o("\n."+s+" {\n  display: inline-block;\n  line-height: .8;\n  vertical-align: -2px; /* Compensate for padding */\n  padding: 2px 8px;\n  cursor: pointer;\n}\n\n."+s+" svg {\n  fill: currentColor;\n  height: 1em;\n}\n\n."+s+" span {\n  vertical-align: text-top;\n}")},{"../util/dom":61}],30:[function(e,t,n){"use strict";var r=e("../util/obj"),o=r.copyObj;o(e("./menu"),n),n.menuBar=e("./menubar").menuBar,n.tooltipMenu=e("./tooltipmenu").tooltipMenu},{"../util/obj":64,"./menu":31,"./menubar":32,"./tooltipmenu":33}],31:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r].render(t);o&&n.push(a("div",{"class":x+"-dropdown-item"},o))}return n}function M(e,t){for(var n=document.createDocumentFragment(),r=!1,o=0;o<t.length;o++){for(var i=t[o],s=!1,u=0;u<i.length;u++){var l=i[u].render(e);l&&(!s&&r&&n.appendChild(A()),n.appendChild(a("span",{"class":x+"item"},l)),s=!0)}s&&(r=!0)}return n}function A(){return a("span",{"class":x+"separator"})}function I(e,t){var n=e.selection,r=n.from,o=n.to,i=n.empty;return i?t.isInSet(e.activeMarks()):e.doc.rangeHasMark(r,o,t)}function z(e,t){var n=y(e,t.attrs),r={run:function(e){n(e)},active:function(t){return I(t,e)},select:function(e){return n(e,!1)}};return t.attrs instanceof Function&&(r.run=function(r){I(r,e)?n(r):t.attrs(r,function(t){return y(e,t)(r)})}),new S(b(t,r))}function B(e,t){return new S(b(t,{select:function(n){for(var r=n.selection.$from,o=r.depth;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,e,t.attrs instanceof Function?null:t.attrs))return!0}},run:function(n){function r(t){n.tr.replaceSelection(e.createAndFill(t)).apply()}t.attrs instanceof Function?t.attrs(n,r):r(t.attrs)}}))}function L(e,t){return new S(b(t,{run:function(n){t.attrs instanceof Function?t.attrs(n,function(t){return d(e,t)(n)}):d(e,t.attrs)(n)},select:function(n){return d(e,t.attrs instanceof Function?null:t.attrs)(n,!1)}}))}function F(e,t){var n=m(e,t.attrs);return new S(b(t,{run:n,select:function(e){return n(e,!1)},active:function(n){var r=n.selection,o=r.$from,i=r.to,a=r.node;return a?a.hasMarkup(e,t.attrs):i<=o.end()&&o.parent.hasMarkup(e,t.attrs)}}))}function q(e,t){var n=v(e,t.attrs);return new S(b(t,{run:n,select:function(e){return n(e,!1)}}))}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../util/dom"),a=i.elt,s=i.insertCSS,u=e("../edit").commands,l=u.undo,c=u.redo,f=u.lift,h=u.joinUp,p=u.selectParentNode,d=u.wrapIn,m=u.setBlockType,v=u.wrapInList,y=u.toggleMark,g=e("../util/obj"),b=g.copyObj,k=e("./icons"),w=k.getIcon,x="ProseMirror-menu",S=function(){function e(t){o(this,e),this.spec=t}return r(e,[{key:"render",value:function(e){var t=!1,n=this.spec;if(n.select&&!n.select(e)){if("disable"!=n.onDeselected)return null;t=!0}var r=n.active&&!t&&n.active(e),o=void 0;if(n.render)o=n.render(e);else if(n.icon)o=w(n.icon),r&&o.classList.add(x+"-active");else{if(!n.label)throw new RangeError("MenuItem without render, icon, or label property");o=a("div",null,e.translate(n.label))}return n.title&&o.setAttribute("title",e.translate(n.title)),n.class&&o.classList.add(n.class),t&&o.classList.add(x+"-disabled"),n.css&&(o.style.cssText+=n.css),t||o.addEventListener(n.execEvent||"mousedown",function(t){t.preventDefault(),t.stopPropagation(),e.on.interaction.dispatch(),n.run(e)}),o}}]),e}();n.MenuItem=S;var C=function(){function e(t,n){o(this,e),this.options=n||{},this.content=Array.isArray(t)?t:[t]}return r(e,[{key:"render",value:function(e){var t=this,n=O(this.content,e);if(!n.length)return null;var r=a("div",{"class":x+"-dropdown "+(this.options.class||""),style:this.options.css,title:this.options.title&&e.translate(this.options.title)},e.translate(this.options.label)),o=null;return r.addEventListener("mousedown",function(i){i.preventDefault(),i.stopPropagation(),o=o&&o()?null:t.expand(e,r,n)}),r}},{key:"expand",value:function(e,t,n){function u(){return s?void 0:(s=!0,e.on.interaction.remove(u),e.wrapper.removeChild(i),!0)
}var r=t.getBoundingClientRect(),o=e.wrapper.getBoundingClientRect(),i=a("div",{"class":x+"-dropdown-menu "+(this.options.class||""),style:"left: "+(r.left-o.left)+"px; top: "+(r.bottom-o.top)+"px"},n),s=!1;return e.on.interaction.dispatch(),e.wrapper.appendChild(i),e.on.interaction.add(u),u}}]),e}();n.Dropdown=C;var T=function(){function e(t,n){o(this,e),this.options=n||{},this.content=Array.isArray(t)?t:[t]}return r(e,[{key:"render",value:function(e){var t=O(this.content,e);if(!t.length)return null;var n=a("div",{"class":x+"-submenu-label"},e.translate(this.options.label)),r=a("div",{"class":x+"-submenu-wrap"},n,a("div",{"class":x+"-submenu"},t));return n.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),r.classList.toggle(x+"-submenu-wrap-active")}),r}}]),e}();n.DropdownSubmenu=T,n.renderGrouped=M;var E={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"⬚",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}};n.icons=E;var N=new S({title:"Join with above block",run:h,select:function(e){return h(e,!1)},icon:E.join});n.joinUpItem=N;var D=new S({title:"Lift out of enclosing block",run:f,select:function(e){return f(e,!1)},icon:E.lift});n.liftItem=D;var R=new S({title:"Select parent node",run:p,select:function(e){return p(e,!1)},icon:E.selectParentNode});n.selectParentNodeItem=R;var P=new S({title:"Undo last change",run:l,select:function(e){return l(e,!1)},icon:E.undo});n.undoItem=P;var j=new S({title:"Redo last undone change",run:c,select:function(e){return c(e,!1)},icon:E.redo});n.redoItem=j,n.toggleMarkItem=z,n.insertItem=B,n.wrapItem=L,n.blockTypeItem=F,n.wrapListItem=q,s("\n\n.ProseMirror-textblock-dropdown {\n  min-width: 3em;\n}\n\n."+x+" {\n  margin: 0 -4px;\n  line-height: 1;\n}\n\n.ProseMirror-tooltip ."+x+" {\n  width: -webkit-fit-content;\n  width: fit-content;\n  white-space: pre;\n}\n\n."+x+"item {\n  margin-right: 3px;\n  display: inline-block;\n}\n\n."+x+"separator {\n  border-right: 1px solid #ddd;\n  margin-right: 3px;\n}\n\n."+x+"-dropdown, ."+x+"-dropdown-menu {\n  font-size: 90%;\n  white-space: nowrap;\n}\n\n."+x+"-dropdown {\n  padding: 1px 14px 1px 4px;\n  display: inline-block;\n  vertical-align: 1px;\n  position: relative;\n  cursor: pointer;\n}\n\n."+x+'-dropdown:after {\n  content: "";\n  border-left: 4px solid transparent;\n  border-right: 4px solid transparent;\n  border-top: 4px solid currentColor;\n  opacity: .6;\n  position: absolute;\n  right: 2px;\n  top: calc(50% - 2px);\n}\n\n.'+x+"-dropdown-menu, ."+x+"-submenu {\n  position: absolute;\n  background: white;\n  color: #666;\n  border: 1px solid #aaa;\n  padding: 2px;\n}\n\n."+x+"-dropdown-menu {\n  z-index: 15;\n  min-width: 6em;\n}\n\n."+x+"-dropdown-item {\n  cursor: pointer;\n  padding: 2px 8px 2px 4px;\n}\n\n."+x+"-dropdown-item:hover {\n  background: #f2f2f2;\n}\n\n."+x+"-submenu-wrap {\n  position: relative;\n  margin-right: -4px;\n}\n\n."+x+'-submenu-label:after {\n  content: "";\n  border-top: 4px solid transparent;\n  border-bottom: 4px solid transparent;\n  border-left: 4px solid currentColor;\n  opacity: .6;\n  position: absolute;\n  right: 4px;\n  top: calc(50% - 4px);\n}\n\n.'+x+"-submenu {\n  display: none;\n  min-width: 4em;\n  left: 100%;\n  top: -3px;\n}\n\n."+x+"-active {\n  background: #eee;\n  border-radius: 4px;\n}\n\n."+x+"-active {\n  background: #eee;\n  border-radius: 4px;\n}\n\n."+x+"-disabled {\n  opacity: .3;\n}\n\n."+x+"-submenu-wrap:hover ."+x+"-submenu, ."+x+"-submenu-wrap-active ."+x+"-submenu {\n  display: block;\n}\n")},{"../edit":11,"../util/dom":61,"../util/obj":64,"./icons":29}],32:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e){for(var t=e.parentNode;t;t=t.parentNode)if(t.scrollHeight>t.clientHeight)return t}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../edit"),s=a.Plugin,u=e("../util/dom"),l=u.elt,c=u.insertCSS,f=e("./menu"),h=f.renderGrouped,p="ProseMirror-menubar",d=function(){function e(t,n){var r=this;i(this,e),this.pm=t,this.wrapper=t.wrapper.insertBefore(l("div",{"class":p}),t.wrapper.firstChild),this.spacer=null,this.maxHeight=0,this.widthForMaxHeight=0,this.updater=t.updateScheduler([t.on.selectionChange,t.on.change,t.on.activeMarkChange],function(){return r.update()}),this.content=n.content,this.updater.force(),this.floating=!1,n.float&&(this.updateFloat(),this.scrollFunc=function(){document.body.contains(r.pm.wrapper)?r.updateFloat():window.removeEventListener("scroll",r.scrollFunc)},window.addEventListener("scroll",this.scrollFunc))}return o(e,[{key:"detach",value:function(){this.updater.detach(),this.wrapper.parentNode.removeChild(this.wrapper),this.spacer&&this.spacer.parentNode.removeChild(this.spacer),this.scrollFunc&&window.removeEventListener("scroll",this.scrollFunc)}},{key:"update",value:function(){var e=this;return this.wrapper.textContent="",this.wrapper.appendChild(h(this.pm,this.content)),this.floating?this.updateScrollCursor():function(){return e.wrapper.offsetWidth!=e.widthForMaxHeight&&(e.widthForMaxHeight=e.wrapper.offsetWidth,e.maxHeight=0),e.wrapper.offsetHeight>e.maxHeight?(e.maxHeight=e.wrapper.offsetHeight,function(){e.wrapper.style.minHeight=e.maxHeight+"px"}):void 0}}},{key:"updateFloat",value:function(){var e=this.pm.wrapper.getBoundingClientRect();if(this.floating)if(e.top>=0||e.bottom<this.wrapper.offsetHeight+10)this.floating=!1,this.wrapper.style.position=this.wrapper.style.left=this.wrapper.style.width="",this.wrapper.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{var t=(this.pm.wrapper.offsetWidth-this.pm.wrapper.clientWidth)/2;this.wrapper.style.left=e.left+t+"px",this.wrapper.style.display=e.top>window.innerHeight?"none":""}else if(e.top<0&&e.bottom>=this.wrapper.offsetHeight+10){this.floating=!0;var n=this.wrapper.getBoundingClientRect();this.wrapper.style.left=n.left+"px",this.wrapper.style.width=n.width+"px",this.wrapper.style.position="fixed",this.spacer=l("div",{"class":p+"-spacer",style:"height: "+n.height+"px"}),this.pm.wrapper.insertBefore(this.spacer,this.wrapper)}}},{key:"updateScrollCursor",value:function(){var e=this;if(!this.floating)return null;var t=this.pm.selection.head;return t?function(){var n=e.pm.coordsAtPos(t),o=e.wrapper.getBoundingClientRect();if(n.top<o.bottom&&n.bottom>o.top){var i=function(){var t=m(e.pm.wrapper);return t?{v:function(){t.scrollTop-=o.bottom-n.top}}:void 0}();if("object"===("undefined"==typeof i?"undefined":r(i)))return i.v}}:null}}]),e}(),v=new s(d,{content:[],"float":!1});n.menuBar=v,c("\n."+p+" {\n  border-top-left-radius: inherit;\n  border-top-right-radius: inherit;\n  position: relative;\n  min-height: 1em;\n  color: #666;\n  padding: 1px 6px;\n  top: 0; left: 0; right: 0;\n  border-bottom: 1px solid silver;\n  background: white;\n  z-index: 10;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  overflow: visible;\n}\n")},{"../edit":11,"../util/dom":61,"./menu":31}],33:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e){var t=e.getSelection().getRangeAt(0),n=t.getClientRects();if(!n.length)return t.getBoundingClientRect();for(var r=void 0,o=void 0,i=void 0,a=void 0,s=0;s<n.length;s++){var u=n[s];r==o?(r=u.left,o=u.right,i=u.top,a=u.bottom):u.top<a-1&&(s==n.length-1||Math.abs(n[s+1].left-u.left)>1)&&(r=Math.min(r,u.left),o=Math.max(o,u.right),i=Math.min(i,u.top))}return{top:i,left:(r+o)/2}}function y(e){var t=e.getSelection().getRangeAt(0),n=t.getClientRects();if(!n.length){var r=t.getBoundingClientRect();return{left:r.left,top:r.bottom}}for(var o=void 0,i=void 0,a=void 0,s=void 0,u=n.length-1;u>=0;u--){var l=n[u];o==i?(o=l.left,i=l.right,a=l.bottom,s=l.top):l.bottom>s+1&&(0==u||Math.abs(n[u-1].left-l.left)>1)&&(o=Math.min(o,l.left),i=Math.max(i,l.right),a=Math.min(a,l.bottom))}return{top:a,left:(o+i)/2}}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../edit"),a=i.Plugin,s=e("../util/dom"),u=s.elt,l=s.insertCSS,c=e("../ui"),f=c.Tooltip,h=e("./menu"),p=h.renderGrouped,d="ProseMirror-tooltipmenu",m=function(){function e(t,n){var r=this;o(this,e),this.pm=t,this.config=n,this.selectedBlockMenu=this.config.selectedBlockMenu,this.updater=t.updateScheduler([t.on.change,t.on.selectionChange,t.on.blur,t.on.focus],function(){return r.update()}),this.onContextMenu=this.onContextMenu.bind(this),t.content.addEventListener("contextmenu",this.onContextMenu),this.tooltip=new f(t.wrapper,this.config.position),this.selectedBlockContent=this.config.selectedBlockContent||this.config.inlineContent.concat(this.config.blockContent)}return r(e,[{key:"detach",value:function(){this.updater.detach(),this.tooltip.detach(),this.pm.content.removeEventListener("contextmenu",this.onContextMenu)}},{key:"show",value:function(e,t){var n=p(this.pm,e);n.childNodes.length?this.tooltip.open(u("div",null,n),t):this.tooltip.close()}},{key:"update",value:function(){var e=this,t=this.pm.selection,n=t.empty,r=t.node,o=t.$from,i=t.to,a=void 0;if(this.pm.hasFocus()){if(r&&r.isBlock)return function(){var t=e.nodeSelectionCoords();return function(){return e.show(e.config.blockContent,t)}};if(!n)return function(){var t=r?e.nodeSelectionCoords():e.selectionCoords(),n=e.selectedBlockMenu&&0==o.parentOffset&&o.end()==i;return function(){return e.show(n?e.selectedBlockContent:e.config.inlineContent,t)}};if(this.selectedBlockMenu&&0==o.parent.content.size)return function(){var t=e.selectionCoords();return function(){return e.show(e.config.blockContent,t)}};if(this.config.showLinks&&(a=this.linkUnderCursor()))return function(){var t=e.selectionCoords();return function(){return e.showLink(a,t)}};this.tooltip.close()}else this.tooltip.close()}},{key:"selectionCoords",value:function(){var e="above"==this.config.position?v(this.pm.root):y(this.pm.root);if(0!=e.top)return e;var t=this.pm.coordsAtPos(this.pm.selection.from);return{left:t.left,top:"above"==this.config.position?t.top:t.bottom}}},{key:"nodeSelectionCoords",value:function(){var e=this.pm.content.querySelector(".ProseMirror-selectednode");if(!e)return{left:0,top:0};var t=e.getBoundingClientRect();return{left:Math.min((t.left+t.right)/2,t.left+20),top:"above"==this.config.position?t.top:t.bottom}}},{key:"linkUnderCursor",value:function(){var e=this.pm.selection.head;if(!e)return null;var t=this.pm.doc.marksAt(e);return t.reduce(function(e,t){return e||"link"==t.type.name&&t},null)}},{key:"showLink",value:function(e,t){var n=u("div",{"class":d+"-linktext"},u("a",{href:e.attrs.href,title:e.attrs.title,rel:"noreferrer noopener",target:"_blank"},e.attrs.href));this.tooltip.open(n,t)}},{key:"onContextMenu",value:function(e){if(this.pm.selection.empty){var t=this.pm.posAtCoords({left:e.clientX,top:e.clientY});t&&this.pm.doc.resolve(t).parent.isTextblock&&(this.pm.setTextSelection(t,t),this.pm.flush(),this.show(this.config.inlineContent,this.selectionCoords()))}}}]),e}(),g=new a(m,{showLinks:!0,selectedBlockMenu:!1,inlineContent:[],blockContent:[],selectedBlockContent:null,position:"above"});n.tooltipMenu=g,l("\n\n."+d+"-linktext a {\n  color: #444;\n  text-decoration: none;\n  padding: 0 5px;\n}\n\n."+d+"-linktext a:hover {\n  text-decoration: underline;\n}\n\n")},{"../edit":11,"../ui":56,"../util/dom":61,"./menu":31}],34:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if("."==t.charAt(0)){var n=t.slice(1);if(!e.attrs[n])throw new SyntaxError("Node type "+e.name+" has no attribute "+n);return new h(n)}return JSON.parse(t)}function d(e,t){for(var n=[],r=0;r<t.length;r++){var o=e.marks[t[r]];if(!o)throw new SyntaxError("Unknown mark type: '"+t[r]+"'");n.push(o)}return n}function m(e,t,n){if(!(e instanceof h))return e;var r=t&&t[e.attr];return void 0!==r?r:n.nodeType.defaultAttrs[e.attr]}function v(e,t,n,r){return t>=m(e.min,n,r)&&t<=m(e.max,n,r)}function y(e,t,n){var r=[];return n.forEach(function(n){var o=e.nodes[n];if(o?-1==r.indexOf(o)&&r.push(o):t.forEach(function(t,i){i.group&&i.group.split(" ").indexOf(n)>-1&&(o=e.nodes[t],-1==r.indexOf(o)&&r.push(o))}),!o)throw new SyntaxError("Node type or group '"+n+"' does not exist")}),r}function b(e,t){var n=1,r=1;if(t&&("+"==t[1]?r=g:"*"==t[1]?(n=0,r=g):"?"==t[1]?n=0:t[2]&&(n=p(e,t[2]),r=t[3]?t[4]?p(e,t[4]):g:n),0==r||n>r))throw new SyntaxError("Invalid repeat count in '"+t[0]+"'");return{min:n,max:r}}function k(e,t){for(var n=t.split(/\s*,\s*/),r=Object.create(null),o=0;o<n.length;o++){var i=/^(\w+)=(\w+|\"(?:\\.|[^\\])*\"|\.\w+)$/.exec(n[o]);if(!i)throw new SyntaxError("Invalid attribute syntax: "+n[o]);r[i[1]]=p(e,i[2])}return r}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./fragment"),a=i.Fragment,s=e("./mark"),u=s.Mark,l=function(){function e(t,n,r){o(this,e),this.nodeType=t,this.elements=n,this.inlineContent=r}return r(e,[{key:"start",value:function(e){return new f(this,e,0,0)}},{key:"matches",value:function(e,t,n,r){return this.start(e).matchToEnd(t,n,r)}},{key:"getMatchAt",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?t.childCount:arguments[2];return 1==this.elements.length?new f(this,e,0,n):this.start(e).matchFragment(t,0,n)}},{key:"checkReplace",value:function(e,t,n,r){var o=arguments.length<=4||void 0===arguments[4]?a.empty:arguments[4],i=arguments.length<=5||void 0===arguments[5]?0:arguments[5],s=arguments.length<=6||void 0===arguments[6]?o.childCount:arguments[6];if(1==this.elements.length){var u=this.elements[0];if(!v(u,t.childCount-(r-n)+(s-i),e,this))return!1;for(var l=i;s>l;l++)if(!u.matches(o.child(l),e,this))return!1;return!0}var c=this.getMatchAt(e,t,n).matchFragment(o,i,s);return c?c.matchToEnd(t,r):!1}},{key:"checkReplaceWith",value:function(e,t,n,r,o,i,a){if(1==this.elements.length){var s=this.elements[0];return v(s,t.childCount-(r-n)+1,e,this)?s.matchesType(o,i,a,e,this):!1}var u=this.getMatchAt(e,t,n).matchType(o,i,a);return u?u.matchToEnd(t,r):!1}},{key:"compatible",value:function(e){for(var t=0;t<this.elements.length;t++)for(var n=this.elements[t],r=0;r<e.elements.length;r++)if(e.elements[r].compatible(n))return!0;return!1}},{key:"generateContent",value:function(e){return this.start(e).fillBefore(a.empty,!0)}},{key:"isLeaf",get:function(){return 0==this.elements.length}}],[{key:"parse",value:function(t,n,r){for(var o=[],i=0,a=null;i+=/^\s*/.exec(n.slice(i))[0].length,i!=n.length;){var s=/^(?:(\w+)|\(\s*(\w+(?:\s*\|\s*\w+)*)\s*\))/.exec(n.slice(i));if(!s)throw new SyntaxError("Invalid content expression '"+n+"' at "+i);i+=s[0].length;var u=/^\[([^\]]+)\]/.exec(n.slice(i));u&&(i+=u[0].length);var l=/^<(?:(_)|\s*(\w+(?:\s+\w+)*)\s*)>/.exec(n.slice(i));l&&(i+=l[0].length);var f=/^(?:([+*?])|\{\s*(\d+|\.\w+)\s*(,\s*(\d+|\.\w+)?)?\s*\})/.exec(n.slice(i));f&&(i+=f[0].length);for(var h=y(t.schema,r,s[1]?[s[1]]:s[2].split(/\s*\|\s*/)),p=0;p<h.length;p++)if(null==a)a=h[p].isInline;else if(a!=h[p].isInline)throw new SyntaxError("Mixing inline and block content in a single node");var m=u?k(t,u[1]):null,v=l?l[1]?!0:d(t.schema,l[2].split(/\s+/)):!1,g=b(t,f),w=g.min,x=g.max;if(0!=w&&h[0].hasRequiredAttrs(m))throw new SyntaxError("Node type "+s[0]+" in type "+t.name+" is required, but has non-optional attributes");for(var S=new c(h,m,v,w,x),C=o.length-1;C>=0;C--){var O=o[C];if(O.min!=O.max&&O.overlaps(S))throw new SyntaxError("Possibly ambiguous overlapping adjacent content expressions in '"+n+"'");if(0!=O.min)break}o.push(S)}return new e(t,o,!!a)}}]),e}();n.ContentExpr=l;var c=function(){function e(t,n,r,i,a){o(this,e),this.nodeTypes=t,this.attrs=n,this.marks=r,this.min=i,this.max=a}return r(e,[{key:"matchesType",value:function(e,t,n,r,o){if(-1==this.nodeTypes.indexOf(e))return!1;if(this.attrs){if(!t)return!1;for(var i in this.attrs)if(t[i]!=m(this.attrs[i],r,o))return!1}if(this.marks===!0)return!0;if(this.marks===!1)return 0==n.length;for(var a=0;a<n.length;a++)if(-1==this.marks.indexOf(n[a].type))return!1;return!0}},{key:"matches",value:function(e,t,n){return this.matchesType(e.type,e.attrs,e.marks,t,n)}},{key:"compatible",value:function(e){for(var t=0;t<this.nodeTypes.length;t++)if(-1!=e.nodeTypes.indexOf(this.nodeTypes[t]))return!0;return!1}},{key:"constrainedAttrs",value:function(e,t){if(!this.attrs)return null;var n=Object.create(null);for(var r in this.attrs)n[r]=m(this.attrs[r],e,t);return n}},{key:"createFiller",value:function(e,t){var n=this.nodeTypes[0],r=n.computeAttrs(this.constrainedAttrs(e,t));return n.create(r,n.contentExpr.generateContent(r))}},{key:"defaultType",value:function(){return this.nodeTypes[0].defaultAttrs&&this.nodeTypes[0]}},{key:"overlaps",value:function(e){return this.nodeTypes.some(function(t){return e.nodeTypes.indexOf(t)>-1})}},{key:"allowsMark",value:function(e){return this.marks===!0||this.marks&&this.marks.indexOf(e)>-1}}]),e}(),f=function(){function e(t,n,r,i){o(this,e),this.expr=t,this.attrs=n,this.index=r,this.count=i}return r(e,[{key:"move",value:function(t,n){return new e(this.expr,this.attrs,t,n)}},{key:"resolveValue",value:function(e){return e instanceof h?m(e,this.attrs,this.expr):e}},{key:"matchNode",value:function(e){return this.matchType(e.type,e.attrs,e.marks)}},{key:"matchType",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?u.none:arguments[2];for(r=this.index,void(o=this.count);r<this.expr.elements.length;r++,o=0){var r,o,i=this.expr.elements[r],a=this.resolveValue(i.max);if(a>o&&i.matchesType(e,t,n,this.attrs,this.expr))return o++,this.move(r,o);if(o<this.resolveValue(i.min))return null}}},{key:"matchFragment",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?e.childCount:arguments[2];if(t==n)return this;var r=t,o=this.expr.elements.length;for(i=this.index,void(a=this.count);o>i;i++,a=0){for(var i,a,s=this.expr.elements[i],u=this.resolveValue(s.max);u>a&&s.matches(e.child(r),this.attrs,this.expr);)if(a++,++r==n)return this.move(i,a);if(a<this.resolveValue(s.min))return null}return!1}},{key:"matchToEnd",value:function(e,t,n){var r=this.matchFragment(e,t,n);return r&&r.validEnd()||!1}},{key:"validEnd",value:function(){for(var e=this.index,t=this.count;e<this.expr.elements.length;e++,t=0)if(t<this.resolveValue(this.expr.elements[e].min))return!1;return!0}},{key:"fillBefore",value:function(e,t,n){for(var r=[],o=this,i=n||0,s=this.expr.elements.length;;){var u=o.matchFragment(e,i);if(u&&(!t||u.validEnd()))return a.from(r);if(u===!1)return null;var l=o.element;if(o.count<this.resolveValue(l.min))r.push(l.createFiller(this.attrs,this.expr)),o=o.move(o.index,o.count+1);else{if(!(o.index<s))return e.childCount>i?null:a.from(r);o=o.move(o.index+1,0)}}}},{key:"possibleContent",value:function(){for(var e=[],t=this.index,n=this.count;t<this.expr.elements.length;t++,n=0){var r=this.expr.elements[t],o=r.constrainedAttrs(this.attrs,this.expr);if(n<this.resolveValue(r.max))for(var i=0;i<r.nodeTypes.length;i++){var a=r.nodeTypes[i];a.hasRequiredAttrs(o)||e.push({type:a,attrs:o})}if(this.resolveValue(r.min)>n)break}return e}},{key:"allowsMark",value:function(e){return this.element.allowsMark(e)}},{key:"findWrapping",value:function(e,t){for(var n=Object.create(null),r={match:this,via:null},o=[r];o.length;){var i=o.shift(),a=i.match;if(a.matchType(e,t)){for(var s=[],u=i;u!=r;u=u.via)s.push({type:u.match.expr.nodeType,attrs:u.match.attrs});return s.reverse()}for(var l=a.possibleContent(),c=0;c<l.length;c++){var f=l[c],h=f.type,p=f.attrs,d=h.computeAttrs(p);h.isLeaf||h.name in n||i!=r&&!a.matchType(h,d).validEnd()||(o.push({match:h.contentExpr.start(d),via:i}),n[h.name]=!0)}}}},{key:"element",get:function(){return this.expr.elements[this.index]}},{key:"nextElement",get:function(){for(var e=this.index,t=this.count;e<this.expr.elements.length;e++){var n=this.expr.elements[e];if(this.resolveValue(n.max)>t)return n;t=0}}}]),e}();n.ContentMatch=f;var h=function w(e){o(this,w),this.attr=e},g=2e9},{"./fragment":36,"./mark":39}],35:[function(e,t,n){"use strict";function r(e,t,n){for(var o=0;;o++){if(o==e.childCount||o==t.childCount)return e.childCount==t.childCount?null:n;var i=e.child(o),a=t.child(o);if(i!=a){if(!i.sameMarkup(a))return n;if(i.isText&&i.text!=a.text){for(var s=0;i.text[s]==a.text[s];s++)n++;return n}if(i.content.size||a.content.size){var u=r(i.content,a.content,n+1);if(null!=u)return u}n+=i.nodeSize}else n+=i.nodeSize}}function o(e,t,n,r){for(var i=e.childCount,a=t.childCount;;){if(0==i||0==a)return i==a?null:{a:n,b:r};var s=e.child(--i),u=t.child(--a),l=s.nodeSize;if(s!=u){if(!s.sameMarkup(u))return{a:n,b:r};if(s.isText&&s.text!=u.text){for(var c=0,f=Math.min(s.text.length,u.text.length);f>c&&s.text[s.text.length-c-1]==u.text[u.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||u.content.size){var h=o(s.content,u.content,n-1,r-1);if(h)return h}n-=l,r-=l}else n-=l,r-=l}}n.findDiffStart=r,n.findDiffEnd=o},{}],36:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){return f.index=e,f.offset=t,f}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./to_dom"),a=i.fragmentToDOM,s=e("./diff"),u=s.findDiffStart,l=s.findDiffEnd,c=function(){function e(t,n){if(o(this,e),this.content=t,this.size=n||0,null==n)for(var r=0;r<t.length;r++)this.size+=t[r].nodeSize}return r(e,[{key:"toString",value:function(){return"<"+this.toStringInner()+">"}},{key:"toStringInner",value:function(){return this.content.join(", ")}},{key:"nodesBetween",value:function(e,t,n,r,o){for(var i=0,a=0;t>a;i++){var s=this.content[i],u=a+s.nodeSize;if(u>e&&n(s,r+a,o,i)!==!1&&s.content.size){var l=a+1;s.nodesBetween(Math.max(0,e-l),Math.min(s.content.size,t-l),n,r+l)}a=u}}},{key:"textBetween",value:function(e,t,n){var r="",o=!0;return this.nodesBetween(e,t,function(i,a){i.isText?(r+=i.text.slice(Math.max(e,a)-a,t-a),o=!n):!o&&i.isBlock&&(r+=n,o=!0)},0),r}},{key:"cut",value:function(t,n){if(null==n&&(n=this.size),0==t&&n==this.size)return this;var r=[],o=0;if(n>t)for(var i=0,a=0;n>a;i++){var s=this.content[i],u=a+s.nodeSize;u>t&&((t>a||u>n)&&(s=s.isText?s.cut(Math.max(0,t-a),Math.min(s.text.length,n-a)):s.cut(Math.max(0,t-a-1),Math.min(s.content.size,n-a-1))),r.push(s),o+=s.nodeSize),a=u}return new e(r,o)}},{key:"cutByIndex",value:function(t,n){return t==n?e.empty:0==t&&n==this.content.length?this:new e(this.content.slice(t,n))}},{key:"append",value:function(t){if(!t.size)return this;if(!this.size)return t;var n=this.lastChild,r=t.firstChild,o=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(o[o.length-1]=n.withText(n.text+r.text),i=1);i<t.content.length;i++)o.push(t.content[i]);return new e(o,this.size+t.size)}},{key:"replaceChild",value:function(t,n){var r=this.content[t];if(r==n)return this;var o=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return o[t]=n,new e(o,i)}},{key:"addToStart",value:function(t){return new e([t].concat(this.content),this.size+t.nodeSize)}},{key:"addToEnd",value:function(t){return new e(this.content.concat(t),this.size+t.nodeSize)}},{key:"toJSON",value:function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null}},{key:"eq",value:function(e){if(this.content.length!=e.content.length)return!1;for(var t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}},{key:"child",value:function(e){var t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}},{key:"maybeChild",value:function(e){return this.content[e]}},{key:"forEach",value:function(e){for(var t=0,n=0;t<this.content.length;t++){var r=this.content[t];e(r,n,t),n+=r.nodeSize}}},{key:"findDiffStart",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return u(this,e,t)}},{key:"findDiffEnd",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1],n=arguments.length<=2||void 0===arguments[2]?e.size:arguments[2];return l(this,e,t,n)}},{key:"findIndex",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?-1:arguments[1];if(0==e)return h(0,e);if(e==this.size)return h(this.content.length,e);if(e>this.size||0>e)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=e)return i==e||t>0?h(n+1,i):h(n,r);r=i}}},{key:"toDOM",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return a(this,e)}},{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}},{key:"childCount",get:function(){return this.content.length}}],[{key:"fromJSON",value:function(t,n){return n?new e(n.map(t.nodeFromJSON)):e.empty}},{key:"fromArray",value:function(t){if(!t.length)return e.empty;for(var n=void 0,r=0,o=0;o<t.length;o++){var i=t[o];r+=i.nodeSize,o&&i.isText&&t[o-1].sameMarkup(i)?(n||(n=t.slice(0,o)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new e(n||t,r)}},{key:"from",value:function(t){return t?t instanceof e?t:Array.isArray(t)?this.fromArray(t):new e([t],t.nodeSize):e.empty}}]),e}();n.Fragment=c;var f={index:0,offset:0};c.empty=new c([],0)},{"./diff":35,"./to_dom":44}],37:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t,n){var r=n.topNode,o=new v(r?r.type:e.nodes.doc,r?r.attrs:null,!0,null,null,n.preserveWhitespace),i=new k(e,n,o);return i.addAll(t,null,n.from,n.to),o.finish(null)}function d(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=e.parent.type.schema,l=m(e,n.preserveWhitespace),c=l.builder,f=l.top,h=n.openLeft,p=e.depth,d=new(function(e){function t(){return a(this,t),s(this,Object.getPrototypeOf(t).apply(this,arguments))}return u(t,e),o(t,[{key:"enter",value:function(e,n,r){return null==h&&(h=e.isTextblock?1:0),h>0&&this.top.match.matchType(e,n)&&(h=0),0==h?i(Object.getPrototypeOf(t.prototype),"enter",this).call(this,e,n,r):(h--,null)}}]),t}(k))(r,n,c);d.addAll(t);for(var v=f.openDepth,y=f.finish(v),g=y.resolve(p),b=g.depth;b>=0&&p==g.end(b);b--)++p;return y.slice(p,y.content.size-v)}function m(e,t){for(var n=void 0,r=void 0,o=0;o<=e.depth;o++){var i=e.node(o),a=i.contentMatchAt(e.index(o));r=0==o?n=new v(i.type,i.attrs,!0,null,a,t):r.start(i.type,i.attrs,!1,a,t)}return{builder:r,top:n}}function w(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function x(e){for(var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,n=void 0,r=[];n=t.exec(e);)r.push(n[1],n[2].trim());return r}function S(e){return e.cached.parseDOMInfo||(e.cached.parseDOMInfo=C(e))}function C(e){var t=[],n=[];for(var r in e.nodes){var o=e.nodes[r],i=o.matchDOMTag;if(i)for(var a in i)t.push({selector:a,node:o,value:i[a]})}for(var s in e.marks){var u=e.marks[s],l=u.matchDOMTag,c=u.matchDOMStyle;if(l)for(var f in l)t.push({selector:f,mark:u,value:l[f]});if(c)for(var h in c)n.push({prop:h,mark:u,value:c[h]})}return{selectors:t,styles:n}}function O(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(w(t,o.selector)){var i=o.value,a=void 0;if(i instanceof Function&&(i=i(t),i===!1))continue;
if(Array.isArray(i)){var s=i,u=r(s,2);i=u[0],a=u[1]}return{node:o.node,mark:o.mark,attrs:i,content:a}}}}function T(e,t,n){for(var r=0;r<e.length;r++){var o=e[r];if(o.prop==t){var i=o.value;if(i instanceof Function&&(i=i(n),i===!1))continue;return{mark:o.mark,attrs:i}}}}var r=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(u){o=!0,i=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function M(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:M(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},l=e("./fragment"),c=l.Fragment,f=e("./mark"),h=f.Mark;n.parseDOM=p,n.parseDOMInContext=d;var v=function(){function e(t,n,r,o,i,s){a(this,e),this.type=t,this.match=i||t.contentExpr.start(n),this.solid=r,this.content=[],this.prev=o,this.openChild=null,this.preserveWhitespace=s}return o(e,[{key:"add",value:function(e){var t=this,n=this.match.matchNode(e);return!n&&e.marks.length&&(e=e.mark(e.marks.filter(function(e){return t.match.allowsMark(e.type)})),n=this.match.matchNode(e)),n?(this.closeChild(),this.content.push(e),this.match=n,e):null}},{key:"start",value:function(t,n,r,o,i){var a=this.match.matchType(t,n);return a?(this.closeChild(),this.match=a,this.openChild=new e(t,n,r,this,o,i)):null}},{key:"closeChild",value:function(e){this.openChild&&(this.content.push(this.openChild.finish(e&&e-1)),this.openChild=null)}},{key:"stripTrailingSpace",value:function(){if(!this.openChild){var e=this.content[this.content.length-1],t=void 0;e&&e.isText&&(t=/\s+$/.exec(e.text))&&(e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-t[0].length)))}}},{key:"finish",value:function(e){this.preserveWhitespace||this.stripTrailingSpace(),this.closeChild(e);var t=c.from(this.content);return e||(t=t.append(this.match.fillBefore(c.empty,!0))),this.content=null,this.type.create(this.match.attrs,t)}},{key:"findPlace",value:function(e,t,n,r){for(var o=void 0,i=void 0,a=this;;a=a.prev){var s=a.match.findWrapping(e,t);if(s&&(!o||o.length>s.length)&&(o=s,i=a,!s.length))break;if(a.solid)break}if(!o)return null;for(var u=0;u<o.length;u++)i=i.start(o[u].type,o[u].attrs,!1);return n?i.add(n)&&i:i.start(e,t,!0,null,r)}},{key:"depth",get:function(){for(var e=0,t=this.prev;t;t=t.prev)e++;return e}},{key:"openDepth",get:function(){for(var e=0,t=this.openChild;t;t=t.openChild)e++;return e}},{key:"posBeforeLastChild",get:function(){for(var e=this.prev?this.prev.posBeforeLastChild+1:0,t=0;t<this.content.length;t++)e+=this.content[t].nodeSize;return e}},{key:"currentPos",get:function(){return this.closeChild(),this.posBeforeLastChild}}]),e}(),y={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},g={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},b={ol:!0,ul:!0},k=function(){function e(t,n,r){a(this,e),this.options=n||{},this.schema=t,this.top=r,this.marks=h.none,this.info=S(t),this.find=n.findPositions}return o(e,[{key:"addMark",value:function(e){var t=this.marks;return this.marks=e.addToSet(this.marks),t}},{key:"addDOM",value:function(e){if(3==e.nodeType){var t=e.nodeValue,n=this.top;/\S/.test(t)||n.type.isTextblock?(this.top.preserveWhitespace||(t=t.replace(/\s+/g," "),/^\s/.test(t)&&n.stripTrailingSpace()),t&&this.insertNode(this.schema.text(t,this.marks)),this.findInText(e)):this.findInside(e)}else if(1==e.nodeType&&!e.hasAttribute("pm-ignore")){var r=e.getAttribute("style");r?this.addElementWithStyles(x(r),e):this.addElement(e)}}},{key:"addElement",value:function(e){var t=e.nodeName.toLowerCase();if(b.hasOwnProperty(t)&&this.normalizeList(e),(!this.options.editableContent||"br"!=t||e.nextSibling)&&!this.parseNodeType(e,t))if(g.hasOwnProperty(t))this.findInside(e);else{var n=y.hasOwnProperty(t)&&this.top;this.addAll(e),n&&this.sync(n)}}},{key:"addElementWithStyles",value:function(e,t){for(var n=this.marks,r=this.marks,o=0;o<e.length;o+=2){var i=T(this.info.styles,e[o],e[o+1]);if(i){if(i.attrs===!1)return;r=i.mark.create(i.attrs).addToSet(r)}}this.marks=r,this.addElement(t),this.marks=n}},{key:"parseNodeType",value:function(e){var t=O(this.info.selectors,e);if(!t)return!1;var n=void 0,r=void 0,o=e,i=this.top.preserveWhitespace;return t.content?(t.content.content===!1?o=null:t.content.content&&(o=t.content.content),null!=t.content.preserveWhitespace&&(i=t.content.preserveWhitespace)):t.node&&t.node.isLeaf&&(o=null),t.node&&t.node.isLeaf?this.insertNode(t.node.create(t.attrs)):t.node?n=this.enter(t.node,t.attrs,i):r=this.addMark(t.mark.create(t.attrs)),o?(this.findAround(e,o,!0),this.addAll(o,n),n?this.sync(n.prev):r&&(this.marks=r),this.findAround(e,o,!0)):this.findInside(e),!0}},{key:"addAll",value:function(e,t,n,r){for(var o=n||0,i=n?e.childNodes[n]:e.firstChild,a=null==r?null:e.childNodes[r];i!=a;i=i.nextSibling,++o)this.findAtPoint(e,o),this.addDOM(i),t&&y.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(t);this.findAtPoint(e,o)}},{key:"insertNode",value:function(e){var t=this.top.findPlace(e.type,e.attrs,e);return t?(this.sync(t),!0):void 0}},{key:"enter",value:function(e,t,n){var r=this.top.findPlace(e,t,null,n);return r?(this.sync(r),r):void 0}},{key:"leave",value:function(){this.top=this.top.prev}},{key:"sync",value:function(e){for(;;){for(var t=e;t;t=t.prev)if(t==this.top)return void(this.top=e);this.leave()}}},{key:"normalizeList",value:function(e){for(var t=e.firstChild,n=null;t;t=t.nextSibling){var r=1==t.nodeType?t.nodeName.toLowerCase():null;r&&b.hasOwnProperty(r)&&n?(n.appendChild(t),t=n):"li"==r?n=t:r&&(n=null)}}},{key:"findAtPoint",value:function(e,t){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.top.currentPos)}},{key:"findInside",value:function(e){if(this.find)for(var t=0;t<this.find.length;t++)null==this.find[t].pos&&e.contains(this.find[t].node)&&(this.find[t].pos=this.top.currentPos)}},{key:"findAround",value:function(e,t,n){if(e!=t&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&e.contains(this.find[r].node)){var o=t.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.top.currentPos)}}},{key:"findInText",value:function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.top.currentPos-(e.nodeValue.length-this.find[t].offset))}}]),e}()},{"./fragment":36,"./mark":39}],38:[function(e,t,n){"use strict";n.Node=e("./node").Node;var r=e("./resolvedpos");n.ResolvedPos=r.ResolvedPos,n.NodeRange=r.NodeRange,n.Fragment=e("./fragment").Fragment;var o=e("./replace");n.Slice=o.Slice,n.ReplaceError=o.ReplaceError,n.Mark=e("./mark").Mark;var i=e("./schema");n.SchemaSpec=i.SchemaSpec,n.Schema=i.Schema,n.NodeType=i.NodeType,n.Block=i.Block,n.Inline=i.Inline,n.Text=i.Text,n.MarkType=i.MarkType,n.Attribute=i.Attribute,n.NodeKind=i.NodeKind;var a=e("./content");n.ContentMatch=a.ContentMatch,n.parseDOMInContext=e("./from_dom").parseDOMInContext},{"./content":34,"./fragment":36,"./from_dom":37,"./mark":39,"./node":40,"./replace":41,"./resolvedpos":42,"./schema":43}],39:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../util/comparedeep"),a=i.compareDeep,s=function(){function e(t,n){o(this,e),this.type=t,this.attrs=n}return r(e,[{key:"toJSON",value:function(){var e={_:this.type.name};for(var t in this.attrs)e[t]=this.attrs[t];return e}},{key:"addToSet",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.type==this.type){if(this.eq(n))return e;var r=e.slice();return r[t]=this,r}if(n.type.rank>this.type.rank)return e.slice(0,t).concat(this).concat(e.slice(t))}return e.concat(this)}},{key:"removeFromSet",value:function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}},{key:"isInSet",value:function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}},{key:"eq",value:function(e){return this==e?!0:this.type!=e.type?!1:a(e.attrs,this.attrs)?!0:!1}}],[{key:"sameSet",value:function(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}},{key:"setFrom",value:function(t){if(!t||0==t.length)return e.none;if(t instanceof e)return[t];var n=t.slice();return n.sort(function(e,t){return e.type.rank-t.type.rank}),n}}]),e}();n.Mark=s,s.none=[]},{"../util/comparedeep":60}],40:[function(e,t,n){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}var r=function O(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:O(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./fragment"),l=u.Fragment,c=e("./mark"),f=c.Mark,h=e("./replace"),p=h.Slice,d=h.replace,m=e("./resolvedpos"),v=m.ResolvedPos,y=e("./to_dom"),g=y.nodeToDOM,b=e("../util/comparedeep"),k=b.compareDeep,w=Object.create(null),x=function(){function e(t,n,r,o){s(this,e),this.type=t,this.attrs=n,this.content=r||l.empty,this.marks=o||f.none}return o(e,[{key:"child",value:function(e){return this.content.child(e)}},{key:"maybeChild",value:function(e){return this.content.maybeChild(e)}},{key:"forEach",value:function(e){this.content.forEach(e)}},{key:"textBetween",value:function(e,t,n){return this.content.textBetween(e,t,n)}},{key:"eq",value:function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}},{key:"sameMarkup",value:function(e){return this.hasMarkup(e.type,e.attrs,e.marks)}},{key:"hasMarkup",value:function(e,t,n){return this.type==e&&k(this.attrs,t||e.defaultAttrs||w)&&f.sameSet(this.marks,n||f.none)}},{key:"copy",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)}},{key:"mark",value:function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)}},{key:"cut",value:function(e,t){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}},{key:"slice",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.content.size:arguments[1];if(e==t)return p.empty;var n=this.resolve(e),r=this.resolve(t),o=n.sameDepth(r),i=n.start(o),a=n.node(o),s=a.content.cut(n.pos-i,r.pos-i);return new p(s,n.depth-o,r.depth-o,a)}},{key:"replace",value:function(e,t,n){return d(this.resolve(e),this.resolve(t),n)}},{key:"nodeAt",value:function(e){for(var t=this;;){var n=t.content.findIndex(e),r=n.index,o=n.offset;if(t=t.maybeChild(r),!t)return null;if(o==e||t.isText)return t;e-=o+1}}},{key:"childAfter",value:function(e){var t=this.content.findIndex(e),n=t.index,r=t.offset;return{node:this.content.maybeChild(n),index:n,offset:r}}},{key:"childBefore",value:function(e){if(0==e)return{node:null,index:0,offset:0};var t=this.content.findIndex(e),n=t.index,r=t.offset;if(e>r)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}}},{key:"nodesBetween",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?0:arguments[3];this.content.nodesBetween(e,t,n,r,this)}},{key:"descendants",value:function(e){this.nodesBetween(0,this.content.size,e)}},{key:"resolve",value:function(e){return v.resolveCached(this,e)}},{key:"resolveNoCache",value:function(e){return v.resolve(this,e)}},{key:"marksAt",value:function(e){var t=this.resolve(e),n=t.parent,r=t.index();if(0==n.content.size)return f.none;if(0==r||!t.atNodeBoundary)return n.child(r).marks;for(var o=n.child(r-1).marks,i=0;i<o.length;i++)o[i].type.inclusiveRight||(o=o[i--].removeFromSet(o));return o}},{key:"rangeHasMark",value:function(e,t,n){var r=!1;return this.nodesBetween(e,t,function(e){return n.isInSet(e.marks)&&(r=!0),!r}),r}},{key:"toString",value:function(){var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),C(this.marks,e)}},{key:"contentMatchAt",value:function(e){return this.type.contentExpr.getMatchAt(this.attrs,this.content,e)}},{key:"canReplace",value:function(e,t,n,r,o){return this.type.contentExpr.checkReplace(this.attrs,this.content,e,t,n,r,o)}},{key:"canReplaceWith",value:function(e,t,n,r,o){return this.type.contentExpr.checkReplaceWith(this.attrs,this.content,e,t,n,r,o||f.none)}},{key:"canAppend",value:function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}},{key:"defaultContentType",value:function(e){var t=this.contentMatchAt(e).nextElement;return t&&t.defaultType()}},{key:"toJSON",value:function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(e){return e.toJSON()})),e}},{key:"toDOM",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return g(this,e)}},{key:"nodeSize",get:function(){return this.type.isLeaf?1:2+this.content.size}},{key:"childCount",get:function(){return this.content.childCount}},{key:"textContent",get:function(){return this.textBetween(0,this.content.size,"")}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}}],[{key:"fromJSON",value:function(e,t){var n=e.nodeType(t.type),r=null!=t.text?t.text:l.fromJSON(e,t.content);return n.create(t.attrs,r,t.marks&&t.marks.map(e.markFromJSON))}}]),e}();n.Node=x;var S=function(e){function t(e,n,r,o){s(this,t);var a=i(this,Object.getPrototypeOf(t).call(this,e,n,null,o));if(!r)throw new RangeError("Empty text nodes are not allowed");return a.text=r,a}return a(t,e),o(t,[{key:"toString",value:function(){return C(this.marks,JSON.stringify(this.text))}},{key:"textBetween",value:function(e,t){return this.text.slice(e,t)}},{key:"mark",value:function(e){return new t(this.type,this.attrs,this.text,e)}},{key:"withText",value:function(e){return e==this.text?this:new t(this.type,this.attrs,e,this.marks)}},{key:"cut",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.text.length:arguments[1];return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}},{key:"eq",value:function(e){return this.sameMarkup(e)&&this.text==e.text}},{key:"toJSON",value:function(){var e=r(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return e.text=this.text,e}},{key:"textContent",get:function(){return this.text}},{key:"nodeSize",get:function(){return this.text.length}}]),t}(x);n.TextNode=S},{"../util/comparedeep":60,"./fragment":36,"./mark":39,"./replace":41,"./resolvedpos":42,"./to_dom":44}],41:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t,n){if(n.openLeft>e.depth)throw new f("Inserted content deeper than insertion position");if(e.depth-n.openLeft!=t.depth-n.openRight)throw new f("Inconsistent open depths");return d(e,t,n,0)}function d(e,t,n,r){var o=e.index(r),i=e.node(r);if(o==t.index(r)&&r<e.depth-n.openLeft){var a=d(e,t,n,r+1);return i.copy(i.content.replaceChild(o,a))}if(n.content.size){var s=x(n,e),u=s.start,l=s.end;return b(i,k(e,u,l,t,r))}return b(i,w(e,t,r))}function m(e,t){if(!t.type.compatibleContent(e.type))throw new f("Cannot join "+t.type.name+" onto "+e.type.name)}function v(e,t,n){var r=e.node(n);return m(r,t.node(n)),r}function y(e,t){var n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function g(e,t,n,r){var o=(t||e).node(n),i=0,a=t?t.index(n):o.childCount;e&&(i=e.index(n),e.depth>n?i++:e.atNodeBoundary||(y(e.nodeAfter,r),i++));for(var s=i;a>s;s++)y(o.child(s),r);t&&t.depth==n&&!t.atNodeBoundary&&y(t.nodeBefore,r)}function b(e,t){if(!e.type.validContent(t,e.attrs))throw new f("Invalid content for node "+e.type.name);return e.copy(t)}function k(e,t,n,r,o){var i=e.depth>o&&v(e,t,o+1),a=r.depth>o&&v(n,r,o+1),s=[];return g(null,e,o,s),i&&a&&t.index(o)==n.index(o)?(m(i,a),y(b(i,k(e,t,n,r,o+1)),s)):(i&&y(b(i,w(e,t,o+1)),s),g(t,n,o,s),a&&y(b(a,w(n,r,o+1)),s)),g(r,null,o,s),new c(s)}function w(e,t,n){var r=[];if(g(null,e,n,r),e.depth>n){var o=v(e,t,n+1);y(b(o,w(e,t,n+1)),r)}return g(t,null,n,r),new c(r)}function x(e,t){for(var n=t.depth-e.openLeft,r=t.node(n),o=r.copy(e.content),i=n-1;i>=0;i--)o=t.node(i).copy(c.from(o));return{start:o.resolveNoCache(e.openLeft+n),end:o.resolveNoCache(o.content.size-e.openRight-n)}}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../util/error"),u=s.ProseMirrorError,l=e("./fragment"),c=l.Fragment,f=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),t}(u);n.ReplaceError=f;var h=function(){function e(t,n,r,i){o(this,e),this.content=t,this.openLeft=n,this.openRight=r,this.possibleParent=i}return r(e,[{key:"insertAt",value:function(t,n){function r(e,t,n,o){var i=e.findIndex(t),a=i.index,s=i.offset,u=e.maybeChild(a);if(s==t||u.isText)return o&&!o.canReplace(a,a,n)?null:e.cut(0,t).append(n).append(e.cut(t));var l=r(u.content,t-s-1,n);return l&&e.replaceChild(a,u.copy(l))}var o=r(this.content,t+this.openLeft,n,null);return o&&new e(o,this.openLeft,this.openRight)}},{key:"removeBetween",value:function(t,n){function r(e,t,n){var o=e.findIndex(t),i=o.index,a=o.offset,s=e.maybeChild(i),u=e.findIndex(n),l=u.index,c=u.offset;if(a==t||s.isText){if(c!=n&&!e.child(l).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(i!=l)throw new RangeError("Removing non-flat range");return e.replaceChild(i,s.copy(r(s.content,t-a-1,n-a-1)))}return new e(r(this.content,t+this.openLeft,n+this.openLeft),this.openLeft,this.openRight)}},{key:"toString",value:function(){return this.content+"("+this.openLeft+","+this.openRight+")"}},{key:"toJSON",value:function(){return this.content.size?{content:this.content.toJSON(),openLeft:this.openLeft,openRight:this.openRight}:null}},{key:"size",get:function(){return this.content.size-this.openLeft-this.openRight}}],[{key:"fromJSON",value:function(t,n){return n?new e(c.fromJSON(t,n.content),n.openLeft,n.openRight):e.empty}}]),e}();n.Slice=h,h.empty=new h(c.empty,0,0),n.replace=p},{"../util/error":62,"./fragment":36}],42:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r){o(this,e),this.pos=t,this.path=n,this.depth=n.length/3-1,this.parentOffset=r}return r(e,[{key:"resolveDepth",value:function(e){return null==e?this.depth:0>e?this.depth+e:e}},{key:"node",value:function(e){return this.path[3*this.resolveDepth(e)]}},{key:"index",value:function(e){return this.path[3*this.resolveDepth(e)+1]}},{key:"indexAfter",value:function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&this.atNodeBoundary?0:1)}},{key:"start",value:function(e){return e=this.resolveDepth(e),0==e?0:this.path[3*e-1]+1}},{key:"end",value:function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}},{key:"before",value:function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}},{key:"after",value:function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}},{key:"sameDepth",value:function(e){for(var t=0,n=Math.min(this.depth,e.depth);n>t&&this.index(t)==e.index(t);)++t;return t}},{key:"blockRange",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this:arguments[0],t=arguments[1];if(e.pos<this.pos)return e.blockRange(this);for(var n=this.depth-(this.parent.isTextblock||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new l(this,e,n)}},{key:"sameParent",value:function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}},{key:"toString",value:function(){for(var e="",t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}},{key:"plusOne",value:function(){var t=this.path.slice(),n=this.nodeAfter.nodeSize;t[t.length-2]+=1;var r=t[t.length-1]=this.pos+n;return new e(r,t,this.parentOffset+n)}},{key:"parent",get:function(){return this.node(this.depth)}},{key:"atNodeBoundary",get:function(){return this.path[this.path.length-1]==this.pos}},{key:"nodeAfter",get:function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}},{key:"nodeBefore",get:function(){var e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}}],[{key:"resolve",value:function(t,n){if(!(n>=0&&n<=t.content.size))throw new RangeError("Position "+n+" out of range");for(var r=[],o=0,i=n,a=t;;){var s=a.content.findIndex(i),u=s.index,l=s.offset,c=i-l;if(r.push(a,u,o+l),!c)break;if(a=a.child(u),a.isText)break;i=c-1,o+=l+1}return new e(n,r,i)}},{key:"resolveCached",value:function(t,n){for(var r=0;r<a.length;r++){var o=a[r];if(o.pos==n&&o.node(0)==t)return o}var i=a[s]=e.resolve(t,n);return s=(s+1)%u,i}}]),e}();n.ResolvedPos=i;var a=[],s=0,u=6,l=function(){function e(t,n,r){o(this,e),this.$from=t,this.$to=n,this.depth=r}return r(e,[{key:"start",get:function(){return this.$from.before(this.depth+1)}},{key:"end",get:function(){return this.$to.after(this.depth+1)}},{key:"parent",get:function(){return this.$from.node(this.depth)}},{key:"startIndex",get:function(){return this.$from.index(this.depth)}},{key:"endIndex",get:function(){return this.$to.indexAfter(this.depth)}}]),e}();n.NodeRange=l},{}],43:[function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e){var t=Object.create(null);for(var n in e){var r=e[n];if(void 0===r.default)return null;t[n]=r.default}return t}function S(e,t){var n=Object.create(null);for(var r in e){var o=t&&t[r];if(null==o){var i=e[r];if(void 0!==i.default)o=i.default;else{if(!i.compute)throw new RangeError("No value supplied for attribute "+r);o=i.compute()}}n[r]=o}return n}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./node"),u=s.Node,l=s.TextNode,c=e("./fragment"),f=c.Fragment,h=e("./mark"),p=h.Mark,d=e("./content"),m=d.ContentExpr,v=e("./from_dom"),y=v.parseDOM,g=e("../util/obj"),b=g.copyObj,k=e("../util/orderedmap"),w=k.OrderedMap,C=function(){function e(t,n){a(this,e),this.name=t,Object.defineProperty(this,"attrs",{value:b(this.attrs)}),this.defaultAttrs=x(this.attrs),this.contentExpr=null,this.schema=n}return r(e,[{key:"hasRequiredAttrs",value:function(e){for(var t in this.attrs)if(this.attrs[t].isRequired&&(!e||!(t in e)))return!0;return!1}},{key:"compatibleContent",value:function(e){return this==e||this.contentExpr.compatible(e.contentExpr)}},{key:"computeAttrs",value:function(e){return!e&&this.defaultAttrs?this.defaultAttrs:S(this.attrs,e)}},{key:"create",value:function(e,t,n){return new u(this,this.computeAttrs(e),f.from(t),p.setFrom(n))}},{key:"createChecked",value:function(e,t,n){if(e=this.computeAttrs(e),t=f.from(t),!this.validContent(t,e))throw new RangeError("Invalid content for node "+this.name);return new u(this,e,t,p.setFrom(n))}},{key:"createAndFill",value:function(e,t,n){if(e=this.computeAttrs(e),t=f.from(t),t.size){var r=this.contentExpr.start(e).fillBefore(t);if(!r)return null;t=r.append(t)}var o=this.contentExpr.getMatchAt(e,t).fillBefore(f.empty,!0);return o?new u(this,e,t.append(o),p.setFrom(n)):null}},{key:"validContent",value:function(e,t){return this.contentExpr.matches(t,e)}},{key:"toDOM",value:function(){throw new Error("Failed to override NodeType.toDOM")}},{key:"isBlock",get:function(){return!1}},{key:"isTextblock",get:function(){return!1}},{key:"isInline",get:function(){return!1}},{key:"isText",get:function(){return!1}},{key:"isLeaf",get:function(){return this.contentExpr.isLeaf}},{key:"selectable",get:function(){return!0}},{key:"draggable",get:function(){return!1}},{key:"matchDOMTag",get:function(){}}],[{key:"compile",value:function(e,t){var n=Object.create(null);if(e.forEach(function(e,r){return n[e]=new r.type(e,t)}),!n.doc)throw new RangeError("Every schema needs a 'doc' type");if(!n.text)throw new RangeError("Every schema needs a 'text' type");return n}}]),e}();n.NodeType=C;var O=function(e){function t(){return a(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),r(t,[{key:"isBlock",get:function(){return!0}},{key:"isTextblock",get:function(){return this.contentExpr.inlineContent}}]),t}(C);n.Block=O;var T=function(e){function t(){return a(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),r(t,[{key:"isInline",get:function(){return!0}}]),t}(C);n.Inline=T;var M=function(e){function t(){return a(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),r(t,[{key:"create",value:function(e,t,n){return new l(this,this.computeAttrs(e),t,n)}},{key:"toDOM",value:function(e){return e.text}},{key:"selectable",get:function(){return!1}},{key:"isText",get:function(){return!0}}]),t}(T);n.Text=M;var A=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,e),this.default=t.default,this.compute=t.compute}return r(e,[{key:"isRequired",get:function(){return void 0===this.default&&!this.compute}}]),e}();n.Attribute=A;var E=function(){function e(t,n,r){a(this,e),this.name=t,Object.defineProperty(this,"attrs",{value:b(this.attrs)}),this.rank=n,this.schema=r;var o=x(this.attrs);this.instance=o&&new p(this,o)}return r(e,[{key:"create",value:function(e){return!e&&this.instance?this.instance:new p(this,S(this.attrs,e))}},{key:"removeFromSet",value:function(e){for(var t=0;t<e.length;t++)if(e[t].type==this)return e.slice(0,t).concat(e.slice(t+1));return e}},{key:"isInSet",value:function(e){for(var t=0;t<e.length;t++)if(e[t].type==this)return e[t]}},{key:"toDOM",value:function(){throw new Error("Failed to override MarkType.toDOM")}},{key:"inclusiveRight",get:function(){return!0}},{key:"matchDOMTag",get:function(){}},{key:"matchDOMStyle",get:function(){}}],[{key:"compile",value:function(e,t){var n=Object.create(null),r=0;return e.forEach(function(e,o){return n[e]=new o(e,r++,t)}),n}}]),e}();n.MarkType=E;var N=function(){function e(t,n){a(this,e),this.nodeSpec=w.from(t.nodes),this.markSpec=w.from(t.marks),this.data=n,this.nodes=C.compile(this.nodeSpec,this),this.marks=E.compile(this.markSpec,this);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r];o.contentExpr=m.parse(o,this.nodeSpec.get(r).content||"",this.nodeSpec)}this.cached=Object.create(null),this.cached.wrappings=Object.create(null),this.node=this.node.bind(this),this.text=this.text.bind(this),this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this)}return r(e,[{key:"node",value:function(e,t,n,r){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof C))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,r)}},{key:"text",value:function(e,t){return this.nodes.text.create(null,e,p.setFrom(t))}},{key:"mark",value:function(e,t){var n=this.marks[e];if(!n)throw new RangeError("No mark named "+e);return n.create(t)}},{key:"nodeFromJSON",value:function(e){return u.fromJSON(this,e)}},{key:"markFromJSON",value:function(e){var t=this.marks[e._],n=null;for(var r in e)"_"!=r&&(n||(n=Object.create(null)),n[r]=e[r]);return n?t.create(n):t.instance}},{key:"nodeType",value:function(e){var t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}},{key:"parseDOM",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return y(this,e,t)}}]),e}();n.Schema=N},{"../util/obj":64,"../util/orderedmap":65,"./content":34,"./fragment":36,"./from_dom":37,"./mark":39,"./node":40}],44:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")
}function s(e,t){return new a(t).renderFragment(e,null,t.pos||0)}function u(e,t){var n=new a(t),r=t.pos||0,o=n.renderNode(e,r,t.offset||0);return e.isInline&&(o=n.wrapInlineFlat(o,e.marks),n.options.renderInlineFlat&&(o=t.renderInlineFlat(e,o,r,t.offset||0)||o)),o}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){i(this,e),this.options=t||{},this.doc=this.options.document||window.document}return o(e,[{key:"renderNode",value:function(e,t,n){var r=this.renderStructure(e.type.toDOM(e),e.content,t+1);return this.options.onRender&&(r=this.options.onRender(e,r,t,n)||r),r}},{key:"renderStructure",value:function(e,t,n){if("string"==typeof e)return this.doc.createTextNode(e);if(null!=e.nodeType)return e;var o=this.doc.createElement(e[0]),i=e[1],a=1;if(i&&"object"==("undefined"==typeof i?"undefined":r(i))&&null==i.nodeType&&!Array.isArray(i)){a=2;for(var s in i)"style"==s?o.style.cssText=i[s]:i[s]&&o.setAttribute(s,i[s])}for(var u=a;u<e.length;u++){var l=e[u];if(0===l){if(!t)throw new RangeError("Content hole not allowed in a Mark spec (must produce a single node)");if(u<e.length-1||u>a)throw new RangeError("Content hole must be the only child of its parent node");this.options.onContainer&&this.options.onContainer(o),this.renderFragment(t,o,n)}else o.appendChild(this.renderStructure(l,t,n))}return o}},{key:"renderFragment",value:function(e,t,n){return t||(t=this.doc.createDocumentFragment()),0==e.size?t:(e.firstChild.isInline?this.options.renderInlineFlat?this.renderInlineFlatInto(e,t,n):this.renderInlineInto(e,t,n):this.renderBlocksInto(e,t,n),t)}},{key:"renderBlocksInto",value:function(e,t,n){var r=this;e.forEach(function(e,o){return t.appendChild(r.renderNode(e,n+o,o))})}},{key:"renderInlineInto",value:function(e,t,n){var r=this,o=t,i=[];e.forEach(function(e,t){for(var a=0;a<Math.min(i.length,e.marks.length)&&e.marks[a].eq(i[a]);++a);for(;a<i.length;)i.pop(),o=o.parentNode;for(;i.length<e.marks.length;){var s=e.marks[i.length];i.push(s),o=o.appendChild(r.renderMark(s))}o.appendChild(r.renderNode(e,n+t,t))})}},{key:"renderInlineFlatInto",value:function(e,t,n){var r=this;e.forEach(function(e,o){var i=n+o,a=r.renderNode(e,i,o);a=r.wrapInlineFlat(a,e.marks),a=r.options.renderInlineFlat(e,a,i,o)||a,t.appendChild(a)})}},{key:"renderMark",value:function(e){return this.renderStructure(e.type.toDOM(e))}},{key:"wrapInlineFlat",value:function(e,t){for(var n=t.length-1;n>=0;n--){var r=this.renderMark(t[n]);r.appendChild(e),e=r}return e}}]),e}();n.fragmentToDOM=s,n.nodeToDOM=u},{}],45:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../model"),u=s.Schema,l=s.Block,c=s.Inline,f=s.Text,h=s.Attribute,p=s.MarkType;n.Text=f;var d=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),t}(l);n.Doc=d;var m=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["blockquote",0]}},{key:"matchDOMTag",get:function(){return{blockquote:null}}}]),t}(l);n.BlockQuote=m;var v=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(e){return["ol",{start:1==e.attrs.order?null:e.attrs.order},0]}},{key:"attrs",get:function(){return{order:new h({"default":1})}}},{key:"matchDOMTag",get:function(){return{ol:function(e){return{order:e.hasAttribute("start")?+e.getAttribute("start"):1}}}}}]),t}(l);n.OrderedList=v;var y=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["ul",0]}},{key:"matchDOMTag",get:function(){return{ul:null}}}]),t}(l);n.BulletList=y;var g=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["li",0]}},{key:"matchDOMTag",get:function(){return{li:null}}}]),t}(l);n.ListItem=g;var b=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["div",["hr"]]}},{key:"matchDOMTag",get:function(){return{hr:null}}}]),t}(l);n.HorizontalRule=b;var k=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(e){return["h"+e.attrs.level,0]}},{key:"attrs",get:function(){return{level:new h({"default":1})}}},{key:"maxLevel",get:function(){return 6}},{key:"matchDOMTag",get:function(){return{h1:{level:1},h2:{level:2},h3:{level:3},h4:{level:4},h5:{level:5},h6:{level:6}}}}]),t}(l);n.Heading=k;var w=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["pre",["code",0]]}},{key:"isCode",get:function(){return!0}},{key:"matchDOMTag",get:function(){return{pre:[null,{preserveWhitespace:!0}]}}}]),t}(l);n.CodeBlock=w;var x=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["p",0]}},{key:"matchDOMTag",get:function(){return{p:null}}}]),t}(l);n.Paragraph=x;var S=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(e){return["img",e.attrs]}},{key:"attrs",get:function(){return{src:new h,alt:new h({"default":""}),title:new h({"default":""})}}},{key:"draggable",get:function(){return!0}},{key:"matchDOMTag",get:function(){return{"img[src]":function(e){return{src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt")}}}}}]),t}(c);n.Image=S;var C=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["br"]}},{key:"selectable",get:function(){return!1}},{key:"isBR",get:function(){return!0}},{key:"matchDOMTag",get:function(){return{br:null}}}]),t}(c);n.HardBreak=C;var O=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["em"]}},{key:"matchDOMTag",get:function(){return{i:null,em:null}}},{key:"matchDOMStyle",get:function(){return{"font-style":function(e){return"italic"==e&&null}}}}]),t}(p);n.EmMark=O;var T=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["strong"]}},{key:"matchDOMTag",get:function(){return{b:null,strong:null}}},{key:"matchDOMStyle",get:function(){return{"font-weight":function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}}}]),t}(p);n.StrongMark=T;var M=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(e){return["a",e.attrs]}},{key:"attrs",get:function(){return{href:new h,title:new h({"default":""})}}},{key:"matchDOMTag",get:function(){return{"a[href]":function(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}}}]),t}(p);n.LinkMark=M;var A=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["code"]}},{key:"isCode",get:function(){return!0}},{key:"matchDOMTag",get:function(){return{code:null}}}]),t}(p);n.CodeMark=A;var E=new u({nodes:{doc:{type:d,content:"block+"},paragraph:{type:x,content:"inline<_>*",group:"block"},blockquote:{type:m,content:"block+",group:"block"},ordered_list:{type:v,content:"list_item+",group:"block"},bullet_list:{type:y,content:"list_item+",group:"block"},horizontal_rule:{type:b,group:"block"},heading:{type:k,content:"inline<_>*",group:"block"},code_block:{type:w,content:"text*",group:"block"},list_item:{type:g,content:"paragraph block*"},text:{type:f,group:"inline"},image:{type:S,group:"inline"},hard_break:{type:C,group:"inline"}},marks:{em:O,strong:T,link:M,code:A}});n.schema=E},{"../model":38}],46:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function C(e,t,n){return e.append({table:{type:w,content:"table_row[columns=.columns]+",group:n},table_row:{type:x,content:"table_cell{.columns}"},table_cell:{type:S,content:t}})}function O(e,t,n,r){r=r?g(r):Object.create(null),r.columns=n;for(var o=e.contentExpr.elements[0].nodeTypes[0],i=o.contentExpr.elements[0].nodeTypes[0],a=i.createAndFill(),s=[],u=0;n>u;u++)s.push(a);for(var l=o.create({columns:n},c.from(s)),f=[],h=0;t>h;h++)f.push(l);return e.create(r,c.from(f))}function T(e,t){var n=g(e);return n.columns=e.columns+t,n}function E(e,t){for(var n=e.depth;n>0;n--)if(e.node(n).type instanceof x&&(!t||t(n)))return n;return-1}function N(e,t){var n=e.selection.$from,r=void 0,o=E(n,function(e){return r=e==n.depth?n.nodeBefore:n.node(e+1)});return-1==o?!1:(t!==!1&&e.tr.step(M.create(e.doc,n.before(o-1),n.index(o),r.type,r.attrs)).apply(),!0)}function D(e,t){var n=e.selection.$from,r=void 0,o=E(n,function(e){return r=e==n.depth?n.nodeAfter:n.node(e+1)});return-1==o?!1:(t!==!1&&e.tr.step(M.create(e.doc,n.before(o-1),n.indexAfter(o)+(o==n.depth?1:0),r.type,r.attrs)).apply(),!0)}function R(e,t){var n=e.selection.$from,r=E(n,function(e){return n.node(e).childCount>1});return-1==r?!1:(t!==!1&&e.tr.step(A.create(e.doc,n.before(r-1),n.index(r))).apply(),!0)}function P(e,t,n){var r=e.selection.$from,o=E(r);return-1==o?!1:(t!==!1&&!function(){var t=r.node(o),i=[],a=0>n?r.before(o):r.after(o);t.forEach(function(e){return i.push(e.type.createAndFill(e.attrs))});var s=t.copy(c.from(i));e.tr.step(new v(a,a,new f(c.from(s),0,0))).apply()}(),!0)}function j(e,t){return P(e,t,-1)}function I(e,t){return P(e,t,1)}function z(e,t){var n=e.selection.$from,r=E(n,function(e){return n.node(e-1).childCount>1});return-1==r?!1:(t!==!1&&e.tr.step(new v(n.before(r),n.after(r),f.empty)).apply(),!0)}function B(e,t,n){var r=e.selection.$from,o=E(r);if(-1==o)return!1;var i=r.node(o),a=r.index(o)+t;if(a>=0&&a<i.childCount){var s=e.doc.resolve(i.content.offsetAt(a)+r.start(o)),u=k.findFrom(s,1);return!u||u.from>=s.end()?!1:(n!==!1&&e.setSelection(u),!0)}var l=r.index(o-1)+t,c=r.node(o-1);if(0>l||l>=c.childCount)return!1;var f=t>0?r.after(o)+2:r.before(o)-2-c.child(l).lastChild.content.size,h=e.doc.resolve(f),p=k.findFrom(h,1);return!p||p.from>=h.end()?!1:(n!==!1&&e.setSelection(p),!0)}function L(e,t){return B(e,1,t)}function F(e,t){return B(e,-1,t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../model"),u=s.Block,l=s.Attribute,c=s.Fragment,f=s.Slice,h=e("../transform"),p=h.Step,d=h.StepResult,m=h.PosMap,v=h.ReplaceStep,y=e("../util/obj"),g=y.copyObj,b=e("../edit"),k=b.Selection,w=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["table",["tbody",0]]}},{key:"attrs",get:function(){return{columns:new l({"default":1})}}},{key:"matchDOMTag",get:function(){return{table:function(e){var t=e.querySelector("tr");return t&&t.children.length?{columns:t.children.length}:!1}}}}]),t}(u);n.Table=w;var x=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["tr",0]}},{key:"attrs",get:function(){return{columns:new l({"default":1})}}},{key:"matchDOMTag",get:function(){return{tr:function(e){return e.children.length?{columns:e.children.length}:!1}}}}]),t}(u);n.TableRow=x;var S=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),r(t,[{key:"toDOM",value:function(){return["td",0]}},{key:"matchDOMTag",get:function(){return{td:null}}}]),t}(u);n.TableCell=S,n.addTableNodes=C,n.createTable=O;var M=function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r.positions=e,r.cells=n,r}return a(t,e),r(t,[{key:"apply",value:function(e){for(var t=null,n=null,r=null,o=0;o<this.positions.length;o++){var i=e.resolve(this.positions[o]);if(i.depth<2||i.index(-1)!=o)return d.fail("Invalid cell insert position");if(null==n){if(n=i.node(-1),n.childCount!=this.positions.length)return d.fail("Mismatch in number of rows");r=i.before(-1),t=i.index()}else if(i.before(-1)!=r||i.index()!=t)return d.fail("Column insert positions not consistent")}for(var a=[],s=0;s<n.childCount;s++){for(var u=n.child(s),l=t?[]:[this.cells[s]],h=0;h<u.childCount;h++)l.push(u.child(h)),h+1==t&&l.push(this.cells[s]);a.push(u.type.create(T(u.attrs,1),c.from(l)))}var p=n.type.create(T(n.attrs,1),c.from(a));return d.fromReplace(e,r,r+n.nodeSize,new f(c.from(p),0,0))}},{key:"posMap",value:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t],0,this.cells[t].nodeSize);return new m(e)}},{key:"invert",value:function(e){for(var t=e.resolve(this.positions[0]),n=t.node(-1),r=[],o=[],i=0,a=0;a<n.childCount;a++){var s=this.positions[a]+i,u=this.cells[a].nodeSize;r.push(s),o.push(s+u),i+=u}return new A(r,o)}},{key:"map",value:function(e){return new t(this.positions.map(function(t){return e.map(t)}),this.cells)}},{key:"toJSON",value:function(){return{stepType:this.jsonID,positions:this.positions,cells:this.cells.map(function(e){return e.toJSON()})}}}],[{key:"create",value:function(e,n,r,o,i){var a=o.createAndFill(i),s=[],u=[],l=e.nodeAt(n);return l.forEach(function(e,t){for(var o=n+2+t,i=0;r>i;i++)o+=e.child(i).nodeSize;s.push(o),u.push(a)}),new t(s,u)}},{key:"fromJSON",value:function(e,n){return new t(n.positions,n.cells.map(e.nodeFromJSON))}}]),t}(p);n.AddColumnStep=M,p.jsonID("addTableColumn",M);var A=function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r.from=e,r.to=n,r}return a(t,e),r(t,[{key:"apply",value:function(e){for(var t=null,n=null,r=null,o=0;o<this.from.length;o++){var i=e.resolve(this.from[o]),a=i.nodeAfter;if(i.depth<2||i.index(-1)!=o||!a||this.from[o]+a.nodeSize!=this.to[o])return d.fail("Invalid cell delete positions");if(null==n){if(n=i.node(-1),n.childCount!=this.from.length)return d.fail("Mismatch in number of rows");r=i.before(-1),t=i.index()}else if(i.before(-1)!=r||i.index()!=t)return d.fail("Column delete positions not consistent")}for(var s=[],u=0;u<n.childCount;u++){for(var l=n.child(u),h=[],p=0;p<l.childCount;p++)p!=t&&h.push(l.child(p));s.push(l.type.create(T(l.attrs,-1),c.from(h)))}var m=n.type.create(T(n.attrs,-1),c.from(s));return d.fromReplace(e,r,r+n.nodeSize,new f(c.from(m),0,0))}},{key:"posMap",value:function(){for(var e=[],t=0;t<this.from.length;t++)e.push(this.from[t],this.to[t]-this.from[t],0);return new m(e)}},{key:"invert",value:function(e){for(var t=e.resolve(this.from[0]),n=t.node(-1),r=t.index(),o=[],i=[],a=0,s=0;s<n.childCount;s++){o.push(this.from[s]-a);var u=n.child(s).child(r);a+=u.nodeSize,i.push(u)}return new M(o,i)}},{key:"map",value:function(e){for(var n=[],r=[],o=0;o<this.from.length;o++){var i=e.map(this.from[o],1),a=e.map(this.to[o],-1);if(i>=a)return null;n.push(i),r.push(a)}return new t(n,r)}}],[{key:"create",value:function(e,n,r){var o=[],i=[],a=e.nodeAt(n);return a.forEach(function(e,t){for(var a=n+2+t,s=0;r>s;s++)a+=e.child(s).nodeSize;o.push(a),i.push(a+e.child(r).nodeSize)}),new t(o,i)}},{key:"fromJSON",value:function(e,n){return new t(n.from,n.to)}}]),t}(p);n.RemoveColumnStep=A,p.jsonID("removeTableColumn",A),n.addColumnBefore=N,n.addColumnAfter=D,n.removeColumn=R,n.addRowBefore=j,n.addRowAfter=I,n.removeRow=z,n.selectNextCell=L,n.selectPreviousCell=F},{"../edit":11,"../model":38,"../transform":47,"../util/obj":64}],47:[function(e,t,n){"use strict";var r=e("./transform");n.Transform=r.Transform,n.TransformError=r.TransformError;var o=e("./step");n.Step=o.Step,n.StepResult=o.StepResult;var i=e("./structure");n.joinPoint=i.joinPoint,n.joinable=i.joinable,n.canSplit=i.canSplit,n.insertPoint=i.insertPoint,n.liftTarget=i.liftTarget,n.findWrapping=i.findWrapping;var a=e("./map");n.PosMap=a.PosMap,n.MapResult=a.MapResult,n.Remapping=a.Remapping,n.mapThrough=a.mapThrough,n.mapThroughResult=a.mapThroughResult;var s=e("./mark_step");n.AddMarkStep=s.AddMarkStep,n.RemoveMarkStep=s.RemoveMarkStep;var u=e("./replace_step");n.ReplaceStep=u.ReplaceStep,n.ReplaceAroundStep=u.ReplaceAroundStep,e("./mark"),e("./replace")},{"./map":48,"./mark":49,"./mark_step":50,"./replace":51,"./replace_step":52,"./step":53,"./structure":54,"./transform":55}],48:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){return e+t*a}function u(e){return e&i}function l(e){return(e-(e&i))/a}function p(e,t,n,r){for(var o=r||0;o<e.length;o++)t=e[o].map(t,n);return t}function d(e,t,n,r){for(var o=!1,i=r||0;i<e.length;i++){var a=e[i].mapResult(t,n);t=a.pos,a.deleted&&(o=!0)}return new c(t,o)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=65535,a=Math.pow(2,16),c=function m(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];o(this,m),this.pos=e,this.deleted=t,this.recover=n};n.MapResult=c;var f=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];o(this,e),this.ranges=t,this.inverted=n}return r(e,[{key:"recover",value:function(e){var t=0,n=u(e);if(!this.inverted)for(var r=0;n>r;r++)t+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+t+l(e)}},{key:"mapResult",value:function(e,t){return this._map(e,t,!1)}},{key:"map",value:function(e,t){return this._map(e,t,!0)}},{key:"_map",value:function(e,t,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var u=this.ranges[a]-(this.inverted?r:0);if(u>e)break;var l=this.ranges[a+o],f=this.ranges[a+i],h=u+l;if(h>=e){var p=l?e==u?-1:e==h?1:t:t,d=u+r+(0>p?0:f);if(n)return d;var m=s(a/3,e-u);return new c(d,e!=u&&e!=h,m)}r+=f-l}return n?e+r:new c(e+r)}},{key:"touches",value:function(e,t){for(var n=0,r=u(t),o=this.inverted?2:1,i=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var s=this.ranges[a]-(this.inverted?n:0);if(s>e)break;var l=this.ranges[a+o],c=s+l;if(c>=e&&a==3*r)return!0;n+=this.ranges[a+i]-l}return!1}},{key:"forEach",value:function(e){for(var t=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],a=i-(this.inverted?o:0),s=i+(this.inverted?0:o),u=this.ranges[r+t],l=this.ranges[r+n];e(a,a+u,s,s+l),o+=l-u}}},{key:"invert",value:function(){return new e(this.ranges,!this.inverted)}},{key:"toString",value:function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}}]),e}();n.PosMap=f,f.empty=new f([]);var h=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];o(this,e),this.head=t,this.tail=n,this.mirror=Object.create(null)}return r(e,[{key:"addToFront",value:function(e,t){this.head.push(e);var n=-this.head.length;return null!=t&&(this.mirror[n]=t),n}},{key:"addToBack",value:function(e,t){this.tail.push(e);var n=this.tail.length-1;return null!=t&&(this.mirror[t]=n),n}},{key:"get",value:function(e){return 0>e?this.head[-e-1]:this.tail[e]}},{key:"mapResult",value:function(e,t){return this._map(e,t,!1)}},{key:"map",value:function(e,t){return this._map(e,t,!0)}},{key:"_map",value:function(e,t,n){for(var r=!1,o=null,i=-this.head.length;i<this.tail.length;i++){var a=this.get(i),s=void 0;if(null!=(s=o&&o[i])&&a.touches(e,s))e=a.recover(s);else{var u=a.mapResult(e,t);if(null!=u.recover){var l=this.mirror[i];if(null!=l){if(u.deleted){i=l,e=this.get(l).recover(u.recover);continue}(o||(o=Object.create(null)))[l]=u.recover}}u.deleted&&(r=!0),e=u.pos}}return n?e:new c(e,r)}},{key:"toString",value:function(){for(var e=[],t=-this.head.length;t<this.tail.length;t++)e.push(t+":"+this.get(t)+(null!=this.mirror[t]?"->"+this.mirror[t]:""));return e.join("\n")}}]),e}();n.Remapping=h,n.mapThrough=p,n.mapThroughResult=d},{}],49:[function(e){"use strict";var r=e("../model"),o=r.MarkType,i=r.Slice,a=e("./transform"),s=a.Transform,u=e("./mark_step"),l=u.AddMarkStep,c=u.RemoveMarkStep,f=e("./replace_step"),h=f.ReplaceStep;s.prototype.addMark=function(e,t,n){var r=this,o=[],i=[],a=null,s=null;return this.doc.nodesBetween(e,t,function(r,u,f,h){if(r.isInline){var p=r.marks;if(n.isInSet(p)||!f.contentMatchAt(h+1).allowsMark(n.type))s=a=null;else{var d=Math.max(u,e),m=Math.min(u+r.nodeSize,t),v=n.type.isInSet(p);v?a&&a.mark.eq(v)?a.to=m:o.push(a=new c(d,m,v)):a=null,s?s.to=m:i.push(s=new l(d,m,n))}}}),o.forEach(function(e){return r.step(e)}),i.forEach(function(e){return r.step(e)}),this},s.prototype.removeMark=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=[],a=0;return this.doc.nodesBetween(e,t,function(n,s){if(n.isInline){a++;var u=null;if(r instanceof o){var l=r.isInSet(n.marks);l&&(u=[l])}else r?r.isInSet(n.marks)&&(u=[r]):u=n.marks;if(u&&u.length)for(var c=Math.min(s+n.nodeSize,t),f=0;f<u.length;f++){for(var h=u[f],p=void 0,d=0;d<i.length;d++){var m=i[d];m.step==a-1&&h.eq(i[d].style)&&(p=m)}p?(p.to=c,p.step=a):i.push({style:h,from:Math.max(s,e),to:c,step:a})}}}),i.forEach(function(e){return n.step(new c(e.from,e.to,e.style))}),this},s.prototype.clearMarkup=function(e,t){var n=this,r=[];this.doc.nodesBetween(e,t,function(o,a){if(o.isInline){if(!o.type.isText)return void r.push(new h(a,a+o.nodeSize,i.empty));for(var s=0;s<o.marks.length;s++)n.step(new c(Math.max(a,e),Math.min(a+o.nodeSize,t),o.marks[s]))}});for(var o=r.length-1;o>=0;o--)this.step(r[o]);return this},s.prototype.clearMarkupFor=function(e,t,n){for(var r=this.doc.nodeAt(e),o=t.contentExpr.start(n),a=[],s=0,u=e+1;s<r.childCount;s++){var l=r.child(s),f=u+l.nodeSize,p=o.matchType(l.type,l.attrs);if(p){o=p;for(var d=0;d<l.marks.length;d++)o.allowsMark(l.marks[d])||this.step(new c(u,f,l.marks[d]))}else a.push(new h(u,f,i.empty));u=f}for(var m=a.length-1;m>=0;m--)this.step(a[m]);return this}},{"../model":38,"./mark_step":50,"./replace_step":52,"./transform":55}],50:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t,n){for(var r=[],o=0;o<e.childCount;o++){var i=e.child(o);i.content.size&&(i=i.copy(p(i.content,t,i))),i.isInline&&(i=t(i,n,o)),r.push(i)}return u.fromArray(r)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../model"),u=s.Fragment,l=s.Slice,c=e("./step"),f=c.Step,h=c.StepResult,d=function(e){function t(e,n,r){o(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a.from=e,a.to=n,a.mark=r,a}return a(t,e),r(t,[{key:"apply",value:function(e){var t=this,n=e.slice(this.from,this.to),r=new l(p(n.content,function(e,n,r){return n.contentMatchAt(r+1).allowsMark(t.mark.type)?e.mark(t.mark.addToSet(e.marks)):e},n.possibleParent),n.openLeft,n.openRight);return h.fromReplace(e,this.from,this.to,r)}},{key:"invert",value:function(){return new m(this.from,this.to,this.mark)}},{key:"map",value:function(e){var n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new t(n.pos,r.pos,this.mark)}}],[{key:"fromJSON",value:function(e,n){return new t(n.from,n.to,e.markFromJSON(n.mark))}}]),t}(f);n.AddMarkStep=d,f.jsonID("addMark",d);var m=function(e){function t(e,n,r){o(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a.from=e,a.to=n,a.mark=r,a}return a(t,e),r(t,[{key:"apply",value:function(e){var t=this,n=e.slice(this.from,this.to),r=new l(p(n.content,function(e){return e.mark(t.mark.removeFromSet(e.marks))}),n.openLeft,n.openRight);return h.fromReplace(e,this.from,this.to,r)}},{key:"invert",value:function(){return new d(this.from,this.to,this.mark)}},{key:"map",value:function(e){var n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new t(n.pos,r.pos,this.mark)}}],[{key:"fromJSON",value:function(e,n){return new t(n.from,n.to,e.markFromJSON(n.mark))}}]),t}(f);n.RemoveMarkStep=m,f.jsonID("removeMark",m)},{"../model":38,"./step":53}],51:[function(e){"use strict";function f(e,t,n,r){var i=o.empty,a=0,s=n[t];if(e.depth>t){var u=f(e,t+1,n,r||s);a=u.openRight+1,i=o.from(e.node(t+1).copy(u.content))}return s&&(i=i.append(s.content),a=s.openRight),r&&(i=i.append(e.node(t).contentMatchAt(e.indexAfter(t)).fillBefore(o.empty,!0)),a=0),{content:i,openRight:a}}function h(e,t){var n=f(e,0,t,!1),r=n.content,o=n.openRight;return new i(r,e.depth,o||0)}function p(e,t,n,r,o,i,a){var s=void 0,u=e.childCount,l=u-(a>0?1:0);s=0>i?t.contentMatchAt(l):1==u&&a>0?n.node(o).contentMatchAt(i?n.index(o):n.indexAfter(o)):n.node(o).contentMatchAt(n.indexAfter(o)).matchFragment(e,u>0&&i?1:0,l);var c=r.node(o);if(a>0&&o<r.depth){var f=c.content.cutByIndex(r.indexAfter(o)).addToStart(e.lastChild),h=s.fillBefore(f,!0);if(h&&h.size&&i>0&&1==u&&(h=null),h){var v=p(e.lastChild.content,e.lastChild,n,r,o+1,1==u?i-1:-1,a-1);if(v){var y=e.lastChild.copy(v);return h.size?e.cutByIndex(0,u-1).append(h).addToEnd(y):e.replaceChild(u-1,y)}}}a>0&&(s=s.matchNode(1==u&&i>0?n.node(o+1):e.lastChild));var g=r.index(o);if(g==c.childCount&&!c.type.compatibleContent(t.type))return null;var b=s.fillBefore(c.content,!0,g);if(!b)return null;if(a>0){var k=d(e.lastChild,a-1,n,o+1,1==u?i-1:-1);e=e.replaceChild(u-1,k)}return e=e.append(b),r.depth>o&&(e=e.addToEnd(m(r,o+1))),e}function d(e,t,n,r,i){var a=void 0,s=e.content,u=s.childCount;if(a=i>=0?n.node(r).contentMatchAt(n.indexAfter(r)).matchFragment(s,i>0?1:0,u):e.contentMatchAt(u),t>0){var l=d(s.lastChild,t-1,n,r+1,1==u?i-1:-1);s=s.replaceChild(u-1,l)}return e.copy(s.append(a.fillBefore(o.empty,!0)))}function m(e,t){var n=e.node(t),r=n.contentMatchAt(0).fillBefore(n.content,!0,e.index(t));return e.depth>t&&(r=r.addToEnd(m(e,t+1))),n.copy(r)}function v(e,t,n){for(;t>0&&n>0&&1==e.childCount;)e=e.firstChild.content,t--,n--;return new i(e,t,n)}function y(e,t,n){var r=p(n.content,e.node(0),e,t,0,n.openLeft,n.openRight);return r?v(r,n.openLeft,t.depth):null}function g(e,t,n){if(!t.parent.isTextblock)return!1;var r=void 0;if(n.openRight){var i=k(n.content,n.openRight);if(!i.isTextblock)return!1;r=i.contentMatchAt(i.childCount)}else{var o=e.node(e.depth-(n.openLeft-n.openRight));if(!o.isTextblock)return!1;r=o.contentMatchAt(o.childCount),n.size&&(r=r.matchFragment(n.content,n.openLeft?1:0))}return r=r.matchFragment(t.parent.content,t.index()),r&&r.validEnd()}function b(e,t){for(var n=1;t>n;n++)e=e.firstChild.content;return e.firstChild}function k(e,t){for(var n=1;t>n;n++)e=e.lastChild.content;return e.lastChild}function w(e,t){for(var n=e.depth,r=null,i=[],a=null,s=t.openLeft;;--s){var u=void 0,l=void 0,c=void 0;if(s>=0){if(s>0){var f=b(t.content,s);u=f.type,l=f.attrs,c=f.content}else 0==s&&(c=t.content);s<t.openLeft&&(c=c.cut(c.firstChild.nodeSize))}else{c=o.empty;var h=a[a.length+s-1];u=h.type,l=h.attrs}if(r&&(c=c.addToStart(r)),0==c.size&&0>=s)break;var p=x(c,e,n);if(p){if(p.fragment.size>0&&(i[p.depth]={content:p.fill.append(p.fragment),openRight:s>0?0:t.openRight-s,depth:p.depth}),0>=s)break;r=null,n=Math.max(0,p.depth-1)}else{if(0==s){var d=e.node(0);if(a=d.contentMatchAt(e.index(0)).findWrapping(c.firstChild.type,c.firstChild.attrs),!a)break;var m=a[a.length-1];if(m?!m.type.contentExpr.matches(m.attrs,c):!d.canReplace(e.indexAfter(0),e.depth?e.index(0):e.indexAfter(0),c))break;a=[{type:d.type,attrs:d.attrs}].concat(a),u=a[a.length-1].type,l=a[a.length-1].type}c=u.contentExpr.start(l).fillBefore(c,!0).append(c),r=u.create(l,c)}}return i}function x(e,t,n){for(var r=!1,i=0;i<e.childCount;i++)e.child(i).marks.length&&(r=!0);for(var a=n;a>=0;a--){var s=t.node(a).contentMatchAt(t.indexAfter(a)),u=s.fillBefore(e);if(u)return{depth:a,fill:u,fragment:e};if(r){var l=S(s,e);if(l)return{depth:a,fill:o.empty,fragment:l}}}}function S(e,t){for(var n=[],r=0;r<t.childCount;r++){var i=t.child(r),a=i.mark(i.marks.filter(function(t){return e.allowsMark(t.type)}));if(e=e.matchNode(a),!e)return null;n.push(a)}return o.from(n)}var r=e("../model"),o=r.Fragment,i=r.Slice,a=e("./replace_step"),s=a.ReplaceStep,u=a.ReplaceAroundStep,l=e("./transform"),c=l.Transform;c.prototype.delete=function(e,t){return this.replace(e,t,i.empty)},c.prototype.replace=function(e){var t=arguments.length<=1||void 0===arguments[1]?e:arguments[1],n=arguments.length<=2||void 0===arguments[2]?i.empty:arguments[2];if(e==t&&!n.size)return this;var r=this.doc.resolve(e),o=this.doc.resolve(t),a=w(r,n),l=h(r,a),c=y(r,o,l);if(!c)return this;if(l.size!=c.size&&g(r,o,l)){for(var f=o.depth,p=o.after(f);f>1&&p==o.end(--f);)++p;var d=y(r,this.doc.resolve(p),l);if(d)return this.step(new u(e,p,t,o.end(),d,l.size))}return this.step(new s(e,t,c))},c.prototype.replaceWith=function(e,t,n){return this.replace(e,t,new i(o.from(n),0,0))},c.prototype.insert=function(e,t){return this.replaceWith(e,e,t)},c.prototype.insertText=function(e,t){return this.insert(e,this.doc.type.schema.text(t,this.doc.marksAt(e)))},c.prototype.insertInline=function(e,t){return this.insert(e,t.mark(this.doc.marksAt(e)))}},{"../model":38,"./replace_step":52,"./transform":55}],52:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")
}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function v(e,t,n){for(var r=e.resolve(t),o=n-t,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var a=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!a||a.type.isLeaf)return!0;a=a.firstChild,o--}return!1}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../model"),u=s.Slice,l=e("./step"),c=l.Step,f=l.StepResult,h=e("./map"),p=h.PosMap,d=function(e){function t(e,n,r,a){o(this,t);var s=i(this,Object.getPrototypeOf(t).call(this));return s.from=e,s.to=n,s.slice=r,s.structure=!!a,s}return a(t,e),r(t,[{key:"apply",value:function(e){return this.structure&&v(e,this.from,this.to)?f.fail("Structure replace would overwrite content"):f.fromReplace(e,this.from,this.to,this.slice)}},{key:"posMap",value:function(){return new p([this.from,this.to-this.from,this.slice.size])}},{key:"invert",value:function(e){return new t(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}},{key:"map",value:function(e){var n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new t(n.pos,Math.max(n.pos,r.pos),this.slice)}}],[{key:"fromJSON",value:function(e,n){return new t(n.from,n.to,u.fromJSON(e,n.slice))}}]),t}(c);n.ReplaceStep=d,c.jsonID("replace",d);var m=function(e){function t(e,n,r,a,s,u,l){o(this,t);var c=i(this,Object.getPrototypeOf(t).call(this));return c.from=e,c.to=n,c.gapFrom=r,c.gapTo=a,c.slice=s,c.insert=u,c.structure=!!l,c}return a(t,e),r(t,[{key:"apply",value:function(e){if(this.structure&&(v(e,this.from,this.gapFrom)||v(e,this.gapTo,this.to)))return f.fail("Structure gap-replace would overwrite content");var t=e.slice(this.gapFrom,this.gapTo);if(t.openLeft||t.openRight)return f.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,t.content);return n?f.fromReplace(e,this.from,this.to,n):f.fail("Content does not fit in gap")}},{key:"posMap",value:function(){return new p([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}},{key:"invert",value:function(e){var n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}},{key:"map",value:function(e){var n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),o=e.map(this.gapFrom,-1),i=e.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new t(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)}}],[{key:"fromJSON",value:function(e,n){return new t(n.from,n.to,n.gapFrom,n.gapTo,u.fromJSON(e,n.slice),n.insert,n.structure)}}]),t}(c);n.ReplaceAroundStep=m,c.jsonID("replaceAround",m)},{"../model":38,"./map":48,"./step":53}],53:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(){throw new Error("Override me")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../model"),a=i.ReplaceError,s=e("./map"),u=s.PosMap,c=Object.create(null),f=function(){function e(){o(this,e)}return r(e,[{key:"apply",value:function(){return l()}},{key:"posMap",value:function(){return u.empty}},{key:"invert",value:function(){return l()}},{key:"map",value:function(){return l()}},{key:"toJSON",value:function(){var e={stepType:this.jsonID};for(var t in this)if(this.hasOwnProperty(t)){var n=this[t];e[t]=n&&n.toJSON?n.toJSON():n}return e}}],[{key:"fromJSON",value:function(e,t){return c[t.stepType].fromJSON(e,t)}},{key:"jsonID",value:function(e,t){if(e in c)throw new RangeError("Duplicate use of step JSON ID "+e);return c[e]=t,t.prototype.jsonID=e,t}}]),e}();n.Step=f;var h=function(){function e(t,n){o(this,e),this.doc=t,this.failed=n}return r(e,null,[{key:"ok",value:function(t){return new e(t,null)}},{key:"fail",value:function(t){return new e(null,t)}},{key:"fromReplace",value:function(t,n,r,o){try{return e.ok(t.replace(n,r,o))}catch(i){if(i instanceof a)return e.fail(i.message);throw i}}}]),e}();n.StepResult=h},{"../model":38,"./map":48}],54:[function(e,t,n){"use strict";function f(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function h(e){for(var t=e.parent,n=t.content.cutByIndex(e.startIndex,e.endIndex),r=e.depth;;--r){var o=e.$from.node(r),i=e.$from.index(r),a=e.$to.indexAfter(r);if(r<e.depth&&o.canReplace(i,a,n))return r;if(0==r||!f(o,i,a))break}}function p(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?e:arguments[3],o={type:t,attrs:n},i=d(e,o),a=i&&m(r,o);return a?i.concat(o).concat(a):null}function d(e,t){var n=e.parent,r=e.startIndex,o=e.endIndex,i=n.contentMatchAt(r).findWrapping(t.type,t.attrs);if(!i)return null;var a=i.length?i[0]:t;return n.canReplaceWith(r,o,a.type,a.attrs)?i:null}function m(e,t){var n=e.parent,r=e.startIndex,o=e.endIndex,i=n.child(r),a=t.type.contentExpr.start(t.attrs).findWrapping(i.type,i.attrs);if(!a)return null;for(var s=a.length?a[a.length-1]:t,u=s.type.contentExpr.start(s.attrs),l=r;o>l;l++)u=u&&u.matchNode(n.child(l));return u&&u.validEnd()?a:null}function v(e,t){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2],r=arguments[3],o=arguments[4],i=e.resolve(t),a=i.depth-n;if(0>a||!i.parent.canReplace(i.index(),i.parent.childCount)||!i.parent.canReplace(0,i.indexAfter()))return!1;for(var s=i.depth-1;s>a;s--){var u=i.node(s),l=i.index(s);if(!u.canReplace(0,l)||!u.canReplaceWith(l,u.childCount,r||i.node(s+1).type,r?o:i.node(s+1).attrs))return!1;r=null}var c=i.indexAfter(a);return i.node(a).canReplaceWith(c,c,r||i.node(a+1).type,r?o:i.node(a+1).attrs)}function y(e,t){var n=e.resolve(t),r=n.index();return g(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function g(e,t){return e&&t&&!e.isLeaf&&e.canAppend(t)}function b(e,t){for(var n=arguments.length<=2||void 0===arguments[2]?-1:arguments[2],r=e.resolve(t),o=r.depth;;o--){var i=void 0,a=void 0;if(o==r.depth?(i=r.nodeBefore,a=r.nodeAfter):n>0?(i=r.node(o+1),a=r.node(o).maybeChild(r.index(o)+1)):(i=r.node(o).maybeChild(r.index(o)-1),a=r.node(o+1)),i&&!i.isTextblock&&g(i,a))return t;if(0==o)break;t=0>n?r.before(o):r.after(o)}}function k(e,t,n,r){var o=e.resolve(t);if(o.parent.canReplaceWith(o.index(),o.index(),n,r))return t;if(0==o.parentOffset)for(var i=o.depth-1;i>=0;i--){var a=o.index(i);if(o.node(i).canReplaceWith(a,a,n,r))return o.before(i+1);if(a>0)return null}if(o.parentOffset==o.parent.content.size)for(var s=o.depth-1;s>=0;s--){var u=o.indexAfter(s);if(o.node(s).canReplaceWith(u,u,n,r))return o.after(s+1);if(u<o.node(s).childCount)return null}}var r=e("../model"),o=r.Slice,i=r.Fragment,a=e("./transform"),s=a.Transform,u=e("./replace_step"),l=u.ReplaceStep,c=u.ReplaceAroundStep;n.liftTarget=h,s.prototype.lift=function(e,t){for(var n=e.$from,r=e.$to,a=e.depth,s=n.before(a+1),u=r.after(a+1),l=s,f=u,h=i.empty,p=0,d=a,m=!1;d>t;d--)m||n.index(d)>0?(m=!0,h=i.from(n.node(d).copy(h)),p++):l--;for(var v=i.empty,y=0,g=a,b=!1;g>t;g--)b||r.after(g+1)<r.end(g)?(b=!0,v=i.from(r.node(g).copy(v)),y++):f++;return this.step(new c(l,f,s,u,new o(h.append(v),p,y),h.size-p,!0))},n.findWrapping=p,s.prototype.wrap=function(e,t){for(var n=i.empty,r=t.length-1;r>=0;r--)n=i.from(t[r].type.create(t[r].attrs,n));var a=e.start,s=e.end;return this.step(new c(a,s,a,s,new o(n,0,0),t.length,!0))},s.prototype.setBlockType=function(e){var t=arguments.length<=1||void 0===arguments[1]?e:arguments[1],n=this,r=arguments[2],a=arguments[3];if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var s=this.steps.length;return this.doc.nodesBetween(e,t,function(e,t){if(e.isTextblock&&!e.hasMarkup(r,a)){n.clearMarkupFor(n.map(t,1,s),r,a);var u=n.map(t,1,s),l=n.map(t+e.nodeSize,1,s);return n.step(new c(u,l,u+1,l-1,new o(i.from(r.create(a)),0,0),1,!0)),!1}}),this},s.prototype.setNodeType=function(e,t,n){var r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at given position");if(t||(t=r.type),r.type.isLeaf)return this.replaceWith(e,e+r.nodeSize,t.create(n,null,r.marks));if(!t.validContent(r.content,n))throw new RangeError("Invalid content for node type "+t.name);return this.step(new c(e,e+r.nodeSize,e+1,e+r.nodeSize-1,new o(i.from(t.create(n)),0,0),1,!0))},n.canSplit=v,s.prototype.split=function(e){for(var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=arguments[2],r=arguments[3],a=this.doc.resolve(e),s=i.empty,u=i.empty,c=a.depth,f=a.depth-t;c>f;c--)s=i.from(a.node(c).copy(s)),u=i.from(n?n.create(r,u):a.node(c).copy(u)),n=null;return this.step(new l(e,e,new o(s.append(u),t,t,!0)))},n.joinable=y,n.joinPoint=b,s.prototype.join=function(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];if(n&&(t>e||e+t>this.doc.content.size))return this;var r=new l(e-t,e+t,o.empty,!0);return n?this.maybeStep(r):this.step(r),this},n.insertPoint=k},{"../model":38,"./replace_step":52,"./transform":55}],55:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../util/error"),u=s.ProseMirrorError,l=e("./map"),c=l.mapThrough,f=l.mapThroughResult,h=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),t}(u);n.TransformError=h;var p=function(){function e(t){o(this,e),this.doc=t,this.steps=[],this.docs=[],this.maps=[]}return r(e,[{key:"step",value:function(e){var t=this.maybeStep(e);if(t.failed)throw new h(t.failed);return this}},{key:"maybeStep",value:function(e){var t=e.apply(this.doc);return t.failed||(this.docs.push(this.doc),this.steps.push(e),this.maps.push(e.posMap()),this.doc=t.doc),t}},{key:"mapResult",value:function(e,t,n){return f(this.maps,e,t,n)}},{key:"map",value:function(e,t,n){return c(this.maps,e,t,n)}},{key:"before",get:function(){return this.docs.length?this.docs[0]:this.doc}}]),e}();n.Transform=p},{"../util/error":62,"./map":48}],56:[function(e,t,n){"use strict";var r=e("../util/obj"),o=r.copyObj;o(e("./prompt"),n),n.Tooltip=e("./tooltip").Tooltip},{"../util/obj":64,"./prompt":57,"./tooltip":58}],57:[function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t,n){var r=u("button",{"class":"ProseMirror-prompt-close"}),o=u("div",{"class":"ProseMirror-prompt"},t,r),i=e.wrapper.getBoundingClientRect();if(e.wrapper.appendChild(o),n&&n.pos)o.style.left=n.pos.left-i.left+"px",o.style.top=n.pos.top-i.top+"px";else{var a=o.getBoundingClientRect(),s=Math.max(0,i.left)+Math.min(window.innerWidth,i.right)-a.width,l=Math.max(0,i.top)+Math.min(window.innerHeight,i.bottom)-a.height;o.style.left=s/2-i.left+"px",o.style.top=l/2-i.top+"px"}var c=function f(){e.on.interaction.remove(f),o.parentNode&&(o.parentNode.removeChild(o),n&&n.onClose&&n.onClose())};return r.addEventListener("click",c),e.on.interaction.add(c),{close:c}}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../util/dom"),u=s.elt,l=s.insertCSS,c=function(){function e(t,n,r){var o=this;a(this,e),this.pm=t,this.title=n,this.fields=r,this.doClose=null,this.domFields=[];for(var i in r)this.domFields.push(r[i].render(t));var s=u("h5",{},t.translate(n)),l=u("button",{type:"submit","class":"ProseMirror-prompt-submit"},"Ok"),c=u("button",{type:"button","class":"ProseMirror-prompt-cancel"},"Cancel");c.addEventListener("click",function(){return o.close()}),this.form=u("form",null,s,this.domFields.map(function(e){return u("div",null,e)}),u("div",{"class":"ProseMirror-prompt-buttons"},l," ",c))}return r(e,[{key:"close",value:function(){this.doClose&&(this.doClose(),this.doClose=null)}},{key:"open",value:function(e){var t=this;this.close();var n=this.prompt(),r=this.pm.hasFocus();this.doClose=function(){n.close(),r&&setTimeout(function(){return t.pm.focus()},50)};var o=function(){var n=t.values();n&&(t.close(),e(n))};this.form.addEventListener("submit",function(e){e.preventDefault(),o()}),this.form.addEventListener("keydown",function(e){27==e.keyCode?(e.preventDefault(),n.close()):13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),o())});var i=this.form.elements[0];i&&i.focus()}},{key:"values",value:function(){var e=Object.create(null),t=0;for(var n in this.fields){var r=this.fields[n],o=this.domFields[t++],i=r.read(o),a=r.validate(i);if(a)return this.reportInvalid(o,this.pm.translate(a)),null;e[n]=r.clean(i)}return e}},{key:"prompt",value:function(){var e=this;return d(this.pm,this.form,{onClose:function(){return e.close()}})}},{key:"reportInvalid",value:function(e,t){var n=e.parentNode,r="left: "+(e.offsetLeft+e.offsetWidth+2)+"px; top: "+(e.offsetTop-5)+"px",o=n.appendChild(u("div",{"class":"ProseMirror-invalid",style:r},t));setTimeout(function(){return n.removeChild(o)},1500)}}]),e}();n.FieldPrompt=c;var f=function(){function e(t){a(this,e),this.options=t}return r(e,[{key:"read",value:function(e){return e.value}},{key:"validateType",value:function(){}},{key:"validate",value:function(e){return!e&&this.options.required?"Required field":this.validateType(e)||this.options.validate&&this.options.validate(e)}},{key:"clean",value:function(e){return this.options.clean?this.options.clean(e):e}}]),e}();n.Field=f;var h=function(e){function t(){return a(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),r(t,[{key:"render",value:function(e){return u("input",{type:"text",placeholder:e.translate(this.options.label),value:this.options.value||"",autocomplete:"off"})}}]),t}(f);n.TextField=h;var p=function(e){function t(){return a(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),r(t,[{key:"render",value:function(e){var t=this.options,n=t.options.call?t.options(e):t.options;return u("select",null,n.map(function(n){return u("option",{value:n.value,selected:n.value==t.value?"true":null},e.translate(n.label))}))}}]),t}(f);n.SelectField=p,n.openPrompt=d,l('\n.ProseMirror-prompt {\n  background: white;\n  padding: 2px 6px 2px 15px;\n  border: 1px solid silver;\n  position: absolute;\n  border-radius: 3px;\n  z-index: 11;\n}\n\n.ProseMirror-prompt h5 {\n  margin: 0;\n  font-weight: normal;\n  font-size: 100%;\n  color: #444;\n}\n\n.ProseMirror-prompt input[type="text"],\n.ProseMirror-prompt textarea {\n  background: #eee;\n  border: none;\n  outline: none;\n}\n\n.ProseMirror-prompt input[type="text"] {\n  padding: 0 4px;\n}\n\n.ProseMirror-prompt-close {\n  position: absolute;\n  left: 2px; top: 1px;\n  color: #666;\n  border: none; background: transparent; padding: 0;\n}\n\n.ProseMirror-prompt-close:after {\n  content: "✕";\n  font-size: 12px;\n}\n\n.ProseMirror-invalid {\n  background: #ffc;\n  border: 1px solid #cc7;\n  border-radius: 4px;\n  padding: 5px 10px;\n  position: absolute;\n  min-width: 10em;\n}\n\n.ProseMirror-prompt-buttons {\n  margin-top: 5px;\n  display: none;\n}\n\n')},{"../util/dom":61}],58:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(){return{left:0,right:window.innerWidth,top:0,bottom:window.innerHeight}}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../util/dom"),a=i.elt,s=i.insertCSS,u="ProseMirror-tooltip",l=function(){function e(t,n){var r=this;o(this,e),this.wrapper=t,this.options="string"==typeof n?{direction:n}:n,this.dir=this.options.direction||"above",this.pointer=t.appendChild(a("div",{"class":u+"-pointer-"+this.dir+" "+u+"-pointer"})),this.pointerWidth=this.pointerHeight=null,this.dom=t.appendChild(a("div",{"class":u})),this.dom.addEventListener("transitionend",function(){"0"==r.dom.style.opacity&&(r.dom.style.display=r.pointer.style.display="")}),this.isOpen=!1,this.lastLeft=this.lastTop=null}return r(e,[{key:"detach",value:function(){this.dom.parentNode.removeChild(this.dom),this.pointer.parentNode.removeChild(this.pointer)}},{key:"getSize",value:function(e){var t=this.wrapper.appendChild(a("div",{"class":u,style:"display: block; position: absolute"},e)),n={width:t.offsetWidth+1,height:t.offsetHeight};return t.parentNode.removeChild(t),n}},{key:"open",value:function(e,t){for(var u,n=this.lastLeft=t?t.left:this.lastLeft,r=this.lastTop=t?t.top:this.lastTop,o=this.getSize(e),i=this.wrapper.getBoundingClientRect(),a=(this.options.getBoundingRect||c)(),s=this.dom.firstChild;s;s=u)u=s.nextSibling,s!=this.pointer&&this.dom.removeChild(s);this.dom.appendChild(e),this.dom.style.display=this.pointer.style.display="block",null==this.pointerWidth&&(this.pointerWidth=this.pointer.offsetWidth-1,this.pointerHeight=this.pointer.offsetHeight-1),this.dom.style.width=o.width+"px",this.dom.style.height=o.height+"px";var l=5;if("above"==this.dir||"below"==this.dir){var f=Math.max(a.left,Math.min(n-o.width/2,a.right-o.width));if(this.dom.style.left=f-i.left+"px",this.pointer.style.left=n-i.left-this.pointerWidth/2+"px","above"==this.dir){var h=r-i.top-l-this.pointerHeight-o.height;this.dom.style.top=h+"px",this.pointer.style.top=h+o.height+"px"}else{var p=r-i.top+l;this.pointer.style.top=p+"px",this.dom.style.top=p+this.pointerHeight+"px"}}else if("left"==this.dir||"right"==this.dir)if(this.dom.style.top=r-i.top-o.height/2+"px",this.pointer.style.top=r-this.pointerHeight/2-i.top+"px","left"==this.dir){var d=n-i.left-l-this.pointerWidth;this.dom.style.left=d-o.width+"px",this.pointer.style.left=d+"px"}else{var m=n-i.left+l;this.dom.style.left=m+this.pointerWidth+"px",this.pointer.style.left=m+"px"}else if("center"==this.dir){var v=Math.max(i.top,a.top),y=Math.min(i.bottom,a.bottom),g=(y-v-o.height)/2;this.dom.style.left=(i.width-o.width)/2+"px",this.dom.style.top=v-i.top+g+"px"}getComputedStyle(this.dom).opacity,getComputedStyle(this.pointer).opacity,this.dom.style.opacity=this.pointer.style.opacity=1,this.isOpen=!0}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.dom.style.opacity=this.pointer.style.opacity=0)}}]),e}();n.Tooltip=l,s("\n\n."+u+" {\n  position: absolute;\n  display: none;\n  box-sizing: border-box;\n  -moz-box-sizing: border- box;\n  overflow: hidden;\n\n  -webkit-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  border-radius: 5px;\n  padding: 3px 7px;\n  margin: 0;\n  background: white;\n  border: 1px solid #777;\n  color: #555;\n\n  z-index: 11;\n}\n\n."+u+"-pointer {\n  position: absolute;\n  display: none;\n  width: 0; height: 0;\n\n  -webkit-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  z-index: 12;\n}\n\n."+u+'-pointer:after {\n  content: "";\n  position: absolute;\n  display: block;\n}\n\n.'+u+"-pointer-above {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 6px solid #777;\n}\n\n."+u+"-pointer-above:after {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 6px solid white;\n  left: -6px; top: -7px;\n}\n\n."+u+"-pointer-below {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #777;\n}\n\n."+u+"-pointer-below:after {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid white;\n  left: -6px; top: 1px;\n}\n\n."+u+"-pointer-right {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-right: 6px solid #777;\n}\n\n."+u+"-pointer-right:after {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-right: 6px solid white;\n  left: 1px; top: -6px;\n}\n\n."+u+"-pointer-left {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-left: 6px solid #777;\n}\n\n."+u+"-pointer-left:after {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-left: 6px solid white;\n  left: -7px; top: -6px;\n}\n\n."+u+' input[type="text"],\n.'+u+" textarea {\n  background: #eee;\n  border: none;\n  outline: none;\n}\n\n."+u+' input[type="text"] {\n  padding: 0 4px;\n}\n\n')},{"../util/dom":61}],59:[function(e,t){"use strict";var r=/MSIE \d/.test(navigator.userAgent),o=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);t.exports={mac:/Mac/.test(navigator.platform),ie:r||!!o,ie_version:r?document.documentMode||6:o&&+o[1],gecko:/gecko\/\d/i.test(navigator.userAgent),ios:/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent)}},{}],60:[function(e,t,n){"use strict";function o(e,t){if(e===t)return!0;if(!e||"object"!=("undefined"==typeof e?"undefined":r(e))||!t||"object"!=("undefined"==typeof t?"undefined":r(t)))return!1;var n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(!o(e[i],t[i]))return!1}else{for(var a in e)if(!(a in t&&o(e[a],t[a])))return!1;for(var s in t)if(!(s in e))return!1}return!0}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n.compareDeep=o},{}],61:[function(e,t,n){"use strict";function r(e,t){var n=document.createElement(e);if(t)for(var r in t)"style"==r?n.style.cssText=t[r]:null!=t[r]&&n.setAttribute(r,t[r]);for(var i=arguments.length,a=Array(i>2?i-2:0),s=2;i>s;s++)a[s-2]=arguments[s];for(var u=0;u<a.length;u++)o(a[u],n);return n}function o(e,t){if("string"==typeof e&&(e=document.createTextNode(e)),Array.isArray(e))for(var n=0;n<e.length;n++)o(e[n],t);else t.appendChild(e)}function s(e){return i?i.call(window,e):setTimeout(e,10)}function u(e){return i?a.call(window,e):void clearTimeout(e)}function l(e,t){return 1!=t.nodeType&&(t=t.parentNode),t&&e.contains(t)}function h(e){f?f.textContent+=e:c+=e}function p(){f||(f=document.createElement("style"),f.textContent="/* ProseMirror CSS */\n"+c,document.head.insertBefore(f,document.head.firstChild))}n.elt=r;var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;n.requestAnimationFrame=s,n.cancelAnimationFrame=u,n.contains=l;var c="",f=null;n.insertCSS=h,n.ensureCSSAdded=p},{}],62:[function(e,t,n){"use strict";function r(e){Error.call(this,e),this.message!=e&&(this.message=e,Error.captureStackTrace?Error.captureStackTrace(this,this.name):this.stack=new Error(e).stack)}function o(e){var t=/^function (\w+)/.exec(e.toString());return t&&t[1]}n.ProseMirrorError=r,r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"name",{get:function(){return this.constructor.name||o(this.constructor)||"ProseMirrorError"}})},{}],63:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=window.Map||function(){function e(){o(this,e),this.content=[]}return r(e,[{key:"set",value:function(e,t){var n=this.find(e);n>-1?this.content[n+1]=t:this.content.push(e,t)}},{key:"get",value:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]}},{key:"has",value:function(e){return this.find(e)>-1}},{key:"find",value:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t}},{key:"clear",value:function(){this.content.length=0}},{key:"size",get:function(){return this.content.length/2}}]),e}();n.Map=i},{}],64:[function(e,t,n){"use strict";function r(e,t){var n=t||Object.create(null);for(var r in e)n[r]=e[r];return n}n.copyObj=r},{}],65:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){o(this,e),this.content=t}return r(e,[{key:"find",value:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]==e)return t;return-1}},{key:"get",value:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]}},{key:"update",value:function(t,n,r){var o=r&&r!=t?this.remove(r):this,i=o.find(t),a=o.content.slice();return-1==i?a.push(r||t,n):(a[i+1]=n,r&&(a[i]=r)),new e(a)}},{key:"remove",value:function(t){var n=this.find(t);if(-1==n)return this;var r=this.content.slice();return r.splice(n,2),new e(r)}},{key:"addToStart",value:function(t,n){return new e([t,n].concat(this.remove(t).content))}},{key:"addToEnd",value:function(t,n){var r=this.remove(t).content.slice();return r.push(t,n),new e(r)}},{key:"addBefore",value:function(t,n,r){var o=this.remove(n),i=o.content.slice(),a=o.find(t);return i.splice(-1==a?i.length:a,0,n,r),new e(i)}},{key:"forEach",value:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])}},{key:"prepend",value:function(t){return t=e.from(t),t.size?new e(t.content.concat(this.subtract(t).content)):this}},{key:"append",value:function(t){return t=e.from(t),t.size?new e(this.subtract(t).content.concat(t.content)):this}},{key:"subtract",value:function(t){var n=this;return e.from(t).forEach(function(e){return n=n.remove(e)}),n}},{key:"size",get:function(){return this.content.length>>1}}],[{key:"from",value:function(t){if(t instanceof e)return t;var n=[];if(t)for(var r in t)n.push(r,t[r]);return new e(n)}}]),e}();n.OrderedMap=i},{}],66:[function(e,t,n){function r(e,t,n){this.f=e,this.once=t,this.priority=n}function o(){this.handlers=[]}function i(e,t){for(var n=0;n<e.handlers.length&&!(e.handlers[n].priority<t.priority);n++);e.handlers=e.handlers.slice(0,n).concat(t).concat(e.handlers.slice(n))}function a(){o.call(this)}function s(){o.call(this)}function u(){o.call(this)}n.Subscription=o,o.prototype.handlersForDispatch=function(){for(var e=this.handlers,t=null,n=e.length-1;n>=0;n--)e[n].once&&(t||(t=e.slice()),t.splice(n,1));return t&&(this.handlers=t),e},o.prototype.add=function(e,t){i(this,new r(e,!1,t||0))},o.prototype.addOnce=function(e,t){i(this,new r(e,!0,t||0))},o.prototype.remove=function(e){for(var t=0;t<this.handlers.length;t++)if(this.handlers[t].f==e)return void(this.handlers=this.handlers.slice(0,t).concat(this.handlers.slice(t+1)))},o.prototype.hasHandler=function(){return this.handlers.length>0},o.prototype.dispatch=function(){for(var e=this.handlersForDispatch(),t=0;t<e.length;t++)e[t].f.apply(null,arguments)},n.PipelineSubscription=a,a.prototype=new o,a.prototype.dispatch=function(e){for(var t=this.handlersForDispatch(),n=0;n<t.length;n++)e=t[n].f(e);return e},n.StoppableSubscription=s,s.prototype=new o,s.prototype.dispatch=function(){for(var e=this.handlersForDispatch(),t=0;t<e.length;t++){var n=e[t].f.apply(null,arguments);if(n)return n}},n.DOMSubscription=u,u.prototype=new o,u.prototype.dispatch=function(e){for(var t=this.handlersForDispatch(),n=0;n<t.length;n++)if(t[n].f(e)||e.defaultPrevented)return!0;return!1}},{}],67:[function(e,t){"use strict";var r=e("ip-regex");t.exports=function(e){e=e||{};var t="(?:(?:[a-z]+:)?//)",n="(?:\\S+(?::\\S*)?@)?",o=r.v4().source,i="(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)",a="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",s="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",u="(?::\\d{2,5})?",l='(?:[/?#][^\\s"]*)?',c=["(?:"+t+"|www\\.)"+n,"(?:localhost|"+o+"|"+i+a+s+")",u,l].join("");return e.exact?new RegExp("(?:^"+c+"$)","i"):new RegExp(c,"ig")}},{"ip-regex":2}],68:[function(e,t,n){"use strict";function x(e){var t=this.opts=Object.assign({},n.defaults,e);t.components||(t.components=[]),t.plugins.push(b.config(t)),t.plugins.push(k.config(t)),t.components.forEach(function(e){S(t.spec,e)}),t.spec&&(t.schema=new a(t.spec),delete t.spec);var r=this.pm=new o(t),i=m(r.schema),s=i.fullMenu.map(function(e){return e.filter(function(e){return e!=g})});y.config({"float":!0,content:s}).attach(r),t.components.forEach(function(e){e.init&&e.init(r)})}function S(e,t){C(t,e.nodes,t.to({}))}function C(e,t,n){var o,s,u,r=[],a=n.getAttribute("coed-name"),l=!1;if(e.index)if(a){if(u={type:M(e),content:e.contentSpec[a]},!u.content)throw new Error("Missing component.contentSpec["+a+"]");o="content_"+e.name+e.index++,s=o+'[name="'+a+'"]'}else n.querySelector("[coed-name]")?(s=o="wrap_"+e.name+e.index++,u={type:T(e)},l=!0):(s=o="hold_"+e.name,t[o]||(u={type:A(e)}));else e.index=1,u={group:e.group||"block",type:O(e)},s=o="root_"+e.name,l=!0;var r=[];if(l){for(var h,c=n.childNodes,f=0;f<c.length;f++)h=c.item(f),h.nodeType==Node.ELEMENT_NODE&&r.push(C(e,t,h));r.length&&(u.content=r.join(" "))}return u&&(t[o]=u),s}function O(e){function t(e,t){s.call(this,e,t),this.coedType="root"}function n(e){for(var t,o,r=0;r<e.childNodes.length;r++)o=e.childNodes.item(r),o.nodeType==Node.ELEMENT_NODE&&(t=o.getAttribute("coed-name"),t||o.querySelector("[coed-name]")&&n(o))}return c(t,s),Object.defineProperty(t.prototype,"attrs",{get:function(){var t={},n=Object.assign({},e.dataSpec);
return n.id="",Object.keys(n).forEach(function(e){var r=n[e];"string"!=typeof r&&(r=""),t[e]=new l({"default":r})}),t}}),Object.defineProperty(t.prototype,"toDOM",{get:function(){return function(t){var r;return e.alt&&e.output?e.output(t.attrs):(r=e.to(t.attrs),n(r,t),[r.nodeName,E(r),0])}}}),Object.defineProperty(t.prototype,"matchDOMTag",{get:function(){var t={};return t[e.tag]=function(t){var r=e.from(t);return n(t),r},t}}),t}function T(e){function t(e,t){s.call(this,e,t),this.coedType="wrap"}return c(t,s),Object.defineProperty(t.prototype,"attrs",{get:function(){return{"class":new l({"default":""}),tag:new l({"default":"div"})}}}),Object.defineProperty(t.prototype,"toDOM",{get:function(){return function(e){var t=e.attrs;return[t.tag,{"class":t["class"]},0]}}}),Object.defineProperty(t.prototype,"matchDOMTag",{get:function(){return{"*":function(t){var n=t.nodeName.toLowerCase();return n!=e.tag&&t.querySelector("[coed-name]")?{tag:n,"class":t.getAttribute("class")}:!1}}}}),t}function M(){function t(e,t){s.call(this,e,t),this.coedType="content"}return c(t,s),Object.defineProperty(t.prototype,"attrs",{get:function(){return{name:new l({"default":""}),"class":new l({"default":""}),tag:new l({"default":"div"})}}}),Object.defineProperty(t.prototype,"toDOM",{get:function(){return function(e){var t=e.attrs;return[t.tag,{"class":t["class"],"coed-name":t.name},0]}}}),Object.defineProperty(t.prototype,"matchDOMTag",{get:function(){return{"[coed-name]":function(e){return{name:e.getAttribute("coed-name")}}}}}),t}function A(){function t(e,t){s.call(this,e,t),this.coedType="hold"}return c(t,s),Object.defineProperty(t.prototype,"selectable",{get:function(){return!1}}),Object.defineProperty(t.prototype,"readonly",{get:function(){return!0}}),Object.defineProperty(t.prototype,"attrs",{get:function(){return{html:new l({"default":""})}}}),Object.defineProperty(t.prototype,"toDOM",{get:function(){return function(e){var t=document.createElement("div");t.innerHTML=e.attrs.html;var n=t.querySelector("*");return null==n?"":n}}}),Object.defineProperty(t.prototype,"matchDOMTag",{get:function(){return{"*":function(e){return e.hasAttribute("coed-name")||e.querySelector("[coed-name]")?!1:{html:e.outerHTML}}}}}),t}function E(e){for(var r,t={},n=e.attributes,o=0;o<n.length;o++)r=n[o],t[r.name]=r.value;return t}var r=e("prosemirror/dist/edit"),o=r.ProseMirror,i=e("prosemirror/dist/model"),a=i.Schema,s=i.Block,l=(i.Inline,i.Attribute),c=e("./utils/inherits"),f=e("prosemirror/dist/schema-basic"),h=e("prosemirror/dist/schema-table"),p=e("prosemirror/dist/example-setup"),d=p.exampleSetup,m=p.buildMenuItems,v=e("prosemirror/dist/menu"),y=v.menuBar,g=v.selectParentNodeItem,b=e("./utils/url-plugin"),k=e("./plugin"),w={nodes:{doc:{type:f.Doc,content:"block+"},paragraph:{type:f.Paragraph,content:"inline<_>*",group:"block"},blockquote:{type:f.BlockQuote,content:"block+",group:"block"},ordered_list:{type:f.OrderedList,content:"list_item+",group:"block"},bullet_list:{type:f.BulletList,content:"list_item+",group:"block"},horizontal_rule:{type:f.HorizontalRule,group:"block"},heading:{type:f.Heading,content:"inline<_>*",group:"block"},code_block:{type:f.CodeBlock,content:"text*",group:"block"},list_item:{type:f.ListItem,content:"paragraph block*"},table:{type:h.Table,content:"table_row[columns=.columns]+",group:"block"},table_row:{type:h.TableRow,content:"table_cell{.columns}"},table_cell:{type:h.TableCell,content:"inline<_>*"},text:{type:f.Text,group:"inline"},hard_break:{type:f.HardBreak,group:"inline"}},marks:{strong:f.StrongMark,em:f.EmMark}};n.defaults={spec:w,types:Object.assign({},f,h),plugins:[d.config({menuBar:!1,tooltipMenu:!1})],components:[]},n.Editor=x,x.prototype.set=function(e){this.pm.setDoc(this.pm.schema.parseDOM(e))},x.prototype.get=function(){this.opts.components.forEach(function(e){e.alt=!0});var e=this.pm.doc.content.toDOM();return this.opts.components.forEach(function(e){e.alt=!1}),e},x.prototype.replace=function(e){"string"==typeof e?this.pm.tr.typeText(e).applyAndScroll():e instanceof Node&&this.pm.tr.replaceSelection(this.pm.schema.parseDOM(e)).applyAndScroll()},x.prototype.delete=function(){this.pm.tr.deleteSelection().applyAndScroll()},x.prototype.changed=function(e){this.pm.on.change.add(e)}},{"./plugin":69,"./utils/inherits":70,"./utils/url-plugin":71,"prosemirror/dist/edit":11,"prosemirror/dist/example-setup":21,"prosemirror/dist/menu":30,"prosemirror/dist/model":38,"prosemirror/dist/schema-basic":45,"prosemirror/dist/schema-table":46}],69:[function(e,t){"use strict";function h(e){this.pm=e,e.posFromDOM=c,this.dragStart=this.dragStart.bind(this),this.dragStop=this.dragStop.bind(this),this.change=this.change.bind(this),this.click=this.click.bind(this),e.on.selectionChange.add(this.change),e.on.click.add(this.click),e.content.addEventListener("mousedown",this.dragStart,!0),e.content.addEventListener("mouseup",this.dragStop),this.command=this.command.bind(this),e.addKeymap(new u({Enter:this.command},{name:"DoubleBreak"},0),-1)}function p(e){for(var n,r,t=e.depth,i={pos:{},node:{}};t>=0&&(n=e.node(t),r=n.type&&n.type.coedType,r&&(i.pos[r]=e.before(t),i.node[r]=n),"root"!=r);)t--;return i}function d(e,t){if(t)try{var n=f(e,t);if(n){var r=n.node,o=n.offset;return 1==r.nodeType&&o<r.childNodes.length&&(r=r.childNodes.item(o)),r}}catch(i){return!1}}function m(e,t){for(;t=t.parentNode;)if(e==t)return!0;return!1}var r=e("prosemirror/dist/edit"),o=r.Plugin,s=(r.NodeSelection,r.TextSelection,r.commands),u=r.Keymap,l=e("prosemirror/dist/edit/dompos"),c=l.posFromDOM,f=l.DOMFromPos;h.prototype.command=function(e){var t=e.selection.$to.nodeBefore,n=e.selection.$from.nodeAfter;if(e.selection.empty&&(!t||!n)){var r=p(e.selection.$to);if(null!=r.pos.root){var o=r.pos.root+(t?r.node.root.nodeSize:0),i=e.doc.resolve(o);return!t&&i.nodeBefore&&i.nodeBefore.isTextblock?!0:!n&&i.nodeAfter&&i.nodeAfter.isTextblock?!0:(e.tr.insertText(o,"\n").apply(),!0)}}return t&&"hard_break"==t.type.name?(s.deleteCharBefore(e,!0),s.splitBlock(e,!0),!0):(e.tr.replaceSelection(e.schema.nodes.hard_break.create()).applyAndScroll(),!0)},h.prototype.click=function(e){var n=p(this.pm.doc.resolve(e)).pos;this.focus(n.root)},h.prototype.detach=function(e){e.content&&(e.content.removeEventListener("mousedown",this.dragStart,!0),e.content.removeEventListener("mouseup",this.dragStop)),e.on.selectionChange.remove(this.change),e.on.click.remove(this.click),e.removeKeymap("DoubleBreak")},h.prototype.change=function(){if(!this.dragging){var e=this.pm.selection;if(e.empty){var t=p(e.$from).pos;this.focus(t.root)}}},h.prototype.focus=function(e){var t=d(this.pm,e);if(this.focused&&this.focused!=t&&t!==!1){for(var n=this.focused;n&&n.nodeType==Node.ELEMENT_NODE;)t&&m(n,t)||n.removeAttribute("coed-focused"),n=n.parentNode;delete this.focused}t&&(t.setAttribute("coed-focused",1),this.focused=t)},h.prototype.dragStart=function(e){this.dragging=!0;var t=e.target;t.nodeType==Node.TEXT_NODE&&(t=t.parentNode);var n;try{n=c(t)}catch(r){return}var o=p(this.pm.doc.resolve(n.pos)).pos;if(null!=o.root&&null==o.content&&null==o.wrap){e.target.draggable=!1,this.pm.setNodeSelection(o.root);var t=d(this.pm,o.root);t&&(t=t.querySelector("*")),t&&(t.draggable=!0,this.dragTarget=t)}},h.prototype.dragStop=function(){this.dragging&&(this.dragging=!1,this.dragTarget&&(this.dragTarget.draggable=!1,delete this.dragTarget))},t.exports=new o(h)},{"prosemirror/dist/edit":11,"prosemirror/dist/edit/dompos":8}],70:[function(e,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}},{}],71:[function(e,t){"use strict";function l(e,t){this.components=t.components,this.pm=e,this.filter=this.filter.bind(this),e.on.transformPasted.add(this.filter)}function c(e){for(var r,t=!0,n=e.childNodes.length,o=0,i=0;n>i;i++)if(r=e.childNodes[i],r.nodeType!=Node.TEXT_NODE||r.nodeValue.trim()){if(r.nodeType!=Node.ELEMENT_NODE){t=!1;break}o++}return o||(t=!1),t}function f(e){var t;if("function"==typeof HTMLTemplateElement){var n=document.createElement("template");n.content&&n.content.nodeType==Node.DOCUMENT_FRAGMENT_NODE&&(t=n.content)}if(!t){var r;if(!document.implementation||!document.implementation.createHTMLDocument)throw new Error("Do not parse html using live document");r=document.implementation.createHTMLDocument(""),t=r.createDocumentFragment()}var o=t.ownerDocument.createElement("div");for(o.innerHTML=e;o.firstChild;)t.appendChild(o.firstChild);return t}var r=e("prosemirror/dist/edit"),o=r.Plugin,i=e("prosemirror/dist/model"),a=i.Slice,s=i.Fragment,u=e("url-regex");l.prototype.detach=function(e){e.on.transformPasted.remove(this.filter)},l.prototype.filter=function(e){return new a(this.transform(e.content),e.openLeft,e.openRight)},l.prototype.transform=function(e){for(var t=[],n=u(),r=0;r<e.childCount;r++){var a,o=e.child(r),i=null;if(o.isText){var l=f(o.text.trim());if(c(l)){for(var h=0;h<this.components.length&&(a=this.components[h],a.input&&(i=a.input(l)),!i);h++);if(i){t.push(i);continue}}else{for(var d,p=0;d=n.exec(o.text);){var m=d.index,v=m+d[0].length,y=o.type.schema.marks.link;m>0&&t.push(o.copy(o.text.slice(p,m)));for(var g=o.text.slice(m,v),h=0;h<this.components.length&&(a=this.components[h],a.input&&(i=a.input(g)),!i);h++);i||(i=o.type.create(null,g,y?y.create({href:g}).addToSet(o.marks):null)),t.push(i),p=v}p<o.text.length&&t.push(o.copy(o.text.slice(p)))}}else t.push(o.copy(this.transform(o.content)))}return s.fromArray(t)},t.exports=new o(l)},{"prosemirror/dist/edit":11,"prosemirror/dist/model":38,"url-regex":67}]},{},[68])(68)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Coed||(t.Coed={})).Link=e()}}(function(){return function r(e,t,n){function o(a,s){if(!t[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=t[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,r,e,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t){"use strict";function r(e){this.tag="co-link",this.name="link",this.dataSpec={id:"",type:"none",url:"",description:"",icon:"",thumbnail:"",size:"",width:"",height:"",duration:"",site:"",html:""},this.contentSpec={title:"inline<_>*",content:"inline<_>*"},e.inspector&&(this.inspector=e.inspector)}t.exports=r,r.prototype.init=function(e){e.content.addEventListener("click",function(e){var t=e.target,n=t.closest("co-link");if(n&&t.closest('[name="preview"]')){e.preventDefault();var r=this.from(n);console.log("will preview",r)}}.bind(this))},r.prototype.inspector=function(e,t){setTimeout(function(){e=Object.assign({},e),e.type="link",t(null,e)})},r.prototype.ensure=function(e,t,n){for(var i,a,r=e.childNodes,o=new RegExp("^"+t+"$","i"),s=0;s<r.length;s++)if(a=r[s],a.nodeType==Node.ELEMENT_NODE&&o.test(a.nodeName)){i=a;break}return i||(i=document.createElement(t),e.appendChild(i)),n&&Object.keys(n).forEach(function(e){i.setAttribute(e,n[e])}),i},r.prototype.fill=function(e,t){e.innerHTML="",Object.keys(t).forEach(function(n){var r=t[n];e.appendChild(r)})},r.prototype.formatDimensions=function(e,t){return e?t?e+"x"+t:e+"px":void 0},r.prototype.parseDimensions=function(e,t){t&&(/px$/.test(t)?e.width=parseInt(t):/^\d+x\d+$/.test(t)&&(t=t.split("x"),e.width=parseInt(t[0]),e.height=parseInt(t[1])))},r.prototype.formatDuration=function(e){return e},r.prototype.formatSize=function(e){return e?Math.round(e/1e3)+"KB":void 0},r.prototype.parseSize=function(e,t){t&&/^\d+KB$/.test(t)&&(e.size=1e3*parseInt(t))},r.prototype.to=function(e,t){var n=this,r=document.createElement(n.tag);r.innerHTML='<header><a name="type"></a><a title="" target="_blank"></a><a name="preview"></a></header><div><div coed-name="title"></div><div coed-name="content"></div></div><aside><div><div></div><p></p></div><figure></figure></aside><script type="text/html"></script>';var o=r.querySelector("header > a[title]");o.setAttribute("title",e.site||""),e.type&&r.setAttribute("type",e.type),e.id&&r.setAttribute("id",e.id),e.url&&o.setAttribute("href",e.url),e.icon&&n.ensure(o,"img",{src:e.icon}),e.thumbnail&&n.ensure(r.querySelector("figure"),"img",{src:e.thumbnail}),e.html&&(n.ensure(r,"script",{type:"text/html"}).textContent=e.html||"");var i={dimensions:n.formatDimensions(e.width,e.height),duration:n.formatDuration(e.duration),size:n.formatSize(e.size)};return Object.keys(i).forEach(function(e){var t=document.createElement("span");t.setAttribute("title",e),t.innerHTML=i[e]||"",i[e]=t}),r.querySelector("aside > div > p").innerHTML=e.description||"",n.fill(r.querySelector("aside > div > div"),i),t&&Object.keys(t).forEach(function(e){r.querySelector('[coed-name="'+e+'"]').innerHTML=t[e]}),r},r.prototype.from=function(e){var t=this,n={};n.type=e.getAttribute("type")||"none",n.id=e.getAttribute("id")||void 0;var r=e.querySelector("header > a[href]");if(r){n.url=r.getAttribute("href"),n.site=r.getAttribute("title");var o=r.querySelector("img");o&&(n.icon=o.getAttribute("src"))}var i=e.querySelector('script[type="text/html"]');i&&(n.html=i.textContent);var a=e.querySelector("aside > figure > img");a&&(n.thumbnail=a.getAttribute("src"));var s,l,c,f,u=e.querySelectorAll("aside > div > span");for(s=0;s<u.length;s++)l=u.item(s),c=l.getAttribute("title"),f=l.innerHTML,"size"==c?t.parseSize(n,f):"dimensions"==c?t.parseDimensions(n,f):n[c]=f;var h=e.querySelector("aside > div > p");return h&&(n.description=h.innerHTML),n},r.prototype.input=function(e){function o(e){var t=document.createElement("div");t.appendChild(e);var n=pm.schema.parseDOM(t);return n.firstChild}var t=this,n="id-colink-"+Date.now(),r={};"string"==typeof e?(r.title=e,r.url=e):(r.title=e.innerText,r.fragment=e),t.inspector(r,function(e,r){var i=document.getElementById(n);if(i){var a=pm.posFromDOM(i),s=a.pos,u=pm.doc.resolve(s),l=s+u.nodeAfter.nodeSize;if(e)return console.error(e),void pm.tr.delete(s,l).apply();var c=t.to(r,{title:r.title});pm.tr.replaceWith(s,l,o(c)).apply()}});var i=t.to({type:"none",id:n},{title:r.title});return o(i)},r.prototype.output=function(e){if(e.html){var t=document.createElement("div");for(var n in e)"html"!=n&&t.setAttribute("data-"+n,e[n]);return t.innerHTML=e.html,t}return this.to(e)}},{}]},{},[1])(1)}),function(){"use strict";function d(e,t,n){!function(r){e[t]=e[n],e[n]=r}(e[t])}var e,t=function(e){var t=this;Object.keys(e).forEach(function(n){t[n]=e[n]})};t.prototype={toString:function(){return JSON.stringify(this)}};var n=function(e,t){this.oldValue=e,this.newValue=t};n.prototype={contains:function(e){return e.length<this.length?e.newValue>=this.newValue&&e.newValue<this.newValue+this.length:!1},toString:function(){return this.length+" element subset, first mapping: old "+this.oldValue+" → new "+this.newValue}};var r=function(e){var t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes["class"]&&t.push(e.nodeName+"."+e.attributes["class"].replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t},o=function(e){var t={},n={};return e.forEach(function(e){r(e).forEach(function(e){var r=e in t,o=e in n;r||o?r&&(delete t[e],n[e]=!0):t[e]=!0})}),t},i=function(e,t){var n=o(e),r=o(t),i={};return Object.keys(n).forEach(function(e){r[e]&&(i[e]=!0)}),i},a=function(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,e.childNodes?e.childNodes.every(a):!0},s=function(e,t){var n,r;if(!["nodeName","value","checked","selected","data"].every(function(n){return e[n]!==t[n]?!1:!0}))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){if(n=Object.keys(e.attributes),r=Object.keys(t.attributes),n.length!==r.length)return!1;if(!n.every(function(n){return e.attributes[n]!==t.attributes[n]?!1:void 0}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,n){return s(e,t.childNodes[n])}))return!1}return!0},u=function(e,t,n,r,o){var a,s,l;if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return o?!0:e.data===t.data;if(e.nodeName in n)return!0;if(e.attributes&&t.attributes){if(e.attributes.id&&e.attributes.id===t.attributes.id){var c=e.nodeName+"#"+e.attributes.id;if(c in n)return!0}if(e.attributes["class"]&&e.attributes["class"]===t.attributes["class"]){var f=e.nodeName+"."+e.attributes["class"].replace(/ /g,".");if(f in n)return!0}}return r?!0:(s=e.childNodes?e.childNodes.slice().reverse():[],l=t.childNodes?t.childNodes.slice().reverse():[],s.length!==l.length?!1:o?s.every(function(e,t){return e.nodeName===l[t].nodeName}):(a=i(s,l),s.every(function(e,t){return u(e,l[t],a,!0,!0)})))},l=function(e){return JSON.parse(JSON.stringify(e))},c=function(e,t,o,a){var p,d,s=0,l=[],c=Array.apply(null,new Array(e.length+1)).map(function(){return[]}),f=i(e,t),h=e.length===t.length;return h&&e.some(function(e,n){var o=r(e),i=r(t[n]);return o.length!==i.length?(h=!1,!0):(o.some(function(e,t){return e!==i[t]?(h=!1,!0):void 0}),h?void 0:!0)}),e.forEach(function(e,n){t.forEach(function(t,r){o[n]||a[r]||!u(e,t,f,h)?c[n+1][r+1]=0:(c[n+1][r+1]=c[n][r]?c[n][r]+1:1,c[n+1][r+1]>=s&&(s=c[n+1][r+1],l=[n+1,r+1]))})}),0===s?!1:(p=[l[0]-s,l[1]-s],d=new n(p[0],p[1]),d.length=s,d)},f=function(e,t){return Array.apply(null,new Array(e)).map(function(){return t})},h=function(e,t,n){var r=e.childNodes?f(e.childNodes.length,!0):[],o=t.childNodes?f(t.childNodes.length,!0):[],i=0;return n.forEach(function(e){var t,n=e.oldValue+e.length,a=e.newValue+e.length;for(t=e.oldValue;n>t;t+=1)r[t]=i;for(t=e.newValue;a>t;t+=1)o[t]=i;i+=1}),{gaps1:r,gaps2:o}},p=function(e,t){for(var n=e.childNodes?e.childNodes:[],r=t.childNodes?t.childNodes:[],o=f(n.length,!1),i=f(r.length,!1),a=[],s=!0,u=function(){return arguments[1]},l=function(e){o[s.oldValue+e]=!0,i[s.newValue+e]=!0};s;)s=c(n,r,o,i),s&&(a.push(s),Array.apply(null,new Array(s.length)).map(u).forEach(l));return a},m=function(){this.list=[]};m.prototype={list:!1,add:function(e){var t=this.list;e.forEach(function(e){t.push(e)})},forEach:function(e){this.list.forEach(e)}};var v=function(e){var n,t={debug:!1,diffcap:10,maxDepth:!1,valueDiffing:!0,textDiff:function(){arguments[0].data=arguments[3]},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null};"undefined"==typeof e&&(e={});for(n in t)this[n]="undefined"==typeof e[n]?t[n]:e[n]};v.Diff=t,v.prototype={diff:function(t,n){var r=this.nodeToObj(t),o=this.nodeToObj(n);return e=0,this.debug&&(this.t1Orig=this.nodeToObj(t),this.t2Orig=this.nodeToObj(n)),this.tracker=new m,this.findDiffs(r,o)},findDiffs:function(t,n){var r;do{if(this.debug&&(e+=1,e>this.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));r=this.findNextDiff(t,n,[]),0===r.length&&(s(t,n)||(a(t),r=this.findNextDiff(t,n,[]))),r.length>0&&(this.tracker.add(r),this.applyVirtual(t,r))}while(r.length>0);return this.tracker.list},findNextDiff:function(e,t,n){var r,o;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!e.outerDone){if(r=this.findOuterDiff(e,t,n),this.filterOuterDiff&&(o=this.filterOuterDiff(e,t,r),o&&(r=o)),r.length>0)return e.outerDone=!0,r;e.outerDone=!0}if(!e.innerDone){if(r=this.findInnerDiff(e,t,n),r.length>0)return r;e.innerDone=!0}if(this.valueDiffing&&!e.valueDone){if(r=this.findValueDiff(e,t,n),r.length>0)return e.valueDone=!0,r;e.valueDone=!0}return[]},findOuterDiff:function(e,n,r){var i,a,o=[];return e.nodeName!==n.nodeName?[new t({action:"replaceElement",oldValue:l(e),newValue:l(n),route:r})]:e.data!==n.data?"#text"===e.nodeName?[new t({action:"modifyTextElement",route:r,oldValue:e.data,newValue:n.data})]:[new t({action:"modifyComment",route:r,oldValue:e.data,newValue:n.data})]:(i=e.attributes?Object.keys(e.attributes).sort():[],a=n.attributes?Object.keys(n.attributes).sort():[],i.forEach(function(i){var s=a.indexOf(i);-1===s?o.push(new t({action:"removeAttribute",route:r,name:i,value:e.attributes[i]})):(a.splice(s,1),e.attributes[i]!==n.attributes[i]&&o.push(new t({action:"modifyAttribute",route:r,name:i,oldValue:e.attributes[i],newValue:n.attributes[i]})))}),a.forEach(function(e){o.push(new t({action:"addAttribute",route:r,name:e,value:n.attributes[e]}))}),o)},nodeToObj:function(e){var t={},n=this;return t.nodeName=e.nodeName,"#text"===t.nodeName||"#comment"===t.nodeName?t.data=e.data:(e.attributes&&e.attributes.length>0&&(t.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){t.attributes[e.name]=e.value})),e.childNodes&&e.childNodes.length>0&&(t.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){t.childNodes.push(n.nodeToObj(e))})),this.valueDiffing&&(void 0!==e.value&&(t.value=e.value),void 0!==e.checked&&(t.checked=e.checked),void 0!==e.selected&&(t.selected=e.selected))),t},objToNode:function(e,t){var n,r=this;return"#text"===e.nodeName?n=document.createTextNode(e.data):"#comment"===e.nodeName?n=document.createComment(e.data):("svg"===e.nodeName||t?(n=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):n=document.createElement(e.nodeName),e.attributes&&Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t])}),e.childNodes&&e.childNodes.forEach(function(e){n.appendChild(r.objToNode(e,t))}),this.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))),n},findInnerDiff:function(e,n,r){var s,f,h,d,m,o=e.childNodes&&n.childNodes?p(e,n):[],i=e.childNodes?e.childNodes:[],a=n.childNodes?n.childNodes:[],u=[],c=0;if(o.length>0&&(u=this.attemptGroupRelocation(e,n,o,r),u.length>0))return u;for(f=Math.max(i.length,a.length),i.length!==a.length&&(s=!0),m=0;f>m;m+=1)h=i[m],d=a[m],s&&(h&&!d?"#text"===h.nodeName?(u.push(new t({action:"removeTextElement",route:r.concat(c),value:h.data})),c-=1):(u.push(new t({action:"removeElement",route:r.concat(c),element:l(h)})),c-=1):d&&!h&&u.push("#text"===d.nodeName?new t({action:"addTextElement",route:r.concat(c),value:d.data}):new t({action:"addElement",route:r.concat(c),element:l(d)}))),h&&d&&(u=u.concat(this.findNextDiff(h,d,r.concat(c)))),c+=1;return e.innerDone=!0,u},attemptGroupRelocation:function(e,n,r,o){var f,p,d,m,v,y,b,k,w,i=h(e,n,r),a=i.gaps1,s=i.gaps2,c=Math.min(a.length,s.length),g=[];for(k=0,b=0;c>k;b+=1,k+=1)if(a[k]===!0)if(m=e.childNodes[b],"#text"===m.nodeName){if("#text"===n.childNodes[k].nodeName&&m.data!==n.childNodes[k].data){for(y=b;e.childNodes.length>y+1&&"#text"===e.childNodes[y+1].nodeName;)if(y+=1,n.childNodes[k].data===e.childNodes[y].data){v=!0;break}if(!v)return g.push(new t({action:"modifyTextElement",route:o.concat(k),oldValue:m.data,newValue:n.childNodes[k].data})),g}g.push(new t({action:"removeTextElement",route:o.concat(k),value:m.data})),a.splice(k,1),c=Math.min(a.length,s.length),k-=1}else g.push(new t({action:"removeElement",route:o.concat(k),element:l(m)})),a.splice(k,1),c=Math.min(a.length,s.length),k-=1;else if(s[k]===!0)m=n.childNodes[k],"#text"===m.nodeName?(g.push(new t({action:"addTextElement",route:o.concat(k),value:m.data})),a.splice(k,0,!0),c=Math.min(a.length,s.length),b-=1):(g.push(new t({action:"addElement",route:o.concat(k),element:l(m)})),a.splice(k,0,!0),c=Math.min(a.length,s.length),b-=1);else if(a[k]!==s[k]){if(g.length>0)return g;if(d=r[a[k]],p=Math.min(d.newValue,e.childNodes.length-d.length),p!==d.oldValue){for(f=!1,w=0;w<d.length;w+=1)u(e.childNodes[p+w],e.childNodes[d.oldValue+w],[],!1,!0)||(f=!0);if(f)return[new t({action:"relocateGroup",groupLength:d.length,from:d.oldValue,to:p,route:o})]}}return g},findValueDiff:function(e,n,r){var o=[];return e.selected!==n.selected&&o.push(new t({action:"modifySelected",oldValue:e.selected,newValue:n.selected,route:r})),(e.value||n.value)&&e.value!==n.value&&"OPTION"!==e.nodeName&&o.push(new t({action:"modifyValue",oldValue:e.value,newValue:n.value,route:r})),e.checked!==n.checked&&o.push(new t({action:"modifyChecked",oldValue:e.checked,newValue:n.checked,route:r})),o},applyVirtual:function(e,t){var n=this;return 0===t.length?!0:(t.forEach(function(t){n.applyVirtualDiff(e,t)}),!0)},getFromVirtualRoute:function(e,t){var r,o,n=e;for(t=t.slice();t.length>0;){if(!n.childNodes)return!1;o=t.splice(0,1)[0],r=n,n=n.childNodes[o]}return{node:n,parentNode:r,nodeIndex:o}},applyVirtualDiff:function(e,t){var a,s,u,n=this.getFromVirtualRoute(e,t.route),r=n.node,o=n.parentNode,i=n.nodeIndex,c={diff:t,node:r};if(this.preVirtualDiffApply(c))return!0;switch(t.action){case"addAttribute":r.attributes||(r.attributes={}),r.attributes[t.name]=t.value,"checked"===t.name?r.checked=!0:"selected"===t.name?r.selected=!0:"INPUT"===r.nodeName&&"value"===t.name&&(r.value=t.value);break;case"modifyAttribute":r.attributes[t.name]=t.newValue,"INPUT"===r.nodeName&&"value"===t.name&&(r.value=t.value);break;case"removeAttribute":delete r.attributes[t.name],0===Object.keys(r.attributes).length&&delete r.attributes,"checked"===t.name?r.checked=!1:"selected"===t.name?delete r.selected:"INPUT"===r.nodeName&&"value"===t.name&&delete r.value;break;case"modifyTextElement":r.data=t.newValue,"TEXTAREA"===o.nodeName&&(o.value=t.newValue);break;case"modifyValue":r.value=t.newValue;break;case"modifyComment":r.data=t.newValue;break;case"modifyChecked":r.checked=t.newValue;break;case"modifySelected":r.selected=t.newValue;break;case"replaceElement":a=l(t.newValue),a.outerDone=!0,a.innerDone=!0,a.valueDone=!0,o.childNodes[i]=a;break;case"relocateGroup":r.childNodes.splice(t.from,t.groupLength).reverse().forEach(function(e){r.childNodes.splice(t.to,0,e)});break;case"removeElement":o.childNodes.splice(i,1);break;case"addElement":s=t.route.slice(),u=s.splice(s.length-1,1)[0],r=this.getFromVirtualRoute(e,s).node,a=l(t.element),a.outerDone=!0,a.innerDone=!0,a.valueDone=!0,r.childNodes||(r.childNodes=[]),u>=r.childNodes.length?r.childNodes.push(a):r.childNodes.splice(u,0,a);break;case"removeTextElement":o.childNodes.splice(i,1),"TEXTAREA"===o.nodeName&&delete o.value;break;case"addTextElement":s=t.route.slice(),u=s.splice(s.length-1,1)[0],a={},a.nodeName="#text",a.data=t.value,r=this.getFromVirtualRoute(e,s).node,r.childNodes||(r.childNodes=[]),u>=r.childNodes.length?r.childNodes.push(a):r.childNodes.splice(u,0,a),"TEXTAREA"===r.nodeName&&(r.value=t.newValue);break;default:console.log("unknown action")}c.newNode=a,this.postVirtualDiffApply(c)},apply:function(e,t){var n=this;return 0===t.length?!0:(t.forEach(function(t){return n.applyDiff(e,t)?void 0:!1}),!0)},getFromRoute:function(e,t){t=t.slice();for(var n,r=e;t.length>0;){if(!r.childNodes)return!1;n=t.splice(0,1)[0],r=r.childNodes[n]}return r},applyDiff:function(e,t){var r,o,i,a,n=this.getFromRoute(e,t.route),s={diff:t,node:n};if(this.preDiffApply(s))return!0;switch(t.action){case"addAttribute":if(!n||!n.setAttribute)return!1;n.setAttribute(t.name,t.value);break;case"modifyAttribute":if(!n||!n.setAttribute)return!1;n.setAttribute(t.name,t.newValue);break;case"removeAttribute":if(!n||!n.removeAttribute)return!1;n.removeAttribute(t.name);break;case"modifyTextElement":if(!n||3!==n.nodeType)return!1;this.textDiff(n,n.data,t.oldValue,t.newValue);break;case"modifyValue":if(!n||"undefined"==typeof n.value)return!1;n.value=t.newValue;break;case"modifyComment":if(!n||"undefined"==typeof n.data)return!1;this.textDiff(n,n.data,t.oldValue,t.newValue);break;case"modifyChecked":if(!n||"undefined"==typeof n.checked)return!1;n.checked=t.newValue;break;case"modifySelected":if(!n||"undefined"==typeof n.selected)return!1;n.selected=t.newValue;break;case"replaceElement":n.parentNode.replaceChild(this.objToNode(t.newValue,"http://www.w3.org/2000/svg"===n.namespaceURI),n);break;case"relocateGroup":Array.apply(null,new Array(t.groupLength)).map(function(){return n.removeChild(n.childNodes[t.from])}).forEach(function(e,r){0===r&&(o=n.childNodes[t.to]),n.insertBefore(e,o)});break;case"removeElement":n.parentNode.removeChild(n);break;case"addElement":i=t.route.slice(),a=i.splice(i.length-1,1)[0],n=this.getFromRoute(e,i),n.insertBefore(this.objToNode(t.element,"http://www.w3.org/2000/svg"===n.namespaceURI),n.childNodes[a]);break;case"removeTextElement":if(!n||3!==n.nodeType)return!1;n.parentNode.removeChild(n);break;case"addTextElement":if(i=t.route.slice(),a=i.splice(i.length-1,1)[0],r=document.createTextNode(t.value),n=this.getFromRoute(e,i),!n||!n.childNodes)return!1;n.insertBefore(r,n.childNodes[a]);break;default:console.log("unknown action")}return s.newNode=r,this.postDiffApply(s),!0},undo:function(e,t){t=t.slice();var n=this;t.length||(t=[t]),t.reverse(),t.forEach(function(t){n.undoDiff(e,t)})},undoDiff:function(e,t){switch(t.action){case"addAttribute":t.action="removeAttribute",this.applyDiff(e,t);break;case"modifyAttribute":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"removeAttribute":t.action="addAttribute",this.applyDiff(e,t);break;case"modifyTextElement":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifyValue":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifyComment":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifyChecked":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifySelected":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"replaceElement":d(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"relocateGroup":d(t,"from","to"),this.applyDiff(e,t);break;case"removeElement":t.action="addElement",this.applyDiff(e,t);break;case"addElement":t.action="removeElement",this.applyDiff(e,t);break;case"removeTextElement":t.action="addTextElement",this.applyDiff(e,t);break;case"addTextElement":t.action="removeTextElement",this.applyDiff(e,t);break;default:console.log("unknown action")}}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=v),exports.diffDOM=v):this.diffDOM=v}.call(this);